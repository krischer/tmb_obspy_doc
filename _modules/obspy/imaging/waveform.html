<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.imaging.waveform &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="http://docs.obspy.org/search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.imaging.waveform</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Filename: waveform.py</span>
<span class="c1">#  Purpose: Waveform plotting for obspy.Stream objects</span>
<span class="c1">#   Author: Lion Krischer</span>
<span class="c1">#    Email: krischer@geophysik.uni-muenchen.de</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2008-2012 Lion Krischer</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Waveform plotting for obspy.Stream objects.</span>

<span class="sd">:copyright:</span>
<span class="sd">    The ObsPy Development Team (devs@obspy.org)</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License, Version 3</span>
<span class="sd">    (https://www.gnu.org/copyleft/lesser.html)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA @UnusedWildImport</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">native_str</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.rrule</span> <span class="k">import</span> <span class="n">MINUTELY</span><span class="p">,</span> <span class="n">SECONDLY</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">matplotlib.cm</span> <span class="k">import</span> <span class="n">get_cmap</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="k">import</span> <span class="n">AutoDateLocator</span><span class="p">,</span> <span class="n">date2num</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MaxNLocator</span><span class="p">,</span> <span class="n">ScalarFormatter</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">obspy.core.util</span> <span class="k">import</span> <span class="n">create_empty_data_chunk</span>
<span class="kn">from</span> <span class="nn">obspy.core.util.decorator</span> <span class="k">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">obspy.geodetics</span> <span class="k">import</span> <span class="n">FlinnEngdahl</span><span class="p">,</span> <span class="n">kilometer2degrees</span><span class="p">,</span> <span class="n">locations2degrees</span>
<span class="kn">from</span> <span class="nn">obspy.imaging.util</span> <span class="k">import</span> <span class="p">(</span><span class="n">ObsPyAutoDateFormatter</span><span class="p">,</span> <span class="n">_id_key</span><span class="p">,</span> <span class="n">_timestring</span><span class="p">)</span>


<span class="n">MINMAX_ZOOMLEVEL_WARNING_TEXT</span> <span class="o">=</span> <span class="s2">&quot;Warning: Zooming into MinMax Plot!&quot;</span>
<span class="n">SECONDS_PER_DAY</span> <span class="o">=</span> <span class="mf">3600.0</span> <span class="o">*</span> <span class="mf">24.0</span>
<span class="n">DATELOCATOR_WARNING_MSG</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;AutoDateLocator was unable to pick an appropriate interval for this date &quot;</span>
    <span class="s2">&quot;range. It may be necessary to add an interval value to the &quot;</span>
    <span class="s2">&quot;AutoDateLocator&#39;s intervald dictionary.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="WaveformPlotting"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.html#obspy.imaging.waveform.WaveformPlotting">[docs]</a><span class="k">class</span> <span class="nc">WaveformPlotting</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that provides several solutions for plotting large and small waveform</span>
<span class="sd">    data sets.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This class should NOT be used directly, instead use the</span>
<span class="sd">        :meth:`~obspy.core.stream.Stream.plot` method of the</span>
<span class="sd">        ObsPy :class:`~obspy.core.stream.Stream` or</span>
<span class="sd">        :class:`~obspy.core.trace.Trace` objects.</span>

<span class="sd">    It uses matplotlib to plot the waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WaveformPlotting.__init__"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.__init__.html#obspy.imaging.waveform.WaveformPlotting.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks some variables and maps the kwargs to class variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">)</span>
        <span class="c1"># Check if it is a Stream or a Trace object.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="n">Trace</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Plotting is only supported for Stream or Trace objects.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Stream object should contain at least one Trace</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Empty stream object&quot;</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Type of the plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="c1"># Start and end times of the plots.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;starttime&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endtime&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># If no times are given take the min/max values from the stream object.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
        <span class="c1"># Assigning values for type &#39;section&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset_min&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset_max&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dist_degree&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># TODO Event data from class Event()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ev_coord</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ev_coord&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plot_dx&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span> <span class="o">/=</span> <span class="mf">1e3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_timedown</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time_down&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_recordstart</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recordstart&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_recordlength</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recordlength&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_norm_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;norm_method&#39;</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_user_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vred&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span> <span class="o">=</span> <span class="n">kilometer2degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reftime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftime&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sect_reftime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftime&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Whether to use straight plotting or the fast minmax method. If not</span>
        <span class="c1"># set explicitly by the user &quot;full&quot; method will be used by default and</span>
        <span class="c1"># &quot;fast&quot; method will be used above some threshold of data points to</span>
        <span class="c1"># plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Below that value the data points will be plotted normally. Above it</span>
        <span class="c1"># the data will be plotted using a different approach (details see</span>
        <span class="c1"># below). Can be overwritten by the above self.plotting_method kwarg.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="c1"># section may consists of hundreds of seismograms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_npts</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_npts</span> <span class="o">=</span> <span class="mi">400000</span>
        <span class="c1"># If automerge is enabled, merge traces with the same id for the plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">automerge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;automerge&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># If equal_scale is enabled, all plots are equally scaled.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equal_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;equal_scale&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Set default values.</span>
        <span class="c1"># The default value for the size is determined dynamically because</span>
        <span class="c1"># there might be more than one channel to plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Values that will be used to calculate the size of the plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_width</span> <span class="o">=</span> <span class="mi">800</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_height_per_channel</span> <span class="o">=</span> <span class="mi">250</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">800</span>
            <span class="c1"># Check the kind of plot.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;dayplot&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">600</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">600</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># One plot for each trace.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">automerge</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_mergable_ids</span><span class="p">()</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">count</span> <span class="o">*</span> <span class="mi">250</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># Interval length in minutes for dayplot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="c1"># Scaling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertical_scaling_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vertical_scaling_range&#39;</span><span class="p">,</span>
                                                 <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Dots per inch of the plot. Might be useful for printing plots.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="c1"># Color of the graph.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;dayplot&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;#B2000F&#39;</span><span class="p">,</span> <span class="s1">&#39;#004C12&#39;</span><span class="p">,</span> <span class="s1">&#39;#847200&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;#0E01FF&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">native_str</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;number_of_ticks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;number_of_ticks&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># Background, face and grid color.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;face_color&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_color&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_linewidth&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_linestyle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="c1"># Transparency. Overwrites background and facecolor settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;transparent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Ticks.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tick_format&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tick_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tick_format&#39;</span><span class="p">,</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tick_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tick_rotation&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Whether or not to save a file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;outfile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;handle&#39;</span><span class="p">)</span>
        <span class="c1"># File format of the resulting file. Usually defaults to PNG but might</span>
        <span class="c1"># be dependent on your matplotlib backend.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;draw&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># plot parameters options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_labels_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x_labels_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_labels_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y_labels_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linestyle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_left</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subplots_adjust_left&#39;</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_right</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subplots_adjust_right&#39;</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_top</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subplots_adjust_top&#39;</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_bottom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subplots_adjust_bottom&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_vertical_labels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right_vertical_labels&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">one_tick_per_line</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;one_tick_per_line&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_y_UTC_label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_y_UTC_label&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveformPlotting.__del__"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.__del__.html#obspy.imaging.waveform.WaveformPlotting.__del__">[docs]</a>    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor closes the figure instance if it has been created by the</span>
<span class="sd">        class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;handle&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__get_merge_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
        <span class="n">tr_id</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">id</span>
        <span class="c1"># don&#39;t merge normal traces with previews</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">preview</span><span class="p">:</span>
                <span class="n">tr_id</span> <span class="o">+=</span> <span class="s1">&#39;preview&#39;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># don&#39;t merge traces with different processing steps</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">processing</span><span class="p">:</span>
                <span class="n">tr_id</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">processing</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">tr_id</span>

    <span class="k">def</span> <span class="nf">__get_mergable_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_merge_id</span><span class="p">(</span><span class="n">tr</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_id_key</span><span class="p">)</span>

    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="s2">&quot;&#39;plotWaveform&#39; has been renamed to &quot;</span>  <span class="c1"># noqa</span>
        <span class="s2">&quot;&#39;plot_waveform&#39;. Use that instead.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plotWaveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        DEPRECATED: &#39;plotWaveform&#39; has been renamed to</span>
<span class="sd">        &#39;plot_waveform&#39;. Use that instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_waveform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="WaveformPlotting.plot_waveform"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.plot_waveform.html#obspy.imaging.waveform.WaveformPlotting.plot_waveform">[docs]</a>    <span class="k">def</span> <span class="nf">plot_waveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a graph of any given ObsPy Stream object. It either saves the</span>
<span class="sd">        image directly to the file system or returns a binary image string.</span>

<span class="sd">        For all color values you can use legit HTML names, HTML hex strings</span>
<span class="sd">        (e.g. &#39;#eeefff&#39;) or you can pass an RGB tuple, where each of R, G, and</span>
<span class="sd">        B are in the range [0, 1]. You can also use single letters for basic</span>
<span class="sd">        built-in colors (&#39;b&#39; = blue, &#39;g&#39; = green, &#39;r&#39; = red, &#39;c&#39; = cyan,</span>
<span class="sd">        &#39;m&#39; = magenta, &#39;y&#39; = yellow, &#39;k&#39; = black, &#39;w&#39; = white) and gray shades</span>
<span class="sd">        can be given as a string encoding a float in the 0-1 range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="c1"># Setup the figure if not passed explicitly.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setup_figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_obj</span>
        <span class="c1"># Determine kind of plot and do the actual plotting.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;dayplot&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_day</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Adjust the subplot so there is always a fixed margin on every side</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;dayplot&#39;</span><span class="p">:</span>
            <span class="n">fract_y</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="n">fract_y2</span> <span class="o">=</span> <span class="mf">40.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="n">fract_x</span> <span class="o">=</span> <span class="mf">80.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_y</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">fract_y2</span><span class="p">,</span>
                                     <span class="n">left</span><span class="o">=</span><span class="n">fract_x</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fract_x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">DATELOCATOR_WARNING_MSG</span><span class="p">,</span>
                                    <span class="ne">UserWarning</span><span class="p">,</span> <span class="s2">&quot;matplotlib.dates&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="c1"># The following just serves as a unified way of saving and</span>
            <span class="c1"># displaying the plots.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span><span class="p">:</span>
                <span class="n">extra_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dpi&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
                              <span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_color</span><span class="p">,</span>
                              <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_color</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extra_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dpi&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
                              <span class="s1">&#39;transparent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparent</span><span class="p">,</span>
                              <span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">:</span>
                <span class="c1"># If format is set use it.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
                <span class="c1"># Otherwise use format from self.outfile or default to PNG.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Return a binary image string if not self.outfile but</span>
                <span class="c1"># self.format.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
                    <span class="n">imgdata</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imgdata</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
                    <span class="n">imgdata</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">imgdata</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_obj</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="WaveformPlotting.plot"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.plot.html#obspy.imaging.waveform.WaveformPlotting.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Traces showing one graph per Trace.</span>

<span class="sd">        Plots the whole time series for self.max_npts points and less. For more</span>
<span class="sd">        points it plots minmax values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stream_new</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Just remove empty traces.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">automerge</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
                <span class="n">stream_new</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">stream_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Generate sorted list of traces (no copy)</span>
            <span class="c1"># Sort order: id, starttime, endtime</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_mergable_ids</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">stream_new</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
                    <span class="n">tr_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_merge_id</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tr_id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                        <span class="c1"># does not copy the elements of the data array</span>
                        <span class="n">tr_ref</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tr_ref</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                            <span class="n">stream_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr_ref</span><span class="p">)</span>
                <span class="c1"># delete if empty list</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">stream_new</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">continue</span>
        <span class="c1"># If everything is lost in the process raise an Exception.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_new</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Nothing to plot&quot;</span><span class="p">)</span>
        <span class="c1"># Create helper variable to track ids and min/max/mean values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Loop over each Trace and call the appropriate plotting method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream_new</span><span class="p">):</span>
            <span class="c1"># Each trace needs to have the same sampling rate.</span>
            <span class="n">sampling_rates</span> <span class="o">=</span> <span class="p">{</span><span class="n">_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sampling_rates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All traces with the same id need to have the same &quot;</span> <span class="o">+</span> \
                      <span class="s2">&quot;sampling rate.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">sampling_rates</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sharex</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sharex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stream_new</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                      <span class="n">axisbg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="c1"># XXX: Also enable the minmax plotting for previews.</span>
            <span class="n">method_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_method</span>
            <span class="k">if</span> <span class="n">method_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span> <span class="o">*</span> <span class="n">sampling_rate</span> <span class="o">&gt;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_npts</span><span class="p">):</span>
                    <span class="n">method_</span> <span class="o">=</span> <span class="s2">&quot;fast&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">method_</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span>
            <span class="n">method_</span> <span class="o">=</span> <span class="n">method_</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">method_</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_straight</span><span class="p">(</span><span class="n">stream_new</span><span class="p">[</span><span class="n">_i</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method_</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_min_max</span><span class="p">(</span><span class="n">stream_new</span><span class="p">[</span><span class="n">_i</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid plot method: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">method_</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Set ticks.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_set_x_ticks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plot_set_y_ticks</span><span class="p">()</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_overlap_axvspan_legend</span><span class="p">()</span></div>

    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="s2">&quot;&#39;plotDay&#39; has been renamed to &quot;</span>  <span class="c1"># noqa</span>
        <span class="s2">&quot;&#39;plot_day&#39;. Use that instead.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plotDay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        DEPRECATED: &#39;plotDay&#39; has been renamed to</span>
<span class="sd">        &#39;plot_day&#39;. Use that instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_day</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="WaveformPlotting.plot_day"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.plot_day.html#obspy.imaging.waveform.WaveformPlotting.plot_day">[docs]</a>    <span class="k">def</span> <span class="nf">plot_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend the seismogram.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Merge and trim to pad.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">merge</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All traces need to be of the same id for a dayplot&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Get minmax array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dayplot_get_min_max_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Normalize array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dayplot_normalize_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Get timezone information. If none is given, use local time.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;time_offset&#39;</span><span class="p">,</span>
            <span class="nb">round</span><span class="p">((</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="o">-</span> <span class="n">UTCDateTime</span><span class="p">())</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;local time&#39;</span><span class="p">)</span>
        <span class="c1"># Try to guess how many steps are needed to advance one full time unit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">60</span> <span class="ow">and</span> <span class="mi">60</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">1800</span> <span class="ow">and</span> <span class="mi">3600</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>
        <span class="c1"># Otherwise use a maximum value of 10.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">intervals</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="n">intervals</span>
        <span class="c1"># Create axis to plot on.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axisbg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Adjust the subplots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_left</span><span class="p">,</span>
                                 <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_right</span><span class="p">,</span>
                                 <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_top</span><span class="p">,</span>
                                 <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplots_adjust_bottom</span><span class="p">)</span>
        <span class="c1"># Create x_value_array.</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
            <span class="c1"># Create offset array.</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">y_values</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">intervals</span> <span class="o">-</span> <span class="p">(</span><span class="n">_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c1"># Add min and max values.</span>
            <span class="n">y_values</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y_values</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Plot the values.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="n">_i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="c1"># Plot the scale, if required.</span>
        <span class="n">scale_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scale_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_dayplot_scale</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">scale_unit</span><span class="p">)</span>
        <span class="c1"># Set ranges.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">intervals</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
        <span class="c1"># Set ticks.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dayplot_set_y_ticks</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dayplot_set_x_ticks</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Choose to show grid but only on the x axis.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span><span class="p">,</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                              <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_linewidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Set the title of the plot.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_size</span><span class="p">)</span>
        <span class="c1"># Now try to plot some events.</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Potentially download some events with the help of obspy.clients.fdsn.</span>
        <span class="k">if</span> <span class="s2">&quot;min_magnitude&quot;</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">obspy.clients.fdsn</span> <span class="k">import</span> <span class="n">Client</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;EMSC&quot;</span><span class="p">)</span>
                <span class="n">events</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">starttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">,</span>
                                      <span class="n">endtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">,</span>
                                      <span class="n">minmagnitude</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="s2">&quot;min_magnitude&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">events</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Could not download the events because of &#39;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveformPlotting._plot_event"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._plot_event.html#obspy.imaging.waveform.WaveformPlotting._plot_event">[docs]</a>    <span class="k">def</span> <span class="nf">_plot_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to plot an event into the dayplot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">seed_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s2">&quot;preferred_origin&quot;</span><span class="p">):</span>
            <span class="c1"># Get the time from the preferred origin, alternatively the first</span>
            <span class="c1"># origin.</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">preferred_origin</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">:</span>
                    <span class="n">origin</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span>

            <span class="c1"># Do the same for the magnitude.</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">preferred_magnitude</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">:</span>
                    <span class="n">mag</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mag</span><span class="o">.</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag</span><span class="o">.</span><span class="n">magnitude_type</span><span class="p">)</span>

            <span class="n">region</span> <span class="o">=</span> <span class="n">FlinnEngdahl</span><span class="p">()</span><span class="o">.</span><span class="n">get_region</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                                               <span class="n">origin</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">region</span>
            <span class="k">if</span> <span class="n">mag</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="n">event</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Nothing to do if the event is not on the plot.</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Now find the position of the event in plot coordinates.</span>

        <span class="k">def</span> <span class="nf">time2xy</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
            <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
            <span class="n">int_frac</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
            <span class="n">event_frac</span> <span class="o">=</span> <span class="n">frac</span> <span class="o">/</span> <span class="n">int_frac</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">event_frac</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
            <span class="n">x_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">event_frac</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">event_frac</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="k">return</span> <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span>
        <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">time2xy</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="c1"># Some logic to get a somewhat sane positioning of the annotation</span>
            <span class="c1"># box and the arrow..</span>
            <span class="n">text_offset_x</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="n">text_offset_y</span> <span class="o">=</span> <span class="mf">1.00</span>
            <span class="c1"># Relpos determines the connection of the arrow on the box in</span>
            <span class="c1"># relative coordinates.</span>
            <span class="n">relpos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
            <span class="c1"># Arc strength is the amount of bending of the arrow.</span>
            <span class="n">arc_strength</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="k">if</span> <span class="n">x_pos</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">text_offset_x_sign</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                <span class="c1"># Arc sign determines the direction of bending.</span>
                <span class="n">arc_sign</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text_offset_x_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
                <span class="n">relpos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">arc_sign</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
            <span class="k">if</span> <span class="n">y_pos</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">text_offset_y_sign</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s2">&quot;bottom&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text_offset_y_sign</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
                <span class="k">if</span> <span class="n">arc_sign</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                    <span class="n">arc_sign</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arc_sign</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>

            <span class="c1"># Draw the annotation including box.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>
                        <span class="c1"># The position of the event.</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span>
                        <span class="c1"># The position of the text, offset depending on the</span>
                        <span class="c1"># previously calculated variables.</span>
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x_pos</span> <span class="o">+</span> <span class="n">text_offset_x_sign</span> <span class="o">*</span> <span class="n">text_offset_x</span><span class="p">,</span>
                                <span class="n">y_pos</span> <span class="o">+</span> <span class="n">text_offset_y_sign</span> <span class="o">*</span> <span class="n">text_offset_y</span><span class="p">),</span>
                        <span class="c1"># Everything in data coordinates.</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                        <span class="c1"># Set the text alignment.</span>
                        <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="c1"># Text box style.</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">),</span>
                        <span class="c1"># Arrow style</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                            <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3, rad=</span><span class="si">%s%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="n">arc_sign</span><span class="p">,</span> <span class="n">arc_strength</span><span class="p">),</span>
                            <span class="n">relpos</span><span class="o">=</span><span class="n">relpos</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># Draw the actual point. Use a marker with a star shape.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;picks&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="c1"># check that network/station/location matches</span>
            <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="o">.</span><span class="n">get_seed_string</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> \
               <span class="n">seed_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">time2xy</span><span class="p">(</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveformPlotting._plot_dayplot_scale"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._plot_dayplot_scale.html#obspy.imaging.waveform.WaveformPlotting._plot_dayplot_scale">[docs]</a>    <span class="k">def</span> <span class="nf">_plot_dayplot_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the dayplot scale if requested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="n">top</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">top</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">very_right</span> <span class="o">=</span> <span class="n">right</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">)</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">),</span>
            <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">),</span>
            <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">),</span>
            <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">),</span>
            <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">middle</span><span class="p">),</span>
            <span class="p">(</span><span class="n">very_right</span><span class="p">,</span> <span class="n">middle</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                 <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                 <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                 <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                 <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                 <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span>
                 <span class="p">]</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">patch</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_factor</span>
        <span class="c1"># Manually determine the number of digits after decimal</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">fmt_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">factor</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">fmt_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">very_right</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span>
            <span class="n">fmt_string</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalization_factor</span><span class="p">,</span> <span class="n">unit</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__plot_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just plots the data samples in the self.stream. Useful for smaller</span>
<span class="sd">        datasets up to around 1000000 samples (depending on the machine on</span>
<span class="sd">        which it&#39;s being run).</span>

<span class="sd">        Slow and high memory consumption for large datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># trace argument seems to actually be a list of traces..</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_overlap_axvspans</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
            <span class="c1"># Check if it is a preview file and adjust accordingly.</span>
            <span class="c1"># XXX: Will look weird if the preview file is too small.</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;preview&#39;</span><span class="p">):</span>
                <span class="c1"># Mask the gaps.</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
                <span class="c1"># Recreate the min_max scene.</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>
                <span class="n">old_time_range</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="c1"># The times are not supposed to change.</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">old_time_range</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
                <span class="c1"># use seconds of relative sample times and shift by trace&#39;s</span>
                <span class="c1"># start time, which was set relative to `reftime`.</span>
                <span class="n">x_values</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">times</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftime</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># convert seconds of relative sample times to days and add</span>
                <span class="c1"># start time of trace.</span>
                <span class="n">x_values</span> <span class="o">=</span> <span class="p">((</span><span class="n">trace</span><span class="o">.</span><span class="n">times</span><span class="p">()</span> <span class="o">/</span> <span class="n">SECONDS_PER_DAY</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">date2num</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">datetime</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="c1"># Write to self.ids</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;preview&#39;</span><span class="p">):</span>
            <span class="n">tr_id</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s1">&#39; [preview]&#39;</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">):</span>
            <span class="n">tr_id</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr_id</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__plot_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the data using a min/max approach that calculated the minimum and</span>
<span class="sd">        maximum values of each &quot;pixel&quot; and then plots only these values. Works</span>
<span class="sd">        much faster with large data sets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_overlap_axvspans</span><span class="p">(</span><span class="n">Stream</span><span class="p">(</span><span class="n">trace</span><span class="p">),</span> <span class="n">ax</span><span class="p">)</span>
        <span class="c1"># Some variables to help calculate the values.</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
        <span class="c1"># The same trace will always have the same sampling_rate.</span>
        <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>
        <span class="c1"># width of x axis in seconds</span>
        <span class="n">x_width</span> <span class="o">=</span> <span class="n">endtime</span> <span class="o">-</span> <span class="n">starttime</span>
        <span class="c1"># normal plots have x-axis in days, so convert x_width to seconds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="n">x_width</span> <span class="o">=</span> <span class="n">x_width</span> <span class="o">*</span> <span class="n">SECONDS_PER_DAY</span>
        <span class="c1"># number of samples that get represented by one min-max pair</span>
        <span class="n">pixel_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x_width</span> <span class="o">*</span> <span class="n">sampling_rate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>
        <span class="c1"># Loop over all the traces. Do not merge them as there are many samples</span>
        <span class="c1"># and therefore merging would be slow.</span>
        <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
            <span class="n">trace_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">pixel_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trace_length</span> <span class="o">//</span> <span class="n">pixel_length</span><span class="p">)</span>
            <span class="n">remaining_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trace_length</span> <span class="o">%</span> <span class="n">pixel_length</span><span class="p">)</span>
            <span class="n">remaining_seconds</span> <span class="o">=</span> <span class="n">remaining_samples</span> <span class="o">/</span> <span class="n">sampling_rate</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
                <span class="n">remaining_seconds</span> <span class="o">/=</span> <span class="n">SECONDS_PER_DAY</span>
            <span class="c1"># Reference to new data array which does not copy data but can be</span>
            <span class="c1"># reshaped.</span>
            <span class="k">if</span> <span class="n">remaining_samples</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">remaining_samples</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pixel_count</span><span class="p">,</span> <span class="n">pixel_length</span><span class="p">)</span>
            <span class="n">min_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
            <span class="n">max_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
            <span class="c1"># Calculate extreme_values and put them into new array.</span>
            <span class="k">if</span> <span class="n">remaining_samples</span><span class="p">:</span>
                <span class="n">extreme_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">pixel_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                <span class="n">extreme_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_</span>
                <span class="n">extreme_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_</span>
                <span class="n">extreme_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">remaining_samples</span><span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
                <span class="n">extreme_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">remaining_samples</span><span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extreme_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">pixel_count</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                <span class="n">extreme_values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_</span>
                <span class="n">extreme_values</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_</span>
            <span class="c1"># Finally plot the data.</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">remaining_samples</span><span class="p">:</span>
                <span class="c1"># the last minmax pair is inconsistent regarding x-spacing</span>
                <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">remaining_seconds</span><span class="p">,</span>
                                       <span class="n">num</span><span class="o">=</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x_values</span><span class="p">,</span> <span class="p">[</span><span class="n">end</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">extreme_values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="c1"># remember xlim state and add callback to warn when zooming in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_xrange</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span> <span class="o">-</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_plot_xrange_dangerous</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;xlim_changed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warn_on_xaxis_zoom</span><span class="p">)</span>
        <span class="c1"># set label, write to self.ids</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;label&#39;</span><span class="p">):</span>
            <span class="n">tr_id</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr_id</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__plot_set_x_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Goes through all axes in pyplot and sets time ticks on the x axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Loop over all but last axes.</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># set bottom most axes:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis_date</span><span class="p">()</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="n">AutoDateLocator</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">locator</span><span class="o">.</span><span class="n">intervald</span><span class="p">[</span><span class="n">MINUTELY</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
            <span class="n">locator</span><span class="o">.</span><span class="n">intervald</span><span class="p">[</span><span class="n">SECONDLY</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ObsPyAutoDateFormatter</span><span class="p">(</span><span class="n">locator</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span>
                 <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tick_rotation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__plot_set_y_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">equal_scale</span><span class="p">:</span>
            <span class="n">ylims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">])</span>
            <span class="n">yranges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">yrange_max</span> <span class="o">=</span> <span class="n">yranges</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">yrange_paddings</span> <span class="o">=</span> <span class="o">-</span><span class="n">yranges</span> <span class="o">+</span> <span class="n">yrange_max</span>
            <span class="n">ylims</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">yrange_paddings</span><span class="p">[:]</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ylims</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">yrange_paddings</span><span class="p">[:]</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ylims_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">ylims</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylims_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">):</span>
            <span class="c1"># Set the title of each plot.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">_i</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">),</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__dayplot_get_min_max_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a Stream object and calculates the min and max values for each</span>
<span class="sd">        pixel in the dayplot.</span>

<span class="sd">        Writes a three dimensional array. The first axis is the step, i.e</span>
<span class="sd">        number of trace, the second is the pixel in that step and the third</span>
<span class="sd">        contains the minimum and maximum value of the pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Helper variables for easier access.</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trace_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Samples per interval.</span>
        <span class="n">spi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">*</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">)</span>
        <span class="c1"># Check the approximate number of samples per pixel and raise</span>
        <span class="c1"># error as fit.</span>
        <span class="n">spp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">spi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="n">spp</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Too few samples to use dayplot with the given arguments.</span>
<span class="s2">            Adjust your arguments or use a different plotting method.</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Number of intervals plotted.</span>
        <span class="n">noi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">trace_length</span><span class="p">)</span> <span class="o">/</span> <span class="n">spi</span>
        <span class="n">inoi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">noi</span><span class="p">))</span>
        <span class="c1"># Plot an extra interval if at least 2 percent of the last interval</span>
        <span class="c1"># will actually contain data. Do it this way to lessen floating point</span>
        <span class="c1"># inaccuracies.</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">noi</span> <span class="o">-</span> <span class="n">inoi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2E-2</span><span class="p">:</span>
            <span class="n">noi</span> <span class="o">=</span> <span class="n">inoi</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">noi</span> <span class="o">=</span> <span class="n">inoi</span>

        <span class="c1"># Adjust data. Fill with masked values in case it is necessary.</span>
        <span class="n">number_of_samples</span> <span class="o">=</span> <span class="n">noi</span> <span class="o">*</span> <span class="n">spi</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">number_of_samples</span> <span class="o">-</span> <span class="n">trace_length</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="n">number_of_samples</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">create_empty_data_chunk</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)])</span>

        <span class="c1"># Create array for min/max values. Use masked arrays to handle gaps.</span>
        <span class="n">extreme_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">noi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">noi</span><span class="p">,</span> <span class="n">spi</span><span class="p">)</span>

        <span class="n">ispp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spp</span><span class="p">)</span>
        <span class="n">fspp</span> <span class="o">=</span> <span class="n">spp</span> <span class="o">%</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">fspp</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">spi</span> <span class="o">-</span> <span class="n">ispp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

        <span class="c1"># Loop over each interval to avoid larger errors towards the end.</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">noi</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">delta</span><span class="p">:</span>
                <span class="n">cur_interval</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">_i</span><span class="p">][:</span><span class="o">-</span><span class="n">delta</span><span class="p">]</span>
                <span class="n">rest</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">_i</span><span class="p">][</span><span class="o">-</span><span class="n">delta</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_interval</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span>
            <span class="n">cur_interval</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">ispp</span><span class="p">)</span>
            <span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_interval</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_interval</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Add the rest.</span>
            <span class="k">if</span> <span class="n">delta</span><span class="p">:</span>
                <span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                <span class="n">rest</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                <span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">extreme_values</span><span class="p">[</span><span class="n">_i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                                <span class="n">rest</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="c1"># Set class variable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">=</span> <span class="n">extreme_values</span>

    <span class="k">def</span> <span class="nf">__dayplot_normalize_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalizes all values in the 3 dimensional array, so that the minimum</span>
<span class="sd">        value will be 0 and the maximum value will be 1.</span>

<span class="sd">        It will also convert all values to floats.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert to native floats.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">calib</span>
        <span class="c1"># Make sure that the mean value is at 0</span>
        <span class="c1"># raises underflow warning / error for numpy 1.9</span>
        <span class="c1"># even though mean is 0.09</span>
        <span class="c1"># self.extreme_values -= self.extreme_values.mean()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># Scale so that 99.5 % of the data will fit the given range.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertical_scaling_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">percentile_delta</span> <span class="o">=</span> <span class="mf">0.005</span>
            <span class="n">max_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
            <span class="n">min_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
            <span class="c1"># Remove masked values.</span>
            <span class="n">max_values</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">min_values</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_values</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">percentile_delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span><span class="p">)</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">max_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentile_delta</span> <span class="o">*</span> <span class="n">length</span><span class="p">)</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">min_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1"># Exact fit.</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertical_scaling_range</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="c1"># Fit with custom range.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">min_val</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertical_scaling_range</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Normalization factor.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">max_val</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="c1"># Scale from 0 to 1.</span>
        <span class="c1"># raises underflow warning / error for numpy 1.9</span>
        <span class="c1"># even though normalization_factor is 2.5</span>
        <span class="c1"># self.extreme_values = self.extreme_values / \</span>
        <span class="c1">#     self._normalization_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">*</span> \
            <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span> <span class="o">+=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">__dayplot_set_x_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the xticks for the dayplot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">localization_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;localization_dict&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">localization_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span>
        <span class="n">localization_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">)</span>
        <span class="n">localization_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;hours&#39;</span><span class="p">)</span>
        <span class="n">localization_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;time in&#39;</span><span class="p">,</span> <span class="s1">&#39;time in&#39;</span><span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># Check whether it is sec/mins/hours and convert to a universal unit.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">240</span><span class="p">:</span>
            <span class="n">time_type</span> <span class="o">=</span> <span class="n">localization_dict</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">]</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">24000</span><span class="p">:</span>
            <span class="n">time_type</span> <span class="o">=</span> <span class="n">localization_dict</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">]</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_type</span> <span class="o">=</span> <span class="n">localization_dict</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">]</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">/</span> <span class="mi">3600</span>
        <span class="n">count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Hardcode some common values. The plus one is intentional. It had</span>
        <span class="c1"># hardly any performance impact and enhances readability.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">90</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">180</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">300</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">360</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">==</span> <span class="mi">720</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># Otherwise run some kind of autodetection routine.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span>
            <span class="c1"># Up to 15 time units and if it&#39;s a full number, show every unit.</span>
            <span class="k">if</span> <span class="n">time_value</span> <span class="o">&lt;=</span> <span class="mi">15</span> <span class="ow">and</span> <span class="n">time_value</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">time_value</span>
            <span class="c1"># Otherwise determine whether they are divisible for numbers up to</span>
            <span class="c1"># 15. If a number is not divisible just show 10 units.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">time_value</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="n">_i</span>
                        <span class="k">break</span>
            <span class="c1"># Show at least 5 ticks.</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c1"># Everything can be overwritten by user-specified number of ticks.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_ticks</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_ticks</span>
        <span class="c1"># Calculate and set ticks.</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_i</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">time_value</span><span class="p">,</span> <span class="n">count</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tick_rotation</span><span class="p">,</span>
                                     <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_labels_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localization_dict</span><span class="p">[</span><span class="s1">&#39;time in&#39;</span><span class="p">],</span>
                                           <span class="n">time_type</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_labels_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dayplot_set_y_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the yticks for the dayplot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Only display all ticks if there are five or less steps or if option</span>
        <span class="c1"># is set.</span>
        <span class="k">if</span> <span class="n">intervals</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_tick_per_line</span><span class="p">:</span>
            <span class="n">tick_steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">intervals</span><span class="p">))</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">-=</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tick_steps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">intervals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">ticks</span> <span class="o">-=</span> <span class="mf">0.5</span>

        <span class="c1"># Complicated way to calculate the label of</span>
        <span class="c1"># the y-axis showing the second time zone.</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%+i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;UTC (</span><span class="si">%s</span><span class="s2"> = UTC </span><span class="si">%s</span><span class="s2"> </span><span class="si">%02i</span><span class="s2">:</span><span class="si">%02i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">sign</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_offset</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span>
        <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+</span> <span class="n">_i</span> <span class="o">*</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tick_format</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">tick_steps</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_labels_size</span><span class="p">)</span>
        <span class="c1"># Show time zone label if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_y_UTC_label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_vertical_labels</span><span class="p">:</span>
            <span class="n">yrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twin_x</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twin_x</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
            <span class="n">y_ticklabels_twin</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+</span> <span class="p">(</span><span class="n">_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tick_format</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">tick_steps</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twin_x</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">y_ticklabels_twin</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_labels_size</span><span class="p">)</span>

    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="s2">&quot;&#39;plotSection&#39; has been renamed to &quot;</span>  <span class="c1"># noqa</span>
        <span class="s2">&quot;&#39;plot_section&#39;. Use that instead.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">plotSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        DEPRECATED: &#39;plotSection&#39; has been renamed to</span>
<span class="sd">        &#39;plot_section&#39;. Use that instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="WaveformPlotting.plot_section"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting.plot_section.html#obspy.imaging.waveform.WaveformPlotting.plot_section">[docs]</a>    <span class="k">def</span> <span class="nf">plot_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots multiple waveforms as a record section on a single plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialise data and plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sect_init_traces</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sect_init_plot</span><span class="p">()</span>

        <span class="c1"># Setting up line properties</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">names_colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_color</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">):</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_color</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)]</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

            <span class="n">legend_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">legend_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names_colors</span><span class="p">):</span>
                <span class="n">legend_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
                                  <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">))</span>
                <span class="n">legend_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_lines</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">)</span>

        <span class="c1"># Setting up plot axes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_lim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_lim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span><span class="p">)</span>
        <span class="c1"># Set up offset ticks</span>
        <span class="n">tick_min</span><span class="p">,</span> <span class="n">tick_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_offset_lim</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">tick_min</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tick_min</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span> <span class="o">-</span> <span class="p">(</span><span class="n">tick_min</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span><span class="p">)</span>
        <span class="c1"># Define tick vector for offset axis</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_plot_dx</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Too many ticks! Try changing plot_dx.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="c1"># Setting up tick labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_label</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_label</span><span class="p">(</span><span class="s1">&#39;Offset [km]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_label</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Offset []&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="c1"># Limit time axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_time_lim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_max</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_recordstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_lim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_recordstart</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_recordlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_lim</span><span class="p">(</span>
                <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sect_recordlength</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_lim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Invert time axis if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_timedown</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="c1"># Draw grid on xaxis only</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_color</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_linewidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_axis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__sect_init_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arrange the trace data used for plotting.</span>

<span class="sd">        If necessary the data is resampled before</span>
<span class="sd">        being collected in a continuous list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract distances from st[].stats.distance</span>
        <span class="c1"># or from st.[].stats.coordinates.latitude...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span><span class="p">:</span>
            <span class="c1"># Define offset in km from tr.stats.distance</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">distance</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;trace.stats.distance undefined &#39;</span> <span class="o">+</span>\
                      <span class="s1">&#39;(set before plotting [in m], &#39;</span> <span class="o">+</span>\
                      <span class="s1">&#39;or use the ev_coords argument)&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define offset as degree from epicenter</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">locations2degrees</span><span class="p">(</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ev_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ev_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Define latitude/longitude in trace.stats.&#39;</span> <span class="o">+</span> \
                    <span class="s1">&#39;coordinates and ev_coord. See documentation.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Define minimum and maximum offsets</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_min</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_offset_max</span>
        <span class="c1"># Reduce data to indexes within offset_min/max</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">[</span><span class="n">tr</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span><span class="p">]</span>
        <span class="c1"># Use km on distance axis, if not degrees</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_dist_degree</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span> <span class="o">/=</span> <span class="mf">1e3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span> <span class="o">/=</span> <span class="mf">1e3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span> <span class="o">/=</span> <span class="mf">1e3</span>
        <span class="c1"># Number of traces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">)</span>
        <span class="c1"># Arranging trace data in single list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Maximum counts, npts, starttime and delta of each selected trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_starttimes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_max_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_npts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">)</span>
        <span class="c1"># TODO dynamic DATA_MAXLENGTH according to dpi</span>
        <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_npts</span><span class="p">:</span>
                <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_npts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
            <span class="c1"># Initialising trace stats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_starttimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_max_count</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_npts</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_delta</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_npts</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span>
        <span class="c1"># Init time vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sect_init_time</span><span class="p">()</span>
        <span class="c1"># Init trace colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sect_init_color</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__sect_scale_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The traces have to be scaled to fit between 0-1., each trace</span>
<span class="sd">        gets distance-range/num_traces space. adjustable by scale=1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sect_scale</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offset_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset_min</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_user_scale</span> <span class="o">/</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__sect_init_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the time vector for each trace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reftime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_reftime</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_starttimes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_npts</span><span class="p">[</span><span class="n">_tr</span><span class="p">])</span> <span class="o">+</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_starttimes</span><span class="p">[</span><span class="n">_tr</span><span class="p">]</span> <span class="o">-</span> <span class="n">reftime</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_delta</span><span class="p">[</span><span class="n">_tr</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">[</span><span class="n">_tr</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_vred</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_time_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__sect_init_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the color of each trace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;network&#39;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span> <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;station&#39;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;channel&#39;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span> <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sect_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
            <span class="k">return</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Paired&#39;</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_color</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">colors</span><span class="p">))}</span>

    <span class="k">def</span> <span class="nf">__sect_fraction_to_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to return fractions from offsets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">fraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__sect_init_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function initialises plot all the illustration is done by</span>
<span class="sd">        self.plot_section()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="c1"># Calculate normalizing factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sect_normalize_traces</span><span class="p">()</span>
        <span class="c1"># Calculate scaling factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sect_scale_traces</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ax.plot() preferred over containers</span>
        <span class="k">for</span> <span class="n">_tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">):</span>
            <span class="c1"># Scale, normalize and shift traces by offset for plotting</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_data</span><span class="p">[</span><span class="n">_tr</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_normfac</span><span class="p">[</span><span class="n">_tr</span><span class="p">]</span> <span class="o">*</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_sect_scale</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tr_offsets</span><span class="p">[</span><span class="n">_tr</span><span class="p">])</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tr_times</span><span class="p">[</span><span class="n">_tr</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">+=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">+=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sect_orientiation &#39;</span><span class="si">%s</span><span class="s2">&#39; is not &quot;</span>
                                          <span class="s2">&quot;valid.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span><span class="p">)</span>

        <span class="c1"># Set correct axes orientation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_offset_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticklabels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_axis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_time_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_set_xlim_from_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;bottom&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;top&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_offset_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_offset_ticklabels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_axis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_lim</span> <span class="o">=</span> <span class="n">_set_xlim_from_ylim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_time_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_time_label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sect_orientiation &#39;</span><span class="si">%s</span><span class="s2">&#39; is not &quot;</span>
                                      <span class="s2">&quot;valid.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_orientation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">__sect_normalize_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This helper function normalizes the traces</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tr_normfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_norm_method</span> <span class="o">==</span> <span class="s1">&#39;trace&#39;</span><span class="p">:</span>
            <span class="c1"># Normalize against each traces&#39; maximum</span>
            <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_num</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tr_normfac</span><span class="p">[</span><span class="n">tr</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_data</span><span class="p">[</span><span class="n">tr</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_norm_method</span> <span class="o">==</span> <span class="s1">&#39;stream&#39;</span><span class="p">:</span>
            <span class="c1"># Normalize the whole stream</span>
            <span class="n">tr_max_count_glob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tr_max_count</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tr_normfac</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">tr_max_count_glob</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Define a normalisation method. Valid normalisations&#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;are </span><span class="se">\&#39;</span><span class="s1">trace</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">stream</span><span class="se">\&#39;</span><span class="s1">. See documentation.&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setup_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The design and look of the whole plot to be produced.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="c1"># Setup figure and axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
                              <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
                                       <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">))</span>
        <span class="c1"># XXX: Figure out why this is needed sometimes.</span>
        <span class="c1"># Set size and dpi.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_dpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">):</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">label</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Time in seconds relative to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="n">_timestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reftime</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;dayplot&#39;</span><span class="p">:</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;section&#39;</span><span class="p">:</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="s1">&#39;Network: </span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">] - (</span><span class="si">%i</span><span class="s1"> traces / </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
                 <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">),</span> <span class="n">_timestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suptitle</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  -  </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_timestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime</span><span class="p">),</span>
                                      <span class="n">_timestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endtime</span><span class="p">))</span>
        <span class="c1"># add suptitle</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mf">15.0</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">suptitle</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span>
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="WaveformPlotting._warn_on_xaxis_zoom"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._warn_on_xaxis_zoom.html#obspy.imaging.waveform.WaveformPlotting._warn_on_xaxis_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">_warn_on_xaxis_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to be used as a callback on `method=fast`, &quot;minmax&quot;-type plots</span>
<span class="sd">        to warn the user when zooming into the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_xrange</span><span class="p">:</span>
            <span class="n">dangerous</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dangerous</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">dangerous</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_plot_xrange_dangerous</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_zoomlevel_warning_text</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_plot_xrange_dangerous</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dangerous</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_zoomlevel_warning_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_plot_xrange_dangerous</span> <span class="o">=</span> <span class="n">dangerous</span></div>

<div class="viewcode-block" id="WaveformPlotting._add_zoomlevel_warning_text"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._add_zoomlevel_warning_text.html#obspy.imaging.waveform.WaveformPlotting._add_zoomlevel_warning_text">[docs]</a>    <span class="k">def</span> <span class="nf">_add_zoomlevel_warning_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_warning_text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">MINMAX_ZOOMLEVEL_WARNING_TEXT</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveformPlotting._remove_zoomlevel_warning_text"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._remove_zoomlevel_warning_text.html#obspy.imaging.waveform.WaveformPlotting._remove_zoomlevel_warning_text">[docs]</a>    <span class="k">def</span> <span class="nf">_remove_zoomlevel_warning_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_warning_text</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">texts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minmax_warning_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minmax_warning_text</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="WaveformPlotting._draw_overlap_axvspans"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._draw_overlap_axvspans.html#obspy.imaging.waveform.WaveformPlotting._draw_overlap_axvspans">[docs]</a>    <span class="k">def</span> <span class="nf">_draw_overlap_axvspans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">get_gaps</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_to_xvalue</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overlap_axvspan</span> <span class="o">=</span> \
                <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></div>

<div class="viewcode-block" id="WaveformPlotting._draw_overlap_axvspan_legend"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._draw_overlap_axvspan_legend.html#obspy.imaging.waveform.WaveformPlotting._draw_overlap_axvspan_legend">[docs]</a>    <span class="k">def</span> <span class="nf">_draw_overlap_axvspan_legend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_overlap_axvspan&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_overlap_axvspan</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Overlaps&quot;</span><span class="p">],</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="WaveformPlotting._time_to_xvalue"><a class="viewcode-back" href="../../../packages/autogen/obspy.imaging.waveform.WaveformPlotting._time_to_xvalue.html#obspy.imaging.waveform.WaveformPlotting._time_to_xvalue">[docs]</a>    <span class="k">def</span> <span class="nf">_time_to_xvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftime</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">date2num</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">exclude_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a> &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, lafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Kufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaim, Sbastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clment</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Khler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>