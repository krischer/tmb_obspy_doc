<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.mseed.core &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.mseed.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MSEED bindings to ObsPy core module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">native_str</span>

<span class="kn">import</span> <span class="nn">ctypes</span> <span class="k">as</span> <span class="nn">C</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="k">import</span> <span class="n">pack</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">obspy.core.util</span> <span class="k">import</span> <span class="n">NATIVE_BYTEORDER</span>
<span class="kn">from</span> <span class="nn">obspy.core.util.deprecation_helpers</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">DynamicAttributeImportRerouteModule</span><span class="p">,</span> <span class="n">ObsPyDeprecationWarning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">InternalMSEEDReadingError</span><span class="p">,</span> <span class="n">InternalMSEEDReadingWarning</span>
<span class="kn">from</span> <span class="nn">.headers</span> <span class="k">import</span> <span class="p">(</span><span class="n">DATATYPES</span><span class="p">,</span> <span class="n">ENCODINGS</span><span class="p">,</span> <span class="n">HPTERROR</span><span class="p">,</span> <span class="n">HPTMODULUS</span><span class="p">,</span> <span class="n">SAMPLETYPE</span><span class="p">,</span>
                      <span class="n">SEED_CONTROL_HEADERS</span><span class="p">,</span> <span class="n">UNSUPPORTED_ENCODINGS</span><span class="p">,</span>
                      <span class="n">VALID_CONTROL_HEADERS</span><span class="p">,</span> <span class="n">VALID_RECORD_LENGTHS</span><span class="p">,</span> <span class="n">Selections</span><span class="p">,</span>
                      <span class="n">SelectTime</span><span class="p">,</span> <span class="n">Blkt100S</span><span class="p">,</span> <span class="n">Blkt1001S</span><span class="p">,</span> <span class="n">clibmseed</span><span class="p">)</span>


<div class="viewcode-block" id="_is_mseed"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core._is_mseed.html#obspy.io.mseed.core._is_mseed">[docs]</a><span class="k">def</span> <span class="nf">_is_mseed</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a file is Mini-SEED/full SEED or not.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: Mini-SEED/full SEED file to be checked.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    :return: ``True`` if a Mini-SEED file.</span>

<span class="sd">    This method only reads the first seven bytes of the file and checks</span>
<span class="sd">    whether its a Mini-SEED or full SEED file.</span>

<span class="sd">    It also is true for fullSEED files because libmseed can read the data</span>
<span class="sd">    part of fullSEED files. If the method finds a fullSEED file it also</span>
<span class="sd">    checks if it has a data part and returns False otherwise.</span>

<span class="sd">    Thus it cannot be used to validate a Mini-SEED or SEED file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Open filehandler or use an existing file like object.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">__is_mseed</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">initial_pos</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;getbuffer&quot;</span><span class="p">):</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">()</span><span class="o">.</span><span class="n">nbytes</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span><span class="o">.</span><span class="n">st_size</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">_p</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">filename</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">filename</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">_p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">__is_mseed</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_size</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Reset pointer.</span>
            <span class="n">filename</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">initial_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="__is_mseed"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core.__is_mseed.html#obspy.io.mseed.core.__is_mseed">[docs]</a><span class="k">def</span> <span class="nf">__is_mseed</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">file_size</span><span class="p">):</span>  <span class="c1"># NOQA</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal version of _is_mseed working only with open file-like object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="c1"># File has less than 7 characters</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Sequence number must contains a single number or be empty</span>
    <span class="n">seqnr</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">seqnr</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">seqnr</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="c1"># This might be a completely empty sequence - in that case jump 128</span>
        <span class="c1"># bytes and try again.</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_t</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_t</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">__is_mseed</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check for any valid control header types.</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;M&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot; &quot;</span><span class="p">:</span>
        <span class="c1"># If empty, it might be a noise record. Check the rest of 128 bytes</span>
        <span class="c1"># (min record size) and try again.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_t</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">128</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_t</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">__is_mseed</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">file_size</span><span class="o">=</span><span class="n">file_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check if Full-SEED</span>
    <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;V&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Parse the whole file and check whether it has has a data record.</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># search for blockettes 010 or 008</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;010&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;008&#39;</span><span class="p">]:</span>
            <span class="k">break</span>
        <span class="c1"># the next for bytes are the record length</span>
        <span class="c1"># as we are currently at position 7 (fp.read(3) fp.read(4))</span>
        <span class="c1"># we need to subtract this first before we seek</span>
        <span class="c1"># to the appropriate position</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">_i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># break after 3 cycles</span>
        <span class="k">if</span> <span class="n">_i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Try to get a record length.</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">record_length</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Jump to the second record.</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">record_length</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Loop over all records and return True if one record is a data</span>
    <span class="c1"># record</span>
    <span class="k">while</span> <span class="n">fp</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;M&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">record_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="_read_mseed"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core._read_mseed.html#obspy.io.mseed.core._read_mseed">[docs]</a><span class="k">def</span> <span class="nf">_read_mseed</span><span class="p">(</span><span class="n">mseed_object</span><span class="p">,</span> <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">sourcename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reclen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">header_byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a Mini-SEED file and returns a Stream object.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function should NOT be called directly, it registers via the</span>
<span class="sd">        ObsPy :func:`~obspy.core.stream.read` function, call this instead.</span>

<span class="sd">    :param mseed_object: Filename or open file like object that contains the</span>
<span class="sd">        binary Mini-SEED data. Any object that provides a read() method will be</span>
<span class="sd">        considered to be a file like object.</span>
<span class="sd">    :type starttime: :class:`~obspy.core.utcdatetime.UTCDateTime`</span>
<span class="sd">    :param starttime: Only read data samples after or at the start time.</span>
<span class="sd">    :type endtime: :class:`~obspy.core.utcdatetime.UTCDateTime`</span>
<span class="sd">    :param endtime: Only read data samples before or at the end time.</span>
<span class="sd">    :param headonly: Determines whether or not to unpack the data or just</span>
<span class="sd">        read the headers.</span>
<span class="sd">    :type sourcename: str</span>
<span class="sd">    :param sourcename: Only read data with matching SEED ID (can contain</span>
<span class="sd">        wildcards &quot;?&quot; and &quot;*&quot;, e.g. &quot;BW.UH2.*&quot; or &quot;*.??Z&quot;). Defaults to</span>
<span class="sd">        ``None``.</span>
<span class="sd">    :param reclen: If it is None, it will be automatically determined for every</span>
<span class="sd">        record. If it is known, just set it to the record length in bytes which</span>
<span class="sd">        will increase the reading speed slightly.</span>
<span class="sd">    :type details: bool, optional</span>
<span class="sd">    :param details: If ``True`` read additional information: timing quality</span>
<span class="sd">        and availability of calibration information.</span>
<span class="sd">        Note, that the traces are then also split on these additional</span>
<span class="sd">        information. Thus the number of traces in a stream will change.</span>
<span class="sd">        Details are stored in the mseed stats AttribDict of each trace.</span>
<span class="sd">        ``False`` specifies for both cases, that this information is not</span>
<span class="sd">        available. ``blkt1001.timing_quality`` specifies the timing quality</span>
<span class="sd">        from 0 to 100 [%]. ``calibration_type`` specifies the type of available</span>
<span class="sd">        calibration information blockettes:</span>

<span class="sd">        - ``1``: Step Calibration (Blockette 300)</span>
<span class="sd">        - ``2``: Sine Calibration (Blockette 310)</span>
<span class="sd">        - ``3``: Pseudo-random Calibration (Blockette 320)</span>
<span class="sd">        - ``4``: Generic Calibration  (Blockette 390)</span>
<span class="sd">        - ``-2``: Calibration Abort (Blockette 395)</span>

<span class="sd">    :type header_byteorder: int or str, optional</span>
<span class="sd">    :param header_byteorder: Must be either ``0`` or ``&#39;&lt;&#39;`` for LSBF or</span>
<span class="sd">        little-endian, ``1`` or ``&#39;&gt;&#39;`` for MBF or big-endian. ``&#39;=&#39;`` is the</span>
<span class="sd">        native byte order. Used to enforce the header byte order. Useful in</span>
<span class="sd">        some rare cases where the automatic byte order detection fails.</span>

<span class="sd">    .. rubric:: Example</span>

<span class="sd">    &gt;&gt;&gt; from obspy import read</span>
<span class="sd">    &gt;&gt;&gt; st = read(&quot;/path/to/two_channels.mseed&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(st)  # doctest: +ELLIPSIS</span>
<span class="sd">    2 Trace(s) in Stream:</span>
<span class="sd">    BW.UH3..EHE | 2010-06-20T00:00:00.279999Z - ... | 200.0 Hz, 386 samples</span>
<span class="sd">    BW.UH3..EHZ | 2010-06-20T00:00:00.279999Z - ... | 200.0 Hz, 386 samples</span>

<span class="sd">    &gt;&gt;&gt; from obspy import UTCDateTime</span>
<span class="sd">    &gt;&gt;&gt; st = read(&quot;/path/to/two_channels.mseed&quot;,</span>
<span class="sd">    ...           starttime=UTCDateTime(&quot;2010-06-20T00:00:01&quot;),</span>
<span class="sd">    ...           sourcename=&quot;*.?HZ&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(st)  # doctest: +ELLIPSIS</span>
<span class="sd">    1 Trace(s) in Stream:</span>
<span class="sd">    BW.UH3..EHZ | 2010-06-20T00:00:00.999999Z - ... | 200.0 Hz, 242 samples</span>

<span class="sd">    Read with ``details=True`` to read more details of the file if present.</span>

<span class="sd">    &gt;&gt;&gt; st = read(&quot;/path/to/timingquality.mseed&quot;, details=True)</span>
<span class="sd">    &gt;&gt;&gt; print(st[0].stats.mseed.blkt1001.timing_quality)</span>
<span class="sd">    55</span>

<span class="sd">    ``False`` means that the necessary information could not be found in the</span>
<span class="sd">    file.</span>

<span class="sd">    &gt;&gt;&gt; print(st[0].stats.mseed.calibration_type)</span>
<span class="sd">    False</span>

<span class="sd">    Note that each change in timing quality from record to record may trigger a</span>
<span class="sd">    new Trace object to be created so the Stream object may contain many Trace</span>
<span class="sd">    objects if ``details=True`` is used.</span>

<span class="sd">    &gt;&gt;&gt; print(len(st))</span>
<span class="sd">    101</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Parse the headonly and reclen flags.</span>
    <span class="k">if</span> <span class="n">headonly</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">unpack_data</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unpack_data</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">reclen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reclen</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">reclen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_RECORD_LENGTHS</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid record length. Autodetection will be used.&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">reclen</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Determine the byte order.</span>
    <span class="k">if</span> <span class="n">header_byteorder</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
        <span class="n">header_byteorder</span> <span class="o">=</span> <span class="n">NATIVE_BYTEORDER</span>

    <span class="k">if</span> <span class="n">header_byteorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">header_byteorder</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">header_byteorder</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">]:</span>
        <span class="n">header_byteorder</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">header_byteorder</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">]:</span>
        <span class="n">header_byteorder</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># The quality flag is no more supported. Raise a warning.</span>
    <span class="k">if</span> <span class="s1">&#39;quality&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The quality flag is no longer supported in this version of &#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;obspy.io.mseed. obspy.io.mseed.util has some functions with &#39;</span> \
            <span class="s1">&#39;similar behavior.&#39;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ObsPyDeprecationWarning</span><span class="p">)</span>

    <span class="c1"># Parse some information about the file.</span>
    <span class="k">if</span> <span class="n">header_byteorder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bo</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>
    <span class="k">elif</span> <span class="n">header_byteorder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bo</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bo</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_record_information</span><span class="p">(</span><span class="n">mseed_object</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="n">bo</span><span class="p">)</span>

    <span class="c1"># Map the encoding to a readable string value.</span>
    <span class="k">if</span> <span class="s2">&quot;encoding&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="c1"># Hopefully detected by libmseed.</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ENCODINGS</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ENCODINGS</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">UNSUPPORTED_ENCODINGS</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Encoding &#39;</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%i</span><span class="s2">) is not supported by ObsPy. Please send &quot;</span>
               <span class="s2">&quot;the file to the ObsPy developers so that we can add &quot;</span>
               <span class="s2">&quot;support for it.&quot;</span><span class="p">)</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">UNSUPPORTED_ENCODINGS</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Encoding &#39;</span><span class="si">%i</span><span class="s2">&#39; is not a valid MiniSEED encoding.&quot;</span> <span class="o">%</span> \
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Only keep information relevant for the whole file.</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">],</span>
            <span class="s1">&#39;filesize&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;filesize&#39;</span><span class="p">],</span>
            <span class="s1">&#39;record_length&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;record_length&#39;</span><span class="p">],</span>
            <span class="s1">&#39;byteorder&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">],</span>
            <span class="s1">&#39;number_of_records&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;number_of_records&#39;</span><span class="p">]}</span>

    <span class="c1"># If it&#39;s a file name just read it.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mseed_object</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">native_str</span><span class="p">)):</span>
        <span class="c1"># Read to NumPy array which is used as a buffer.</span>
        <span class="n">bfr_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">mseed_object</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mseed_object</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
        <span class="n">bfr_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">mseed_object</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>

    <span class="c1"># Get the record length</span>
    <span class="n">record_length</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;record_length&quot;</span><span class="p">]</span>

    <span class="c1"># Search for data records and pass only the data part to the underlying C</span>
    <span class="c1"># routine.</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># 0 to 9 are defined in a row in the ASCII charset.</span>
    <span class="n">min_ascii</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

    <span class="c1"># Small function to check whether an array of ASCII values contains only</span>
    <span class="c1"># digits.</span>
    <span class="k">def</span> <span class="nf">isdigit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">min_ascii</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">9</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># This should never happen</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">bfr_np</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">bfr_np</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_CONTROL_HEADERS</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Not a valid (Mini-)SEED file&#39;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">bfr_np</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">SEED_CONTROL_HEADERS</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">record_length</span>
            <span class="k">continue</span>
        <span class="k">break</span>
    <span class="n">bfr_np</span> <span class="o">=</span> <span class="n">bfr_np</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
    <span class="n">buflen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bfr_np</span><span class="p">)</span>

    <span class="c1"># If no selection is given pass None to the C function.</span>
    <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sourcename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">select_time</span> <span class="o">=</span> <span class="n">SelectTime</span><span class="p">()</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">Selections</span><span class="p">()</span>
        <span class="n">selections</span><span class="o">.</span><span class="n">timewindows</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">select_time</span>
        <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">UTCDateTime</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;starttime needs to be a UTCDateTime object&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">timewindows</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> \
                <span class="n">util</span><span class="o">.</span><span class="n">_convert_datetime_to_mstime</span><span class="p">(</span><span class="n">starttime</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># HPTERROR results in no starttime.</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">timewindows</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">HPTERROR</span>
        <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="n">UTCDateTime</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;endtime needs to be a UTCDateTime object&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">timewindows</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">endtime</span> <span class="o">=</span> \
                <span class="n">util</span><span class="o">.</span><span class="n">_convert_datetime_to_mstime</span><span class="p">(</span><span class="n">endtime</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># HPTERROR results in no starttime.</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">timewindows</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">endtime</span> <span class="o">=</span> <span class="n">HPTERROR</span>
        <span class="k">if</span> <span class="n">sourcename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourcename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">native_str</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;sourcename needs to be a string&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># libmseed uses underscores as separators and allows filtering</span>
            <span class="c1"># after the dataquality which is disabled here to not confuse</span>
            <span class="c1"># users. (* == all data qualities)</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">srcname</span> <span class="o">=</span> <span class="p">(</span><span class="n">sourcename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_*&#39;</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selections</span><span class="o">.</span><span class="n">srcname</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;*&#39;</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Use a callback function to allocate the memory and keep track of the</span>
    <span class="c1"># data.</span>
    <span class="k">def</span> <span class="nf">allocate_data</span><span class="p">(</span><span class="n">samplecount</span><span class="p">,</span> <span class="n">sampletype</span><span class="p">):</span>
        <span class="c1"># Enhanced sanity checking for libmseed 2.10 can result in the</span>
        <span class="c1"># sampletype not being set. Just return an empty array in this case.</span>
        <span class="k">if</span> <span class="n">sampletype</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">samplecount</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">DATATYPES</span><span class="p">[</span><span class="n">sampletype</span><span class="p">])</span>
        <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># XXX: Do this properly!</span>
    <span class="c1"># Define Python callback function for use in C function. Return a long so</span>
    <span class="c1"># it hopefully works on 32 and 64 bit systems.</span>
    <span class="n">alloc_data</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c_longlong</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_char</span><span class="p">)(</span><span class="n">allocate_data</span><span class="p">)</span>

    <span class="c1"># Collect exceptions. They cannot be raised in the callback as they</span>
    <span class="c1"># could never be caught then. They are collected an raised later on.</span>
    <span class="n">_errs_and_warnings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">log_error_or_warning</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ERROR: &quot;</span><span class="p">):</span>
            <span class="n">_errs_and_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">InternalMSEEDReadingError</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;INFO: &quot;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Append the offset of the full SEED header if necessary. That way</span>
            <span class="c1"># the C code does not have to deal with it.</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">and</span> <span class="s2">&quot;offset&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> The file contains a </span><span class="si">%i</span><span class="s2"> byte dataless part at the &quot;</span>
                       <span class="s2">&quot;beginning. Make sure to add that to the reported &quot;</span>
                       <span class="s2">&quot;offset to get the actual location in the file.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                           <span class="n">msg</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
            <span class="n">_errs_and_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">msg</span><span class="p">,</span> <span class="n">InternalMSEEDReadingWarning</span><span class="p">))</span>

    <span class="n">diag_print</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)(</span><span class="n">log_error_or_warning</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">log_print</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)(</span><span class="n">log_message</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">lil</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">readMSEEDBuffer</span><span class="p">(</span>
        <span class="n">bfr_np</span><span class="p">,</span> <span class="n">buflen</span><span class="p">,</span> <span class="n">selections</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int8</span><span class="p">(</span><span class="n">unpack_data</span><span class="p">),</span>
        <span class="n">reclen</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int8</span><span class="p">(</span><span class="n">verbose</span><span class="p">),</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int8</span><span class="p">(</span><span class="n">details</span><span class="p">),</span> <span class="n">header_byteorder</span><span class="p">,</span>
        <span class="n">alloc_data</span><span class="p">,</span> <span class="n">diag_print</span><span class="p">,</span> <span class="n">log_print</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">_errs_and_warnings</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_i</span><span class="p">,</span> <span class="n">InternalMSEEDReadingError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">_i</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="o">*</span><span class="n">_i</span><span class="p">)</span>

    <span class="c1"># XXX: Check if the freeing works.</span>
    <span class="k">del</span> <span class="n">selections</span>

    <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_id</span> <span class="o">=</span> <span class="n">lil</span><span class="o">.</span><span class="n">contents</span>
    <span class="c1"># Return stream if not traces are found.</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">clibmseed</span><span class="o">.</span><span class="n">lil_free</span><span class="p">(</span><span class="n">lil</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">lil</span>
        <span class="k">return</span> <span class="n">Stream</span><span class="p">()</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Init header with the essential information.</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;network&#39;</span><span class="p">:</span> <span class="n">current_id</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                  <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">current_id</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">current_id</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                  <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">current_id</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                  <span class="s1">&#39;mseed&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dataquality&#39;</span><span class="p">:</span> <span class="n">current_id</span><span class="o">.</span><span class="n">dataquality</span><span class="p">}}</span>
        <span class="c1"># Loop over segments.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_segment</span> <span class="o">=</span> <span class="n">current_id</span><span class="o">.</span><span class="n">firstSegment</span><span class="o">.</span><span class="n">contents</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_segment</span><span class="o">.</span><span class="n">samprate</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">util</span><span class="o">.</span><span class="n">_convert_mstime_to_datetime</span><span class="p">(</span><span class="n">current_segment</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">details</span><span class="p">:</span>
                <span class="n">timing_quality</span> <span class="o">=</span> <span class="n">current_segment</span><span class="o">.</span><span class="n">timing_quality</span>
                <span class="k">if</span> <span class="n">timing_quality</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">:</span>  <span class="c1"># 0xFF is mask for not known timing</span>
                    <span class="n">timing_quality</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;blkt1001&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;blkt1001&#39;</span><span class="p">][</span><span class="s1">&#39;timing_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timing_quality</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;calibration_type&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">current_segment</span><span class="o">.</span><span class="n">calibration_type</span> \
                    <span class="k">if</span> <span class="n">current_segment</span><span class="o">.</span><span class="n">calibration_type</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">headonly</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># The data always will be in sequential order.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;npts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;npts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_segment</span><span class="o">.</span><span class="n">samplecnt</span>
            <span class="c1"># Make sure to init the number of samples.</span>
            <span class="c1"># Py3k: convert to unicode</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
                                   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># Append information.</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
            <span class="c1"># A Null pointer access results in a ValueError</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_segment</span> <span class="o">=</span> <span class="n">current_segment</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">contents</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_id</span> <span class="o">=</span> <span class="n">current_id</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">contents</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">clibmseed</span><span class="o">.</span><span class="n">lil_free</span><span class="p">(</span><span class="n">lil</span><span class="p">)</span>  <span class="c1"># NOQA</span>
    <span class="k">del</span> <span class="n">lil</span>  <span class="c1"># NOQA</span>
    <span class="k">return</span> <span class="n">Stream</span><span class="p">(</span><span class="n">traces</span><span class="o">=</span><span class="n">traces</span><span class="p">)</span></div>


<div class="viewcode-block" id="_write_mseed"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core._write_mseed.html#obspy.io.mseed.core._write_mseed">[docs]</a><span class="k">def</span> <span class="nf">_write_mseed</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reclen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sequence_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write Mini-SEED file from a Stream object.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function should NOT be called directly, it registers via the</span>
<span class="sd">        the :meth:`~obspy.core.stream.Stream.write` method of an</span>
<span class="sd">        ObsPy :class:`~obspy.core.stream.Stream` object, call this instead.</span>

<span class="sd">    :type stream: :class:`~obspy.core.stream.Stream`</span>
<span class="sd">    :param stream: A Stream object.</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: Name of the output file or a file-like object.</span>
<span class="sd">    :type encoding: int or str, optional</span>
<span class="sd">    :param encoding: Should be set to one of the following supported Mini-SEED</span>
<span class="sd">        data encoding formats: ``ASCII`` (``0``)*, ``INT16`` (``1``),</span>
<span class="sd">        ``INT32`` (``3``), ``FLOAT32`` (``4``)*, ``FLOAT64`` (``5``)*,</span>
<span class="sd">        ``STEIM1`` (``10``) and ``STEIM2`` (``11``)*. If no encoding is given</span>
<span class="sd">        it will be derived from the dtype of the data and the appropriate</span>
<span class="sd">        default encoding (depicted with an asterix) will be chosen.</span>
<span class="sd">    :type reclen: int, optional</span>
<span class="sd">    :param reclen: Should be set to the desired data record length in bytes</span>
<span class="sd">        which must be expressible as 2 raised to the power of X where X is</span>
<span class="sd">        between (and including) 8 to 20.</span>
<span class="sd">        Defaults to 4096</span>
<span class="sd">    :type byteorder: int or str, optional</span>
<span class="sd">    :param byteorder: Must be either ``0`` or ``&#39;&lt;&#39;`` for LSBF or</span>
<span class="sd">        little-endian, ``1`` or ``&#39;&gt;&#39;`` for MBF or big-endian. ``&#39;=&#39;`` is the</span>
<span class="sd">        native byte order. If ``-1`` it will be passed directly to libmseed</span>
<span class="sd">        which will also default it to big endian. Defaults to big endian.</span>
<span class="sd">    :type sequence_number: int, optional</span>
<span class="sd">    :param sequence_number: Must be an integer ranging between 1 and 999999.</span>
<span class="sd">        Represents the sequence count of the first record of each Trace.</span>
<span class="sd">        Defaults to 1.</span>
<span class="sd">    :type flush: bool, optional</span>
<span class="sd">    :param flush: If ``True``, all data will be packed into records. If</span>
<span class="sd">        ``False`` new records will only be created when there is enough data to</span>
<span class="sd">        completely fill a record. Be careful with this. If in doubt, choose</span>
<span class="sd">        ``True`` which is also the default value.</span>
<span class="sd">    :type verbose: int, optional</span>
<span class="sd">    :param verbose: Controls verbosity, a value of ``0`` will result in no</span>
<span class="sd">        diagnostic output.</span>

<span class="sd">    .. note::</span>
<span class="sd">        The ``reclen``, ``encoding``, ``byteorder`` and ``sequence_count``</span>
<span class="sd">        keyword arguments can be set in the ``stats.mseed`` of</span>
<span class="sd">        each :class:`~obspy.core.trace.Trace` as well as ``kwargs`` of this</span>
<span class="sd">        function. If both are given the ``kwargs`` will be used.</span>

<span class="sd">        The ``stats.mseed.blkt1001.timing_quality`` value will also be written</span>
<span class="sd">        if it is set.</span>

<span class="sd">        The ``stats.mseed.blkt1001.timing_quality`` value will also be written</span>
<span class="sd">        if it is set.</span>

<span class="sd">    .. rubric:: Example</span>

<span class="sd">    &gt;&gt;&gt; from obspy import read</span>
<span class="sd">    &gt;&gt;&gt; st = read()</span>
<span class="sd">    &gt;&gt;&gt; st.write(&#39;filename.mseed&#39;, format=&#39;MSEED&#39;)  # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Map flush and verbose flags.</span>
    <span class="k">if</span> <span class="n">flush</span><span class="p">:</span>
        <span class="n">flush</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flush</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Some sanity checks for the keyword arguments.</span>
    <span class="k">if</span> <span class="n">reclen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">reclen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_RECORD_LENGTHS</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid record length. The record length must be a value</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;of 2 to the power of X where 8 &lt;= X &lt;= 20.&#39;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">byteorder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="n">NATIVE_BYTEORDER</span>
        <span class="c1"># If not elif because NATIVE_BYTEORDER is &#39;&lt;&#39; or &#39;&gt;&#39;.</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="n">byteorder</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid byte order. It must be either &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;=&#39;, &quot;</span> <span class="o">+</span> \
                  <span class="s2">&quot;0, 1 or -1&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">_convert_and_check_encoding_for_writing</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sequence_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check sequence number type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sequence_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sequence_number</span><span class="p">)</span>
            <span class="c1"># Check sequence number value</span>
            <span class="k">if</span> <span class="n">sequence_number</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">sequence_number</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sequence number out of range. It must be &quot;</span> <span class="o">+</span>
                                 <span class="s2">&quot; between 1 and 999999.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid sequence number. It must be an integer ranging &quot;</span> <span class="o">+</span>\
                  <span class="s2">&quot;from 1 to 999999.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">trace_attributes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">use_blkt_1001</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># The data might need to be modified. To not modify the input data keep</span>
    <span class="c1"># references of which data to finally write.</span>
    <span class="n">trace_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Loop over every trace and figure out the correct settings.</span>
    <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
        <span class="c1"># Create temporary dict for storing information while writing.</span>
        <span class="n">trace_attr</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">trace_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace_attr</span><span class="p">)</span>

        <span class="c1"># Figure out whether or not to use Blockette 1001. This check is done</span>
        <span class="c1"># once to ensure that Blockette 1001 is either written for every record</span>
        <span class="c1"># in the file or for none. It checks the starttime, the sampling rate</span>
        <span class="c1"># and the timing quality. If starttime or sampling rate has a precision</span>
        <span class="c1"># of more than 100 microseconds, or if timing quality is set, \</span>
        <span class="c1"># Blockette 1001 will be written for every record.</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">_convert_datetime_to_mstime</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">starttime</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">*</span> <span class="n">HPTMODULUS</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">use_blkt_1001</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s1">&#39;mseed&#39;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">],</span> <span class="s1">&#39;blkt1001&#39;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;blkt1001&#39;</span><span class="p">],</span> <span class="s1">&#39;timing_quality&#39;</span><span class="p">):</span>

            <span class="n">timing_quality</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;blkt1001&#39;</span><span class="p">][</span><span class="s1">&#39;timing_quality&#39;</span><span class="p">]</span>
            <span class="c1"># Check timing quality type</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timing_quality</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timing_quality</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timing_quality</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">timing_quality</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timing quality out of range. It must be &quot;</span>
                                     <span class="s2">&quot;between 0 and 100.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid timing quality in Stream[</span><span class="si">%i</span><span class="s2">].stats.&quot;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span> \
                    <span class="s2">&quot;mseed.timing_quality. It must be an integer ranging&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot; from 0 to 100&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;timing_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timing_quality</span>
            <span class="n">use_blkt_1001</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;timing_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timing_quality</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">sequence_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;sequence_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence_number</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s1">&#39;mseed&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">],</span> <span class="s1">&#39;sequence_number&#39;</span><span class="p">):</span>

            <span class="n">sequence_number</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;sequence_number&#39;</span><span class="p">]</span>
            <span class="c1"># Check sequence number type</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sequence_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sequence_number</span><span class="p">)</span>
                <span class="c1"># Check sequence number value</span>
                <span class="k">if</span> <span class="n">sequence_number</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">sequence_number</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sequence number out of range in &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;Stream[</span><span class="si">%i</span><span class="s2">].stats. It must be between &quot;</span> <span class="o">+</span>
                                     <span class="s2">&quot;1 and 999999.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid sequence number in Stream[</span><span class="si">%i</span><span class="s2">].stats.&quot;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span>\
                      <span class="s2">&quot;mseed.sequence_number. It must be an integer ranging&quot;</span> <span class="o">+</span>\
                      <span class="s2">&quot; from 1 to 999999.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;sequence_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence_number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;sequence_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence_number</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Set data quality to indeterminate (= D) if it is not already set.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;dataquality&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mseed&#39;</span><span class="p">][</span><span class="s1">&#39;dataquality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;dataquality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
        <span class="c1"># Sanity check for the dataquality to get a nice Python exception</span>
        <span class="c1"># instead of a C error.</span>
        <span class="k">if</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;dataquality&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid dataquality in Stream[</span><span class="si">%i</span><span class="s1">].stats&#39;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span> \
                  <span class="s1">&#39;.mseed.dataquality</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
                  <span class="s1">&#39;The dataquality for Mini-SEED must be either D, R, Q &#39;</span> <span class="o">+</span> \
                  <span class="s1">&#39;or M. See the SEED manual for further information.&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check that data is of the right type.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unsupported data type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> \
                  <span class="s2">&quot; for Stream[</span><span class="si">%i</span><span class="s2">].data.&quot;</span> <span class="o">%</span> <span class="n">_i</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check if ndarray is contiguous (see #192, #193)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Detected non contiguous data array in Stream[</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span> \
                  <span class="s2">&quot;.data. Trying to fix array.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Handle the record length.</span>
        <span class="k">if</span> <span class="n">reclen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;reclen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reclen</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s1">&#39;mseed&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="p">,</span> <span class="s1">&#39;record_length&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">record_length</span> <span class="ow">in</span> <span class="n">VALID_RECORD_LENGTHS</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;reclen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">record_length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid record length in Stream[</span><span class="si">%i</span><span class="s1">].stats.&#39;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span> \
                      <span class="s1">&#39;mseed.reclen.</span><span class="se">\n</span><span class="s1">The record length must be a value &#39;</span> <span class="o">+</span> \
                      <span class="s1">&#39;of 2 to the power of X where 8 &lt;= X &lt;= 20.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;reclen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4096</span>

        <span class="c1"># Handle the byte order.</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">byteorder</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s1">&#39;mseed&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="p">,</span> <span class="s1">&#39;byteorder&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">byteorder</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">byteorder</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">NATIVE_BYTEORDER</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                    <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid byteorder in Stream[</span><span class="si">%i</span><span class="s2">].stats.&quot;</span> <span class="o">%</span> <span class="n">_i</span> <span class="o">+</span> \
                    <span class="s2">&quot;mseed.byteorder. It must be either &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;=&#39;,&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot; 0, 1 or -1&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">NATIVE_BYTEORDER</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Handle the encoding.</span>
        <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># If encoding arrives here it is already guaranteed to be a valid</span>
        <span class="c1"># integer encoding.</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Check if the dtype for all traces is compatible with the enforced</span>
            <span class="c1"># encoding.</span>
            <span class="n">ident</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ENCODINGS</span><span class="p">[</span><span class="n">encoding</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Wrong dtype for Stream[</span><span class="si">%i</span><span class="s2">].data for encoding </span><span class="si">%s</span><span class="s2">.</span>
<span class="s2">                    Please change the dtype of your data or use an appropriate</span>
<span class="s2">                    encoding. See the obspy.io.mseed documentation for more</span>
<span class="s2">                    information.</span>
<span class="s2">                    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_i</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s1">&#39;mseed&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="p">,</span>
                                                       <span class="s1">&#39;encoding&#39;</span><span class="p">):</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">util</span><span class="o">.</span><span class="n">_convert_and_check_encoding_for_writing</span><span class="p">(</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mseed</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="c1"># Check if the encoding matches the data&#39;s dtype.</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">ENCODINGS</span><span class="p">[</span><span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The encoding specified in &#39;</span> <span class="o">+</span> \
                      <span class="s1">&#39;trace.stats.mseed.encoding does not match the &#39;</span> <span class="o">+</span> \
                      <span class="s1">&#39;dtype of the data.</span><span class="se">\n</span><span class="s1">A suitable encoding will &#39;</span> <span class="o">+</span> \
                      <span class="s1">&#39;be chosen.&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># automatically detect encoding if no encoding is given.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;|S1&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unsupported data type </span><span class="si">%s</span><span class="s2"> in Stream[</span><span class="si">%i</span><span class="s2">].data&quot;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">_i</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Convert data if necessary, otherwise store references in list.</span>
        <span class="k">if</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># INT16 needs INT32 data type</span>
            <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trace_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Do some final sanity checks and raise a warning if a file will be written</span>
    <span class="c1"># with more than one different encoding, record length or byte order.</span>
    <span class="n">encodings</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">trace_attributes</span><span class="p">}</span>
    <span class="n">reclens</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">[</span><span class="s1">&#39;reclen&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">trace_attributes</span><span class="p">}</span>
    <span class="n">byteorders</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">trace_attributes</span><span class="p">}</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;File will be written with more than one different </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
          <span class="s1">&#39;This might have a negative influence on the compatibility &#39;</span> <span class="o">+</span> \
          <span class="s1">&#39;with other programs.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">encodings</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s1">&#39;encodings&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reclens</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s1">&#39;record lengths&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">byteorders</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s1">&#39;byteorders&#39;</span><span class="p">)</span>

    <span class="c1"># Open filehandler or use an existing file like object.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="c1"># Loop over every trace and finally write it to the filehandler.</span>
    <span class="k">for</span> <span class="n">trace</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">trace_attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">trace_data</span><span class="p">,</span> <span class="n">trace_attributes</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Skipping empty trace &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trace</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="c1"># Create C struct MSTrace.</span>
        <span class="n">mst</span> <span class="o">=</span> <span class="n">MST</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dataquality</span><span class="o">=</span><span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;dataquality&#39;</span><span class="p">])</span>

        <span class="c1"># Initialize packedsamples pointer for the mst_pack function</span>
        <span class="n">packedsamples</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int</span><span class="p">()</span>

        <span class="c1"># Callback function for mst_pack to actually write the file</span>
        <span class="k">def</span> <span class="nf">record_handler</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">reclen</span><span class="p">,</span> <span class="n">_stream</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">reclen</span><span class="p">])</span>
        <span class="c1"># Define Python callback function for use in C function</span>
        <span class="n">rec_handler</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c_char</span><span class="p">),</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
                                  <span class="n">C</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)(</span><span class="n">record_handler</span><span class="p">)</span>

        <span class="c1"># Fill up msr record structure, this is already contained in</span>
        <span class="c1"># mstg, however if blk1001 is set we need it anyway</span>
        <span class="n">msr</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_init</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">dataquality</span> <span class="o">=</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;dataquality&#39;</span><span class="p">]</span><span class="o">.</span>\
            <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>

        <span class="c1"># Set starting sequence number</span>
        <span class="n">msr</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">sequence_number</span> <span class="o">=</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;sequence_number&#39;</span><span class="p">]</span>

        <span class="c1"># Only use Blockette 1001 if necessary.</span>
        <span class="k">if</span> <span class="n">use_blkt_1001</span><span class="p">:</span>
            <span class="c1"># Timing quality has been set in trace_attr</span>

            <span class="n">size</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">Blkt1001S</span><span class="p">)</span>
            <span class="c1"># Only timing quality matters here, other blockette attributes will</span>
            <span class="c1"># be filled by libmseed.msr_normalize_header</span>
            <span class="n">blkt_value</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;BBBB&quot;</span><span class="p">),</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;timing_quality&#39;</span><span class="p">],</span>
                              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">blkt_ptr</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">blkt_value</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">blkt_value</span><span class="p">))</span>

            <span class="c1"># Usually returns a pointer to the added blockette in the</span>
            <span class="c1"># blockette link chain and a NULL pointer if it fails.</span>
            <span class="c1"># NULL pointers have a false boolean value according to the</span>
            <span class="c1"># ctypes manual.</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_addblockette</span><span class="p">(</span><span class="n">msr</span><span class="p">,</span> <span class="n">blkt_ptr</span><span class="p">,</span>
                                                 <span class="n">size</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret_val</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_free</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">msr</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">msr</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error in msr_addblockette&#39;</span><span class="p">)</span>

        <span class="c1"># Only use Blockette 100 if necessary.</span>
        <span class="c1"># Determine if a blockette 100 will be needed to represent the input</span>
        <span class="c1"># sample rate or if the sample rate in the fixed section of the data</span>
        <span class="c1"># header will suffice (see ms_genfactmult in libmseed/genutils.c)</span>
        <span class="c1">#</span>
        <span class="c1"># It is definitely necessary for very large or small sampling rates (</span>
        <span class="c1"># using libmseed for the test would result in an overflow).</span>
        <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">&gt;=</span> <span class="mf">32727.0</span> <span class="ow">or</span> \
                <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">32727.0</span><span class="p">):</span>
            <span class="n">use_blkt_100</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_blkt_100</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">_factor</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int16</span><span class="p">()</span>
            <span class="n">_multiplier</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">c_int16</span><span class="p">()</span>
            <span class="n">clibmseed</span><span class="o">.</span><span class="n">ms_genfactmult</span><span class="p">(</span>
                <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">_factor</span><span class="p">),</span>
                <span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">_multiplier</span><span class="p">))</span>
            <span class="n">ms_sr</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">ms_nomsamprate</span><span class="p">(</span><span class="n">_factor</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_multiplier</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># It is also necessary if the libmseed calculated sampling rate</span>
            <span class="c1"># would result in a loss of accuracy - the floating point</span>
            <span class="c1"># comparision is on purpose here as it will always try to</span>
            <span class="c1"># preserve all accuracy.</span>
            <span class="c1"># Cast to float32 to not add blockette 100 for values</span>
            <span class="c1"># that cannot be represented with 32bits.</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">ms_sr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span><span class="p">):</span>
                <span class="n">use_blkt_100</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">use_blkt_100</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">Blkt100S</span><span class="p">)</span>
            <span class="n">blkt100</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">c_char</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">C</span><span class="o">.</span><span class="n">memset</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">blkt100</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_addblockette</span><span class="p">(</span>
                <span class="n">msr</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">blkt100</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># NOQA</span>
            <span class="c1"># Usually returns a pointer to the added blockette in the</span>
            <span class="c1"># blockette link chain and a NULL pointer if it fails.</span>
            <span class="c1"># NULL pointers have a false boolean value according to the</span>
            <span class="c1"># ctypes manual.</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ret_val</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_free</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">msr</span><span class="p">))</span>  <span class="c1"># NOQA</span>
                <span class="k">del</span> <span class="n">msr</span>  <span class="c1"># NOQA</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error in msr_addblockette&#39;</span><span class="p">)</span>

        <span class="c1"># Pack mstg into a MSEED file using the callback record_handler as</span>
        <span class="c1"># write method.</span>
        <span class="n">errcode</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">mst_pack</span><span class="p">(</span>
            <span class="n">mst</span><span class="o">.</span><span class="n">mst</span><span class="p">,</span> <span class="n">rec_handler</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;reclen&#39;</span><span class="p">],</span>
            <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">],</span> <span class="n">trace_attr</span><span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">],</span>
            <span class="n">C</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">packedsamples</span><span class="p">),</span> <span class="n">flush</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">msr</span><span class="p">)</span>  <span class="c1"># NOQA</span>

        <span class="k">if</span> <span class="n">errcode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Did not write any data for trace &#39;</span><span class="si">%s</span><span class="s2">&#39; even though it &quot;</span>
                   <span class="s2">&quot;contains data values.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">trace</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errcode</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_free</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">msr</span><span class="p">))</span>  <span class="c1"># NOQA</span>
            <span class="k">del</span> <span class="n">mst</span><span class="p">,</span> <span class="n">msr</span>  <span class="c1"># NOQA</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error in mst_pack&#39;</span><span class="p">)</span>
        <span class="c1"># Deallocate any allocated memory.</span>
        <span class="n">clibmseed</span><span class="o">.</span><span class="n">msr_free</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">msr</span><span class="p">))</span>  <span class="c1"># NOQA</span>
        <span class="k">del</span> <span class="n">mst</span><span class="p">,</span> <span class="n">msr</span>  <span class="c1"># NOQA</span>
    <span class="c1"># Close if its a file handler.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="MST"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core.MST.html#obspy.io.mseed.core.MST">[docs]</a><span class="k">class</span> <span class="nc">MST</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that transforms a ObsPy Trace object to a libmseed internal MSTrace</span>
<span class="sd">    struct.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MST.__init__"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core.MST.__init__.html#obspy.io.mseed.core.MST.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dataquality</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The init function requires a ObsPy Trace object which will be used to</span>
<span class="sd">        fill self.mstg.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">mst_init</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Figure out the datatypes.</span>
        <span class="n">sampletype</span> <span class="o">=</span> <span class="n">SAMPLETYPE</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>

        <span class="c1"># Set the header values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span><span class="o">.</span>\
            <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span>\
            <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">location</span><span class="o">.</span>\
            <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span>\
            <span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">dataquality</span> <span class="o">=</span> <span class="n">dataquality</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> \
            <span class="n">util</span><span class="o">.</span><span class="n">_convert_datetime_to_mstime</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">endtime</span> <span class="o">=</span> \
            <span class="n">util</span><span class="o">.</span><span class="n">_convert_datetime_to_mstime</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">samprate</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sampling_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">samplecnt</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">numsamples</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">npts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">sampletype</span> <span class="o">=</span> <span class="n">sampletype</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>

        <span class="c1"># libmseed expects data in the native byte order.</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>

        <span class="c1"># Copy the data. The copy appears to be necessary so that Python&#39;s</span>
        <span class="c1"># garbage collection does not interfere it.</span>
        <span class="n">bytecount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">datasamples</span> <span class="o">=</span> <span class="n">clibmseed</span><span class="o">.</span><span class="n">allocate_bytes</span><span class="p">(</span><span class="n">bytecount</span><span class="p">)</span>
        <span class="n">C</span><span class="o">.</span><span class="n">memmove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">datasamples</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">get_data</span><span class="p">(),</span>
                  <span class="n">bytecount</span><span class="p">)</span></div>

<div class="viewcode-block" id="MST.__del__"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.mseed.core.MST.__del__.html#obspy.io.mseed.core.MST.__del__">[docs]</a>    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frees all allocated memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This also frees the data of the associated datasamples pointer.</span>
        <span class="n">clibmseed</span><span class="o">.</span><span class="n">mst_free</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mst</span><span class="p">))</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mst</span></div></div>


<span class="c1"># Remove once 0.11 has been released.</span>
<span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">DynamicAttributeImportRerouteModule</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">locs</span><span class="o">=</span><span class="nb">locals</span><span class="p">(),</span>
    <span class="n">original_module</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span>
    <span class="n">import_map</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">function_map</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;isMSEED&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.mseed.core._is_mseed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;readMSEED&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.mseed.core._read_mseed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;writeMSEED&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.mseed.core._write_mseed&#39;</span><span class="p">})</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">exclude_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a>™ &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, Ólafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Käufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhäusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaimé, Sébastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clément</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Köhler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n° 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>