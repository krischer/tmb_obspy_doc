<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.sac.arrayio &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.sac.arrayio</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Low-level array interface to the SAC file format.</span>

<span class="sd">Functions in this module work directly with NumPy arrays that mirror the SAC</span>
<span class="sd">format.  The &#39;primitives&#39; in this module are the float, int, and string header</span>
<span class="sd">arrays, the float data array, and a header dictionary. Convenience functions</span>
<span class="sd">are provided to convert between header arrays and more user-friendly</span>
<span class="sd">dictionaries.</span>

<span class="sd">These read/write routines are very literal; there is almost no value or type</span>
<span class="sd">checking, except for byteorder and header/data array length.  File- and array-</span>
<span class="sd">based checking routines are provided for additional checks where desired.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">native_str</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">obspy.core.compatibility</span> <span class="k">import</span> <span class="n">from_buffer</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">UTCDateTime</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">header</span> <span class="k">as</span> <span class="n">HD</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">SacIOError</span><span class="p">,</span> <span class="n">SacInvalidContentError</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">is_valid_enum_int</span>


<div class="viewcode-block" id="init_header_arrays"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.init_header_arrays.html#obspy.io.sac.arrayio.init_header_arrays">[docs]</a><span class="k">def</span> <span class="nf">init_header_arrays</span><span class="p">(</span><span class="n">arrays</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;=&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize arbitrary header arrays.</span>

<span class="sd">    :param arrays: Specify which arrays to initialize and the desired order.</span>
<span class="sd">        If omitted, returned arrays are (&#39;float&#39;, &#39;int&#39;, &#39;str&#39;), in that order.</span>
<span class="sd">    :type arrays: Tuple of strings {&#39;float&#39;, &#39;int&#39;, &#39;str&#39;}</span>
<span class="sd">    :param byteorder: Desired byte order of initialized arrays</span>
<span class="sd">        (little, native, big).</span>
<span class="sd">    :type byteorder: str {&#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;}</span>

<span class="sd">    :rtype: list of :class:`~numpy.ndarray` instances</span>
<span class="sd">    :returns: The desired SAC header arrays.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">itype</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
            <span class="c1"># null float header array</span>
            <span class="n">hf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="n">byteorder</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>
            <span class="n">hf</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">FNULL</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">itype</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
            <span class="c1"># null integer header array</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="n">byteorder</span> <span class="o">+</span> <span class="s1">&#39;i4&#39;</span><span class="p">))</span>
            <span class="n">hi</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">)</span>
            <span class="c1"># set logicals to 0, not -1234whatever</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">hdr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">):</span>
                    <span class="n">hi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># TODO: make an init_header_array_values function that sets sane</span>
            <span class="c1">#   initial values, including lcalda, nvhdr, leven, etc..</span>
            <span class="c1"># calculate distances by default</span>
            <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;lcalda&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">itype</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="c1"># null string header array</span>
            <span class="n">hs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;|S8&#39;</span><span class="p">))</span>
            <span class="n">hs</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">SNULL</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized header array type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itype</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="read_sac"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.read_sac.html#obspy.io.sac.arrayio.read_sac">[docs]</a><span class="k">def</span> <span class="nf">read_sac</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">headonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">checksize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a SAC binary file.</span>

<span class="sd">    :param source: Full path string for File-like object from a SAC binary file</span>
<span class="sd">        on disk.  If it is an open File object, open &#39;rb&#39;.</span>
<span class="sd">    :type source: str or file</span>
<span class="sd">    :param headonly: If headonly is True, only read the header arrays not the</span>
<span class="sd">        data array.</span>
<span class="sd">    :type headonly: bool</span>
<span class="sd">    :param byteorder: If omitted or None, automatic byte-order checking is</span>
<span class="sd">        done, starting with native order. If byteorder is specified and</span>
<span class="sd">        incorrect, a SacIOError is raised.</span>
<span class="sd">    :type byteorder: str {&#39;little&#39;, &#39;big&#39;}, optional</span>
<span class="sd">    :param checksize: If True, check that the theoretical file size from the</span>
<span class="sd">        header matches the size on disk.</span>
<span class="sd">    :type checksize: bool</span>

<span class="sd">    :return: The float, integer, and string header arrays, and data array,</span>
<span class="sd">        in that order. Data array will be None if headonly is True.</span>
<span class="sd">    :rtype: tuple of :class:`numpy.ndarray`</span>

<span class="sd">    :raises: :class:`ValueError` if unrecognized byte order.  :class:`IOError`</span>
<span class="sd">        if file not found, incorrect specified byteorder, theoretical file size</span>
<span class="sd">        doesn&#39;t match header, or header arrays are incorrect length.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: rewrite using &quot;with&quot; statement instead of open/close management.</span>
    <span class="c1"># check byte order, header array length, file size, npts == data length</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># source is already a file-like object</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">source</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">is_byteorder_specified</span> <span class="o">=</span> <span class="n">byteorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_byteorder_specified</span><span class="p">:</span>
        <span class="n">byteorder</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span>

    <span class="k">if</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;little&#39;</span><span class="p">:</span>
        <span class="n">endian_str</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>
    <span class="k">elif</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;big&#39;</span><span class="p">:</span>
        <span class="n">endian_str</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized byteorder. Use {&#39;little&#39;, &#39;big&#39;}&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># READ HEADER</span>
    <span class="c1"># The sac header has 70 floats, 40 integers, then 192 bytes</span>
    <span class="c1">#    in strings. Store them in array (and convert the char to a</span>
    <span class="c1">#    list). That&#39;s a total of 632 bytes.</span>
    <span class="c1"># --------------------------------------------------------------</span>
    <span class="n">hf</span> <span class="o">=</span> <span class="n">from_buffer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="n">from_buffer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">40</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;i4&#39;</span><span class="p">))</span>
    <span class="n">hs</span> <span class="o">=</span> <span class="n">from_buffer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;|S8&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_byteorder</span><span class="p">(</span><span class="n">hi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_byteorder_specified</span><span class="p">:</span>
            <span class="c1"># specified but not valid. you dun messed up.</span>
            <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Incorrect byteorder </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">byteorder</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not valid, but not specified.</span>
            <span class="c1"># swap the dtype interpretation (dtype.byteorder), but keep the</span>
            <span class="c1"># bytes, so the arrays in memory reflect the bytes on disk</span>
            <span class="n">hf</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>

    <span class="c1"># we now have correct headers, let&#39;s use their correct byte order.</span>
    <span class="n">endian_str</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span>

    <span class="c1"># check header lengths</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">70</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">40</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">hs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_file_name</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot read all header values&quot;</span><span class="p">)</span>

    <span class="n">npts</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">)]</span>

    <span class="c1"># check file size</span>
    <span class="k">if</span> <span class="n">checksize</span><span class="p">:</span>
        <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">cur_pos</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">)</span>
        <span class="n">th_length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">632</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">npts</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="n">th_length</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Actual and theoretical file size are inconsistent.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                  <span class="s2">&quot;Actual/Theoretical: </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span> \
                  <span class="s2">&quot;Check that headers are consistent with time series.&quot;</span>
            <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">th_length</span><span class="p">))</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># READ DATA</span>
    <span class="c1"># --------------------------------------------------------------</span>
    <span class="k">if</span> <span class="n">headonly</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">from_buffer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">),</span>
                           <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">npts</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot read all data points&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">data</span></div>


<div class="viewcode-block" id="read_sac_ascii"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.read_sac_ascii.html#obspy.io.sac.arrayio.read_sac_ascii">[docs]</a><span class="k">def</span> <span class="nf">read_sac_ascii</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">headonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a SAC ASCII/Alphanumeric file.</span>

<span class="sd">    :param source: Full path or File-like object from a SAC ASCII file on disk.</span>
<span class="sd">    :type source: str or file</span>
<span class="sd">    :param headonly: If headonly is True, return the header arrays not the</span>
<span class="sd">        data array.  Note, the entire file is still read in if headonly=True.</span>
<span class="sd">    :type headonly: bool</span>

<span class="sd">    :return: The float, integer, and string header arrays, and data array,</span>
<span class="sd">        in that order. Data array will be None if headonly is True.</span>
<span class="sd">    :rtype: :class:`numpy.ndarray`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: make headonly=True only read part of the file, not all of it.</span>
    <span class="c1"># checks: ASCII-ness, header array length, npts matches data length</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">source</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;No such file: &quot;</span> <span class="o">+</span> <span class="n">source</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_i</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n\r</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">14</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid SAC file:&quot;</span> <span class="o">%</span> <span class="n">fh</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># parse the header</span>
    <span class="c1">#</span>
    <span class="c1"># The sac header has 70 floats, 40 integers, then 192 bytes</span>
    <span class="c1">#    in strings. Store them in array (and convert the char to a</span>
    <span class="c1">#    list). That&#39;s a total of 632 bytes.</span>
    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># read in the float values</span>
    <span class="c1"># TODO: use native &#39;=&#39; dtype byteorder instead of forcing little endian?</span>
    <span class="n">hf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">[:</span><span class="mi">14</span><span class="p">]],</span>
                  <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;&lt;f4&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="c1"># read in the int values</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span> <span class="mi">14</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]],</span>
                  <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;&lt;i4&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="c1"># reading in the string part is a bit more complicated</span>
    <span class="c1"># because every string field has to be 8 characters long</span>
    <span class="c1"># apart from the second field which is 16 characters long</span>
    <span class="c1"># resulting in a total length of 192 characters</span>
    <span class="n">hs</span><span class="p">,</span> <span class="o">=</span> <span class="n">init_header_arrays</span><span class="p">(</span><span class="n">arrays</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[</span><span class="mi">14</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">hs</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;|S8&#39;</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># read in the seismogram points</span>
    <span class="c1"># --------------------------------------------------------------</span>
    <span class="k">if</span> <span class="n">headonly</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">[</span><span class="mi">30</span><span class="p">:]],</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;&lt;f4&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;npts&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">npts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot read all data points&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">data</span></div>


<div class="viewcode-block" id="write_sac"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.write_sac.html#obspy.io.sac.arrayio.write_sac">[docs]</a><span class="k">def</span> <span class="nf">write_sac</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the header and (optionally) data arrays to a SAC binary file.</span>

<span class="sd">    :param dest: Full path or File-like object to SAC binary file on disk.</span>
<span class="sd">    :type dest: str or file</span>
<span class="sd">    :param hf: SAC float header array</span>
<span class="sd">    :type hf: :class:`numpy.ndarray` of floats</span>
<span class="sd">    :param hi: SAC int header array</span>
<span class="sd">    :type hi: :class:`numpy.ndarray` of ints</span>
<span class="sd">    :param hs: SAC string header array</span>
<span class="sd">    :type hs: :class:`numpy.ndarray` of str</span>
<span class="sd">    :param data: SAC data array, optional.  If omitted or None, it is assumed</span>
<span class="sd">        that the user intends to overwrite/modify only the header arrays of an</span>
<span class="sd">        existing file.  Equivalent to SAC&#39;s &quot;writehdr&quot;.</span>
<span class="sd">    :type data: :class:`numpy.ndarray` of float32</span>
<span class="sd">    :param byteorder: Desired output byte order.  If omitted, arrays are</span>
<span class="sd">        written as they are.  If data=None, better make sure the file you&#39;re</span>
<span class="sd">        writing to has the same byte order as headers you&#39;re writing.</span>
<span class="sd">    :type byteorder: str {&#39;little&#39;, &#39;big&#39;}, optional</span>

<span class="sd">    :return: None</span>

<span class="sd">    .. rubric:: Notes</span>

<span class="sd">    A user can/should not _create_ a header-only binary file.  Use mode &#39;wb+&#39;</span>
<span class="sd">    for data=None (headonly) writing to just write over the header part of an</span>
<span class="sd">    existing binary file with data in it.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># deal with file name versus File-like object, and file mode</span>
    <span class="c1"># file open modes in Python: http://stackoverflow.com/a/23566951/745557</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># file exists, just modify it (don&#39;t start from scratch)</span>
        <span class="n">fmode</span> <span class="o">=</span> <span class="s1">&#39;rb+&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># start from scratch</span>
        <span class="n">fmode</span> <span class="o">=</span> <span class="s1">&#39;wb+&#39;</span>

    <span class="k">if</span> <span class="n">byteorder</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;little&#39;</span><span class="p">:</span>
            <span class="n">endian_str</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>
        <span class="k">elif</span> <span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;big&#39;</span><span class="p">:</span>
            <span class="n">endian_str</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized byteorder. Use {&#39;little&#39;, &#39;big&#39;}&quot;</span><span class="p">)</span>

        <span class="n">hf</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;i4&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="n">endian_str</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">))</span>

    <span class="c1"># TODO: make sure all arrays have same byte order</span>

    <span class="c1"># TODO: use &quot;with&quot; statements (will always closes the file object?)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">fmode</span><span class="p">)</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot open file: &quot;</span> <span class="o">+</span> <span class="n">dest</span><span class="p">)</span>

    <span class="c1"># TODO: make sure all data have the same/desired byte order</span>

    <span class="c1"># actually write everything</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">hf</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">hi</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">hs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: this long way of writing it is to make sure that</span>
            <span class="c1"># &#39;f8&#39; data, for example, is correctly cast as &#39;f4&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">+</span> <span class="s1">&#39;f4&#39;</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot write SAC-buffer to file: &quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Unknown file name (file-like object?)&quot;</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="write_sac_ascii"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.write_sac_ascii.html#obspy.io.sac.arrayio.write_sac_ascii">[docs]</a><span class="k">def</span> <span class="nf">write_sac_ascii</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the header and (optionally) data arrays to a SAC ASCII file.</span>

<span class="sd">    :param dest: Full path or File-like object from SAC ASCII file on disk.</span>
<span class="sd">    :type dest: str or file</span>
<span class="sd">    :param hf: SAC float header array.</span>
<span class="sd">    :type hf: :class:`numpy.ndarray` of floats</span>
<span class="sd">    :param hi: SAC int header array.</span>
<span class="sd">    :type hi: :class:`numpy.ndarray` of ints</span>
<span class="sd">    :param hs: SAC string header array.</span>
<span class="sd">    :type hs: :class:`numpy.ndarray` of strings</span>
<span class="sd">    :param data: SAC data array.  If omitted or None, it is assumed that the</span>
<span class="sd">        user intends to overwrite/modify only the header arrays of an existing</span>
<span class="sd">        file.  Equivalent to &quot;writehdr&quot;. If data is None, better make sure the</span>
<span class="sd">        header you&#39;re writing matches any data already in the file.</span>
<span class="sd">    :type data: :class:`numpy.ndarray` of float32 or None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: fix prodigious use of file open/close for &quot;with&quot; statements.</span>

    <span class="c1"># file open modes in Python: http://stackoverflow.com/a/23566951/745557</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># file exists, just modify it (don&#39;t start from scratch)</span>
        <span class="n">fmode</span> <span class="o">=</span> <span class="s1">&#39;r+&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># start from scratch</span>
        <span class="n">fmode</span> <span class="o">=</span> <span class="s1">&#39;w+&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">fmode</span><span class="p">)</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot open file: &quot;</span> <span class="o">+</span> <span class="n">dest</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="n">is_file_name</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">hf</span><span class="p">,</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">fmt</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%#15.7g</span><span class="s2">&quot;</span><span class="p">),</span>
                   <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">fmt</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%10d</span><span class="s2">&quot;</span><span class="p">),</span>
                   <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|U8&#39;</span><span class="p">),</span>
                   <span class="n">fmt</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-8s</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;Cannot write header values: &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">npts</span> <span class="ow">in</span> <span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">npts</span> <span class="o">//</span> <span class="mi">5</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span> <span class="o">*</span> <span class="n">rows</span><span class="p">],</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">fmt</span><span class="o">=</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%#15.7g</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span> <span class="o">*</span> <span class="n">rows</span><span class="p">:],</span> <span class="n">delimiter</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">SacIOError</span><span class="p">(</span><span class="s2">&quot;Cannot write trace values: &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_file_name</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># ---------------------- HEADER ARRAY / DICTIONARY CONVERTERS -----------------</span>
<span class="c1"># TODO: this functionality is basically the same as the getters and setters in</span>
<span class="c1">#    sac.sactrace. find a way to avoid duplication?</span>
<span class="c1"># TODO: put these in sac.util?</span>
<div class="viewcode-block" id="header_arrays_to_dict"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.header_arrays_to_dict.html#obspy.io.sac.arrayio.header_arrays_to_dict">[docs]</a><span class="k">def</span> <span class="nf">header_arrays_to_dict</span><span class="p">(</span><span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">nulls</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert SAC header arrays to a more user-friendly dict.</span>

<span class="sd">    :param hf: SAC float header array.</span>
<span class="sd">    :type hf: :class:`numpy.ndarray` of floats</span>
<span class="sd">    :param hi: SAC int header array.</span>
<span class="sd">    :type hi: :class:`numpy.ndarray` of ints</span>
<span class="sd">    :param hs: SAC string header array.</span>
<span class="sd">    :type hs: :class:`numpy.ndarray` of strings</span>
<span class="sd">    :param nulls: If True, return all header values, including nulls, else</span>
<span class="sd">        omit them.</span>
<span class="sd">    :type nulls: bool</span>

<span class="sd">    :return: SAC header dictionary</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nulls</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="p">,</span> <span class="n">hf</span><span class="p">))</span> <span class="o">+</span> \
            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="p">,</span> <span class="n">hi</span><span class="p">))</span> <span class="o">+</span> \
            <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">STRHDRS</span><span class="p">,</span> <span class="n">hs</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># more readable</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="p">,</span> <span class="n">hf</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">HD</span><span class="o">.</span><span class="n">FNULL</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">HD</span><span class="o">.</span><span class="n">STRHDRS</span><span class="p">,</span> <span class="n">hs</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="o">!=</span> <span class="n">HD</span><span class="o">.</span><span class="n">SNULL</span><span class="p">]</span>

    <span class="n">header</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="c1"># here, we have to append the 2nd kevnm field into the first and remove</span>
    <span class="c1">#   it from the dictionary.</span>
    <span class="c1"># XXX: kevnm may be null when kevnm2 isn&#39;t</span>
    <span class="k">if</span> <span class="s1">&#39;kevnm2&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;kevnm&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;kevnm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;kevnm&#39;</span><span class="p">]</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;kevnm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">header</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kevnm2&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;kevnm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kevnm2&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">header</span></div>


<div class="viewcode-block" id="dict_to_header_arrays"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.dict_to_header_arrays.html#obspy.io.sac.arrayio.dict_to_header_arrays">[docs]</a><span class="k">def</span> <span class="nf">dict_to_header_arrays</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;=&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns null hf, hi, hs arrays, optionally filled with values from a</span>
<span class="sd">    dictionary.</span>

<span class="sd">    No header checking.</span>

<span class="sd">    :param header: SAC header dictionary.</span>
<span class="sd">    :type header: dict</span>
<span class="sd">    :param byteorder: Desired byte order of initialized arrays (little, native,</span>
<span class="sd">        big).</span>
<span class="sd">    :type byteorder: str {&#39;&lt;&#39;, &#39;=&#39;, &#39;&gt;&#39;}</span>

<span class="sd">    :return: The float, integer, and string header arrays, in that order.</span>
<span class="sd">    :rtype: tuple of :class:`numpy.ndarray`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span> <span class="o">=</span> <span class="n">init_header_arrays</span><span class="p">(</span><span class="n">byteorder</span><span class="o">=</span><span class="n">byteorder</span><span class="p">)</span>

    <span class="c1"># have to split kevnm into two fields</span>
    <span class="c1"># TODO: add .lower() to hdr lookups, for safety</span>
    <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="p">:</span>
                <span class="n">hf</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Non-integers may be truncated: </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="n">HD</span><span class="o">.</span><span class="n">STRHDRS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hdr</span> <span class="o">==</span> <span class="s1">&#39;kevnm&#39;</span><span class="p">:</span>
                    <span class="c1"># assumes users will not include a &#39;kevnm2&#39; key</span>
                    <span class="c1"># XXX check for empty or null value?</span>
                    <span class="n">kevnm</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;8s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>
                    <span class="n">kevnm2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;8s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
                    <span class="n">hs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kevnm</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
                    <span class="n">hs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kevnm2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># TODO: why was encoding done?</span>
                    <span class="c1"># hs[HD.STRHDRS.index(hdr)] = value.encode(&#39;ascii&#39;,</span>
                    <span class="c1">#                                          &#39;strict&#39;)</span>
                    <span class="n">hs</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">STRHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unrecognized header name: </span><span class="si">{}</span><span class="s2">. Ignored.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span></div>


<div class="viewcode-block" id="validate_sac_content"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.validate_sac_content.html#obspy.io.sac.arrayio.validate_sac_content">[docs]</a><span class="k">def</span> <span class="nf">validate_sac_content</span><span class="p">(</span><span class="n">hf</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">tests</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check validity of loaded SAC file content, such as header/data consistency.</span>

<span class="sd">    :param hf: SAC float header array</span>
<span class="sd">    :type hf: :class:`numpy.ndarray` of floats</span>
<span class="sd">    :param hi: SAC int header array</span>
<span class="sd">    :type hi: :class:`numpy.ndarray` of ints</span>
<span class="sd">    :param hs: SAC string header array</span>
<span class="sd">    :type hs: :class:`numpy.ndarray` of str</span>
<span class="sd">    :param data: SAC data array</span>
<span class="sd">    :type data: :class:`numpy.ndarray` of float32</span>
<span class="sd">    :param tests: One or more of the following validity tests:</span>
<span class="sd">        &#39;delta&#39; : Time step &quot;delta&quot; is positive.</span>
<span class="sd">        &#39;logicals&#39; : Logical values are 0, 1, or null</span>
<span class="sd">        &#39;data_hdrs&#39; : Length, min, mean, max of data array match header values.</span>
<span class="sd">        &#39;enums&#39; : Check validity of enumerated values.</span>
<span class="sd">        &#39;reftime&#39; : Reference time values in header are all set.</span>
<span class="sd">        &#39;reltime&#39; : Relative time values in header are absolutely referenced.</span>
<span class="sd">        &#39;all&#39; : Do all tests.</span>
<span class="sd">    :type tests: str</span>

<span class="sd">    :raises: :class:`SacInvalidContentError` if any of the specified tests</span>
<span class="sd">        fail. :class:`ValueError` if &#39;data_hdrs&#39; is specified and data is None,</span>
<span class="sd">        empty array, or no tests specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: move this to util.py and write and use individual test functions,</span>
    <span class="c1"># so that all validity checks are in one place?</span>
    <span class="n">_all</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;logicals&#39;</span><span class="p">,</span> <span class="s1">&#39;data_hdrs&#39;</span><span class="p">,</span> <span class="s1">&#39;enums&#39;</span><span class="p">,</span> <span class="s1">&#39;reftime&#39;</span><span class="p">,</span> <span class="s1">&#39;reltime&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="n">_all</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tests</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No validation tests specified.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">([(</span><span class="n">itest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_all</span><span class="p">)</span> <span class="k">for</span> <span class="n">itest</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">]):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unrecognized validataion test specified&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;delta&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">dval</span> <span class="o">=</span> <span class="n">hf</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;delta&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dval</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Header &#39;delta&#39; must be &gt;= 0.&quot;</span>
            <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;logicals&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;leven&#39;</span><span class="p">,</span> <span class="s1">&#39;lpspol&#39;</span><span class="p">,</span> <span class="s1">&#39;lovrok&#39;</span><span class="p">,</span> <span class="s1">&#39;lcalda&#39;</span><span class="p">):</span>
            <span class="n">lval</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">lval</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Header &#39;</span><span class="si">{}</span><span class="s2">&#39; must be {{</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">}}.&quot;</span>
                <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;data_hdrs&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">hf</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;depmin&#39;</span><span class="p">)],</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">is_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">hf</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;depmax&#39;</span><span class="p">)],</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">is_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">hf</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;depmen&#39;</span><span class="p">)],</span>
                                  <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">is_min</span><span class="p">,</span> <span class="n">is_max</span><span class="p">,</span> <span class="n">is_mean</span><span class="p">]):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Data headers don&#39;t match data array.&quot;</span>
                <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Data array is None, empty array, or non-array. &quot;</span> <span class="o">+</span> \
                  <span class="s2">&quot;Cannot check data headers.&quot;</span>
            <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;enums&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="n">HD</span><span class="o">.</span><span class="n">ACCEPTED_VALS</span><span class="p">:</span>
            <span class="n">enval</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_enum_int</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">enval</span><span class="p">,</span> <span class="n">allow_null</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid enumerated value, &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">enval</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;reftime&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="n">nzyear</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzyear&#39;</span><span class="p">)]</span>
        <span class="n">nzjday</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzjday&#39;</span><span class="p">)]</span>
        <span class="n">nzhour</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzhour&#39;</span><span class="p">)]</span>
        <span class="n">nzmin</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzmin&#39;</span><span class="p">)]</span>
        <span class="n">nzsec</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzsec&#39;</span><span class="p">)]</span>
        <span class="n">nzmsec</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nzmsec&#39;</span><span class="p">)]</span>

        <span class="c1"># all header reference time fields are set</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">val</span> <span class="o">!=</span> <span class="n">HD</span><span class="o">.</span><span class="n">INULL</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span>
                    <span class="p">[</span><span class="n">nzyear</span><span class="p">,</span> <span class="n">nzjday</span><span class="p">,</span> <span class="n">nzhour</span><span class="p">,</span> <span class="n">nzmin</span><span class="p">,</span> <span class="n">nzsec</span><span class="p">,</span> <span class="n">nzmsec</span><span class="p">]]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Null reference time values detected.&quot;</span>
            <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># reference time fields are reasonable values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">nzyear</span><span class="p">,</span> <span class="n">julday</span><span class="o">=</span><span class="n">nzjday</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">nzhour</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="n">nzmin</span><span class="p">,</span>
                        <span class="n">second</span><span class="o">=</span><span class="n">nzsec</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="n">nzmsec</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="s2">&quot;Invalid reference time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;reltime&#39;</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="c1"># iztype is set and points to a non-null header value</span>
        <span class="n">iztype_val</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;iztype&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">is_valid_enum_int</span><span class="p">(</span><span class="s1">&#39;iztype&#39;</span><span class="p">,</span> <span class="n">iztype_val</span><span class="p">,</span> <span class="n">allow_null</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iztype_val</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="n">hdr</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
            <span class="k">elif</span> <span class="n">iztype_val</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">hdr</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
            <span class="k">elif</span> <span class="n">iztype_val</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">hdr</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
            <span class="k">elif</span> <span class="n">iztype_val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">23</span><span class="p">):</span>
                <span class="n">hdr</span> <span class="o">=</span> <span class="s1">&#39;it&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iztype_val</span> <span class="o">-</span> <span class="mi">13</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">FLOATHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hdr</span><span class="p">)]</span> <span class="o">==</span> <span class="n">HD</span><span class="o">.</span><span class="n">INULL</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Reference header &#39;</span><span class="si">{}</span><span class="s2">&#39; for iztype &#39;</span><span class="si">{}</span><span class="s2">&#39; not set.&quot;</span>
                <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">iztype_val</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid iztype: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iztype_val</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SacInvalidContentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="is_valid_byteorder"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.sac.arrayio.is_valid_byteorder.html#obspy.io.sac.arrayio.is_valid_byteorder">[docs]</a><span class="k">def</span> <span class="nf">is_valid_byteorder</span><span class="p">(</span><span class="n">hi</span><span class="p">):</span>
    <span class="n">nvhdr</span> <span class="o">=</span> <span class="n">hi</span><span class="p">[</span><span class="n">HD</span><span class="o">.</span><span class="n">INTHDRS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;nvhdr&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">nvhdr</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span></div>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a> &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, lafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Kufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaim, Sbastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clment</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Khler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>