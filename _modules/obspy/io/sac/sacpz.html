<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.sac.sacpz &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="http://docs.obspy.org/search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.sac.sacpz</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for SAC poles and zero (SACPZ) file I/O.</span>

<span class="sd">:copyright:</span>
<span class="sd">    The ObsPy Development Team (devs@obspy.org)</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License, Version 3</span>
<span class="sd">    (https://www.gnu.org/copyleft/lesser.html)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">native_str</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">obspy.core</span> <span class="k">import</span> <span class="n">AttribDict</span>
<span class="kn">from</span> <span class="nn">obspy.core.inventory.response</span> <span class="k">import</span> <span class="n">paz_to_sacpz_string</span>
<span class="kn">from</span> <span class="nn">obspy.core.util.deprecation_helpers</span> <span class="k">import</span> \
    <span class="n">DynamicAttributeImportRerouteModule</span>


<div class="viewcode-block" id="_write_sacpz"><a class="viewcode-back" href="../../../../packages/obspy.io.sac.sacpz._write_sacpz.html#obspy.io.sac.sacpz._write_sacpz">[docs]</a><span class="k">def</span> <span class="nf">_write_sacpz</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">file_or_file_object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes an inventory object to a SACPZ file.</span>

<span class="sd">    .. note::</span>
<span class="sd">        The channel DIP in the SACPZ comment fields is specified like defined</span>
<span class="sd">        by SEED (positive down from horizontal).</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function should NOT be called directly, it registers via the</span>
<span class="sd">        the :meth:`~obspy.core.inventory.inventory.Inventory.write` method</span>
<span class="sd">        of an ObsPy :class:`~obspy.core.inventory.inventory.Inventory` object,</span>
<span class="sd">        call this instead.</span>

<span class="sd">    :type inventory: :class:`~obspy.core.inventory.inventory.Inventory`</span>
<span class="sd">    :param inventory: The inventory instance to be written.</span>
<span class="sd">    :param file_or_file_object: The file or file-like object to be written to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">net</span> <span class="ow">in</span> <span class="n">inventory</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sta</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cha</span> <span class="ow">in</span> <span class="n">sta</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">cha</span><span class="o">.</span><span class="n">response</span>
                <span class="n">sens</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">instrument_sensitivity</span>
                <span class="n">paz</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">get_paz</span><span class="p">()</span>
                <span class="n">input_unit</span> <span class="o">=</span> <span class="n">sens</span><span class="o">.</span><span class="n">input_units</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">input_unit</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">input_unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M/S&quot;</span><span class="p">,</span> <span class="s2">&quot;M/SEC&quot;</span><span class="p">]:</span>
                    <span class="n">paz</span><span class="o">.</span><span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="n">j</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">input_unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M/S**2&quot;</span><span class="p">,</span> <span class="s2">&quot;M/SEC**2&quot;</span><span class="p">]:</span>
                    <span class="n">paz</span><span class="o">.</span><span class="n">zeros</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Encountered unrecognized input units in response: &quot;</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_unit</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* NETWORK     : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">net</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* STATION     : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sta</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* LOCATION    : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">location_code</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* CHANNEL     : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* CREATED     : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">now</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* START       : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* END         : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* DESCRIPTION : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sta</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* LATITUDE    : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cha</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">or</span>
                                                   <span class="n">sta</span><span class="o">.</span><span class="n">latitude</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* LONGITUDE   : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cha</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">or</span>
                                                   <span class="n">sta</span><span class="o">.</span><span class="n">longitude</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* ELEVATION   : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cha</span><span class="o">.</span><span class="n">elevation</span> <span class="ow">or</span>
                                                   <span class="n">sta</span><span class="o">.</span><span class="n">elevation</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* DEPTH       : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
                <span class="c1"># DIP in SACPZ served by IRIS SACPZ web service is</span>
                <span class="c1"># systematically different from the StationXML entries.</span>
                <span class="c1"># It is defined as an incidence angle (like done in SAC for</span>
                <span class="c1"># sensor orientation), rather than an actual dip.</span>
                <span class="c1"># Add &#39;(SEED)&#39; to clarify that we adhere to SEED convention</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* DIP (SEED)  : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">dip</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* AZIMUTH     : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* SAMPLE RATE : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* INPUT UNIT  : M&quot;</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* OUTPUT UNIT : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sens</span><span class="o">.</span><span class="n">output_units</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* INSTTYPE    : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cha</span><span class="o">.</span><span class="n">sensor</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* INSTGAIN    : </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">paz</span><span class="o">.</span><span class="n">stage_gain</span><span class="p">,</span>
                                                        <span class="n">sens</span><span class="o">.</span><span class="n">input_units</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* SENSITIVITY : </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sens</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                        <span class="n">sens</span><span class="o">.</span><span class="n">input_units</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* A0          : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">paz</span><span class="o">.</span><span class="n">normalization_factor</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paz_to_sacpz_string</span><span class="p">(</span><span class="n">paz</span><span class="p">,</span> <span class="n">sens</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_or_file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_or_file_object</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<span class="c1"># UTILITIES</span>
<div class="viewcode-block" id="attach_paz"><a class="viewcode-back" href="../../../../packages/obspy.io.sac.sacpz.attach_paz.html#obspy.io.sac.sacpz.attach_paz">[docs]</a><span class="k">def</span> <span class="nf">attach_paz</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">paz_file</span><span class="p">,</span> <span class="n">todisp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tovel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">torad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">tohz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Attach tr.stats.paz AttribDict to trace from SAC paz_file</span>

<span class="sd">    This is experimental code, taken from</span>
<span class="sd">    obspy.io.gse2.libgse2.attach_paz and adapted to the SAC-pole-zero</span>
<span class="sd">    conventions. Especially the conversion from velocity to</span>
<span class="sd">    displacement and vice versa is still under construction. It works</span>
<span class="sd">    but I cannot guarantee that the values are correct. For more</span>
<span class="sd">    information on the SAC-pole-zero format see:</span>
<span class="sd">    https://ds.iris.edu/files/sac-manual/commands/transfer.html. For a</span>
<span class="sd">    useful discussion on polezero files and transfer functions in</span>
<span class="sd">    general see:</span>
<span class="sd">    http://seis-uk.le.ac.uk/equipment/downloads/data_management/\</span>
<span class="sd">seisuk_instrument_resp_removal.pdf</span>
<span class="sd">    Also bear in mind that according to the SAC convention for</span>
<span class="sd">    pole-zero files CONSTANT is defined as:</span>
<span class="sd">    digitizer_gain*seismometer_gain*A0. This means that it does not</span>
<span class="sd">    have explicit information on the digitizer gain and seismometer</span>
<span class="sd">    gain which we therefore set to 1.0.</span>

<span class="sd">    Attaches to a trace a paz AttribDict containing poles zeros and gain.</span>

<span class="sd">    :param tr: An ObsPy :class:`~obspy.core.trace.Trace` object</span>
<span class="sd">    :param paz_file: path to pazfile or file pointer</span>
<span class="sd">    :param todisp: change a velocity transfer function to a displacement</span>
<span class="sd">                   transfer function by adding another zero</span>
<span class="sd">    :param tovel: change a displacement transfer function to a velocity</span>
<span class="sd">                  transfer function by removing one 0,0j zero</span>
<span class="sd">    :param torad: change to radians</span>
<span class="sd">    :param tohz: change to Hertz</span>

<span class="sd">    &gt;&gt;&gt; from obspy import Trace</span>
<span class="sd">    &gt;&gt;&gt; import io</span>
<span class="sd">    &gt;&gt;&gt; tr = Trace()</span>
<span class="sd">    &gt;&gt;&gt; f = io.StringIO(&quot;&quot;&quot;ZEROS 3</span>
<span class="sd">    ... -5.032 0.0</span>
<span class="sd">    ... POLES 6</span>
<span class="sd">    ... -0.02365 0.02365</span>
<span class="sd">    ... -0.02365 -0.02365</span>
<span class="sd">    ... -39.3011 0.</span>
<span class="sd">    ... -7.74904 0.</span>
<span class="sd">    ... -53.5979 21.7494</span>
<span class="sd">    ... -53.5979 -21.7494</span>
<span class="sd">    ... CONSTANT 2.16e18&quot;&quot;&quot;)</span>
<span class="sd">    &gt;&gt;&gt; attach_paz(tr, f,torad=True)</span>
<span class="sd">    &gt;&gt;&gt; for z in tr.stats.paz[&#39;zeros&#39;]:</span>
<span class="sd">    ...     print(&quot;%.2f %.2f&quot; % (z.real, z.imag))</span>
<span class="sd">    -31.62 0.00</span>
<span class="sd">    0.00 0.00</span>
<span class="sd">    0.00 0.00</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paz_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">native_str</span><span class="p">)):</span>
        <span class="n">paz_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paz_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">is_filename</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_filename</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">paz_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c1"># lines starting with * are comments</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ZEROS&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">noz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">noz</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">paz_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;POLES&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> \
                       <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;CONSTANT&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> \
                       <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">noz</span><span class="p">:</span>
                            <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">))</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;POLES&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">nop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nop</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">paz_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;CONSTANT&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> \
                       <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ZEROS&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> \
                       <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">poles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nop</span><span class="p">:</span>
                            <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">))</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;CONSTANT&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># in the observatory this is the seismometer gain [muVolt/nm/s]</span>
                <span class="c1"># the A0_normalization_factor is hardcoded to 1.0</span>
                <span class="n">constant</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_filename</span><span class="p">:</span>
            <span class="n">paz_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># To convert the velocity response to the displacement response,</span>
    <span class="c1"># multiplication with jw is used. This is equivalent to one more</span>
    <span class="c1"># zero in the pole-zero representation</span>
    <span class="k">if</span> <span class="n">todisp</span><span class="p">:</span>
        <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">))</span>

    <span class="c1"># To convert the displacement response to the velocity response,</span>
    <span class="c1"># division with jw is used. This is equivalent to one less zero</span>
    <span class="c1"># in the pole-zero representation</span>
    <span class="k">if</span> <span class="n">tovel</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zero</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">zero</span> <span class="o">==</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">):</span>
                <span class="n">zeros</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not remove (0,0j) zero to change </span><span class="se">\</span>
<span class="s2">            displacement response to velocity response&quot;</span><span class="p">)</span>

    <span class="c1"># convert poles, zeros and gain in Hertz to radians</span>
    <span class="k">if</span> <span class="n">torad</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zeros</span><span class="p">]</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poles</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="c1"># When extracting RESP files and SAC_PZ files</span>
        <span class="c1"># from a dataless SEED using the rdseed program</span>
        <span class="c1"># where the former is in Hz and the latter in radians,</span>
        <span class="c1"># there gains seem to be unaffected by this.</span>
        <span class="c1"># According to this document:</span>
        <span class="c1"># http://www.le.ac.uk/</span>
        <span class="c1">#         seis-uk/downloads/seisuk_instrument_resp_removal.pdf</span>
        <span class="c1"># the gain should also be converted when changing from</span>
        <span class="c1"># hertz to radians or vice versa. However, the rdseed programs</span>
        <span class="c1"># does not do this. I&#39;m not entirely sure at this stage which one is</span>
        <span class="c1"># correct or if I have missed something. I&#39;ve therefore decided</span>
        <span class="c1"># to leave it out for now, in order to stay compatible with the</span>
        <span class="c1"># rdseed program and the SAC program.</span>
        <span class="c1"># constant *= (2. * np.pi) ** 3</span>

    <span class="c1"># convert poles, zeros and gain in radian to Hertz</span>
    <span class="k">if</span> <span class="n">tohz</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zeros</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poles</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c1"># constant /= (2. * np.pi) ** 3</span>

    <span class="c1"># fill up ObsPy Poles and Zeros AttribDict</span>
    <span class="c1"># In SAC pole-zero files CONSTANT is defined as:</span>
    <span class="c1"># digitizer_gain*seismometer_gain*A0</span>

    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span> <span class="o">=</span> <span class="n">AttribDict</span><span class="p">()</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">seismometer_gain</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">digitizer_gain</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">poles</span> <span class="o">=</span> <span class="n">poles</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">zeros</span>
    <span class="c1"># taken from obspy.io.gse2.paz:145</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">sensitivity</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">digitizer_gain</span> <span class="o">*</span> \
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">seismometer_gain</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="n">constant</span></div>


<div class="viewcode-block" id="attach_resp"><a class="viewcode-back" href="../../../../packages/obspy.io.sac.sacpz.attach_resp.html#obspy.io.sac.sacpz.attach_resp">[docs]</a><span class="k">def</span> <span class="nf">attach_resp</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">resp_file</span><span class="p">,</span> <span class="n">todisp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tovel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">torad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">tohz</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract key instrument response information from a RESP file, which</span>
<span class="sd">    can be extracted from a dataless SEED volume by, for example, using</span>
<span class="sd">    the script obspy-dataless2resp or the rdseed program. At the moment,</span>
<span class="sd">    you have to determine yourself if the given response is for velocity</span>
<span class="sd">    or displacement and if the values are given in rad or Hz. This is</span>
<span class="sd">    still experimental code (see also documentation for</span>
<span class="sd">    :func:`obspy.io.sac.sacio.attach_paz`).</span>
<span class="sd">    Attaches to a trace a paz AttribDict containing poles, zeros, and gain.</span>

<span class="sd">    :param tr: An ObsPy :class:`~obspy.core.trace.Trace` object</span>
<span class="sd">    :param resp_file: path to RESP-file or file pointer</span>
<span class="sd">    :param todisp: change a velocity transfer function to a displacement</span>
<span class="sd">                   transfer function by adding another zero</span>
<span class="sd">    :param tovel: change a displacement transfer function to a velocity</span>
<span class="sd">                  transfer function by removing one 0,0j zero</span>
<span class="sd">    :param torad: change to radians</span>
<span class="sd">    :param tohz: change to Hertz</span>

<span class="sd">    &gt;&gt;&gt; from obspy import Trace</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; tr = Trace()</span>
<span class="sd">    &gt;&gt;&gt; respfile = os.path.join(os.path.dirname(__file__), &#39;tests&#39;, &#39;data&#39;,</span>
<span class="sd">    ...                         &#39;RESP.NZ.CRLZ.10.HHZ&#39;)</span>
<span class="sd">    &gt;&gt;&gt; attach_resp(tr, respfile, torad=True, todisp=False)</span>
<span class="sd">    &gt;&gt;&gt; for k in sorted(tr.stats.paz):  # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    ...     print(k)</span>
<span class="sd">    digitizer_gain</span>
<span class="sd">    gain</span>
<span class="sd">    poles</span>
<span class="sd">    seismometer_gain</span>
<span class="sd">    sensitivity</span>
<span class="sd">    t_shift</span>
<span class="sd">    zeros</span>
<span class="sd">    &gt;&gt;&gt; print(tr.stats.paz.poles)  # doctest: +NORMALIZE_WHITESPACE +ELLIPSIS</span>
<span class="sd">    [(-0.15931...+0.15931...j), (-0.15931...-0.15931...j),</span>
<span class="sd">     (-314.159...+202.318...j), (-314.159...-202.318...j)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">resp_file</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">resp_filep</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">resp_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resp_filep</span> <span class="o">=</span> <span class="n">resp_file</span>

    <span class="n">zeros_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;B053F10-13&#39;</span>
    <span class="n">poles_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;B053F15-18&#39;</span>
    <span class="n">a0_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;B053F07&#39;</span>
    <span class="n">sens_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;B058F04&#39;</span>
    <span class="n">t_shift_pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;B057F08&#39;</span>
    <span class="n">t_shift</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">resp_filep</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">a0_pat</span><span class="p">):</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sens_pat</span><span class="p">):</span>
            <span class="n">sens</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">poles_pat</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">zeros_pat</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">t_shift_pat</span><span class="p">):</span>
            <span class="n">t_shift</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">constant</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">sens</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">resp_file</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">resp_filep</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">torad</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zeros</span><span class="p">]</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poles</span><span class="p">]</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="n">tmp</span>

    <span class="k">if</span> <span class="n">todisp</span><span class="p">:</span>
        <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">))</span>

    <span class="c1"># To convert the displacement response to the velocity response,</span>
    <span class="c1"># division with jw is used. This is equivalent to one less zero</span>
    <span class="c1"># in the pole-zero representation</span>
    <span class="k">if</span> <span class="n">tovel</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zero</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">zeros</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">zero</span> <span class="o">==</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">j</span><span class="p">):</span>
                <span class="n">zeros</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not remove (0,0j) zero to change </span><span class="se">\</span>
<span class="s2">            displacement response to velocity response&quot;</span><span class="p">)</span>

    <span class="c1"># convert poles, zeros and gain in radian to Hertz</span>
    <span class="k">if</span> <span class="n">tohz</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zeros</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poles</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">constant</span> <span class="o">/=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>

    <span class="c1"># fill up ObsPy Poles and Zeros AttribDict</span>
    <span class="c1"># In SAC pole-zero files CONSTANT is defined as:</span>
    <span class="c1"># digitizer_gain*seismometer_gain*A0</span>

    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span> <span class="o">=</span> <span class="n">AttribDict</span><span class="p">()</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">seismometer_gain</span> <span class="o">=</span> <span class="n">sens</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">digitizer_gain</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">poles</span> <span class="o">=</span> <span class="n">poles</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">zeros</span>
    <span class="c1"># taken from obspy.io.gse2.paz:145</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">sensitivity</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">digitizer_gain</span> <span class="o">*</span> \
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">seismometer_gain</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="n">constant</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">paz</span><span class="o">.</span><span class="n">t_shift</span> <span class="o">=</span> <span class="n">t_shift</span></div>


<span class="c1"># Remove once 0.11 has been released.</span>
<span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">DynamicAttributeImportRerouteModule</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">locs</span><span class="o">=</span><span class="nb">locals</span><span class="p">(),</span>
    <span class="n">original_module</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span>
    <span class="n">import_map</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">function_map</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;write_SACPZ&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.sac.sacpz._write_sacpz&#39;</span><span class="p">})</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a>™ &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, Ólafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Käufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhäusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaimé, Sébastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clément</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Köhler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n° 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>