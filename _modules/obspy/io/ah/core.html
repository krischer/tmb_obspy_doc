<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.ah.core &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="http://docs.obspy.org/search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.ah.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AH bindings to ObsPy core module.</span>

<span class="sd">An AH file is used for the storage of binary seismic time series data.</span>
<span class="sd">The file is portable among machines of varying architecture by virtue of</span>
<span class="sd">its XDR implementation. It is composed of a variable-sized header containing</span>
<span class="sd">a number of values followed by the time series data.</span>

<span class="sd">.. seealso:: ftp://www.orfeus-eu.org/pub/software/mirror/ldeo.columbia/</span>

<span class="sd">:copyright:</span>
<span class="sd">    The ObsPy Development Team (devs@obspy.org)</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License, Version 3</span>
<span class="sd">    (https://www.gnu.org/copyleft/lesser.html)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA @UnusedWildImport</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">xdrlib</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">obspy.core.util.attribdict</span> <span class="k">import</span> <span class="n">AttribDict</span>
<span class="kn">from</span> <span class="nn">obspy.core.util.deprecation_helpers</span> <span class="k">import</span> \
    <span class="n">DynamicAttributeImportRerouteModule</span>


<div class="viewcode-block" id="_is_ah"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._is_ah.html#obspy.io.ah.core._is_ah">[docs]</a><span class="k">def</span> <span class="nf">_is_ah</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a file is AH waveform data or not.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: AH file to be checked.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    :return: ``True`` if a AH waveform file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_get_ah_version</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="_read_ah"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._read_ah.html#obspy.io.ah.core._read_ah">[docs]</a><span class="k">def</span> <span class="nf">_read_ah</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an AH waveform file and returns a Stream object.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function should NOT be called directly, it registers via the</span>
<span class="sd">        ObsPy :func:`~obspy.core.stream.read` function, call this instead.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: AH file to be read.</span>
<span class="sd">    :rtype: :class:`~obspy.core.stream.Stream`</span>
<span class="sd">    :returns: Stream with Traces specified by given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">_get_ah_version</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;2.0&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_read_ah2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_read_ah1</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="_get_ah_version"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._get_ah_version.html#obspy.io.ah.core._get_ah_version">[docs]</a><span class="k">def</span> <span class="nf">_get_ah_version</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns version of AH waveform data.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: AH v1 file to be checked.</span>
<span class="sd">    :rtype: str or False</span>
<span class="sd">    :return: version string of AH waveform data or ``False`` if unknown.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="c1"># read first 8 bytes with XDR library</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
            <span class="c1"># check for magic version number</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">magic</span> <span class="o">==</span> <span class="mi">1100</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># get record length</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>
                <span class="c1"># read first record</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># seems to be AH v2</span>
            <span class="k">return</span> <span class="s1">&#39;2.0&#39;</span>
        <span class="k">elif</span> <span class="n">magic</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># AH1 has no magic variable :/</span>
            <span class="c1"># so we have to use some fixed values as indicators</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">700</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">784</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">202</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="_unpack_string"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._unpack_string.html#obspy.io.ah.core._unpack_string">[docs]</a><span class="k">def</span> <span class="nf">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="_read_ah1"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._read_ah1.html#obspy.io.ah.core._read_ah1">[docs]</a><span class="k">def</span> <span class="nf">_read_ah1</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an AH v1 waveform file and returns a Stream object.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: AH v1 file to be read.</span>
<span class="sd">    :rtype: :class:`~obspy.core.stream.Stream`</span>
<span class="sd">    :returns: Stream with Traces specified by given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_unpack_trace</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">ah_stats</span> <span class="o">=</span> <span class="n">AttribDict</span><span class="p">({</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;extras&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>

        <span class="c1"># station info</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># A0</span>
        <span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="c1"># first value describes number of poles/zeros</span>
        <span class="n">npoles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">poles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nzeros</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">poles</span> <span class="o">=</span> <span class="n">poles</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">npoles</span><span class="p">]</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nzeros</span><span class="p">]</span>

        <span class="c1"># event info</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ot_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_mon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_day</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_hour</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_sec</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ot</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">ot_year</span><span class="p">,</span> <span class="n">ot_mon</span><span class="p">,</span> <span class="n">ot_day</span><span class="p">,</span> <span class="n">ot_hour</span><span class="p">,</span> <span class="n">ot_min</span><span class="p">,</span> <span class="n">ot_sec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">origin_time</span> <span class="o">=</span> <span class="n">ot</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># record info</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># data type</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">ndata</span> <span class="o">=</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>  <span class="c1"># number of samples</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># sampling interval</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">max_amplitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">at_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_mon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_day</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_hour</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_sec</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">at</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">at_year</span><span class="p">,</span> <span class="n">at_mon</span><span class="p">,</span> <span class="n">at_day</span><span class="p">,</span> <span class="n">at_hour</span><span class="p">,</span> <span class="n">at_min</span><span class="p">,</span> <span class="n">at_sec</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">at</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">abscissa_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># extras</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">)</span>

        <span class="c1"># unpack data using dtype from record info</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># float</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_farray</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># double</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_farray</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># e.g. 3 (vector), 2 (complex), 4 (tensor)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unsupported AH v1 record type </span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ah</span> <span class="o">=</span> <span class="n">ah_stats</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">delta</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">start_time</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">code</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">channel</span>
        <span class="k">return</span> <span class="n">tr</span>

    <span class="n">st</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="c1"># read with XDR library</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="c1"># loop as long we can read records</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="n">_unpack_trace</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">st</span></div>


<div class="viewcode-block" id="_read_ah2"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.ah.core._read_ah2.html#obspy.io.ah.core._read_ah2">[docs]</a><span class="k">def</span> <span class="nf">_read_ah2</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an AH v2 waveform file and returns a Stream object.</span>

<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: AH v2 file to be read.</span>
<span class="sd">    :rtype: :class:`~obspy.core.stream.Stream`</span>
<span class="sd">    :returns: Stream with Traces specified by given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_unpack_trace</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">ah_stats</span> <span class="o">=</span> <span class="n">AttribDict</span><span class="p">({</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;2.0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;event&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">AttribDict</span><span class="p">(),</span>
            <span class="s1">&#39;extras&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>

        <span class="c1"># station info</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># undocumented extra int?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># here too?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># and again?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">recorder</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># degrees E from N</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">dip</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># up = -90, down = +90</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># A0</span>

        <span class="n">npoles</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">poles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoles</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">poles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="n">nzeros</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">zeros</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nzeros</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
            <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># event info</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">ot_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_mon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_day</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_hour</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ot_sec</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ot</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">ot_year</span><span class="p">,</span> <span class="n">ot_mon</span><span class="p">,</span> <span class="n">ot_day</span><span class="p">,</span> <span class="n">ot_hour</span><span class="p">,</span> <span class="n">ot_min</span><span class="p">,</span> <span class="n">ot_sec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">origin_time</span> <span class="o">=</span> <span class="n">ot</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># and again?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># record info</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># data type</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">ndata</span> <span class="o">=</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>  <span class="c1"># number of samples</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>  <span class="c1"># sampling interval</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">max_amplitude</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">at_year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_mon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_day</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_hour</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">at_sec</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">at</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">at_year</span><span class="p">,</span> <span class="n">at_mon</span><span class="p">,</span> <span class="n">at_day</span><span class="p">,</span> <span class="n">at_hour</span><span class="p">,</span> <span class="n">at_min</span><span class="p">,</span> <span class="n">at_sec</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">at</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">inunits</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">outunits</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># and again?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># and again?</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># user attributes</span>
        <span class="n">nusrattr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">ah_stats</span><span class="o">.</span><span class="n">usrattr</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nusrattr</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_unpack_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">ah_stats</span><span class="o">.</span><span class="n">usrattr</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># unpack data using dtype from record info</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># float</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_farray</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># double</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_farray</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_double</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># e.g. 3 (vector), 2 (complex), 4 (tensor)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unsupported AH v2 record type </span><span class="si">%d</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">dtype</span><span class="p">))</span>

        <span class="n">tr</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ah</span> <span class="o">=</span> <span class="n">ah_stats</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">delta</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">start_time</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">code</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">ah_stats</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">channel</span>
        <span class="k">return</span> <span class="n">tr</span>

    <span class="n">st</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="c1"># loop as long we can read records</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># read first 8 bytes with XDR library</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
                <span class="c1"># check magic version number</span>
                <span class="n">magic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">magic</span> <span class="o">!=</span> <span class="mi">1100</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not a AH v2 file&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># get record length</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>
                <span class="c1"># read rest of record into XDR unpacker</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">xdrlib</span><span class="o">.</span><span class="n">Unpacker</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="n">_unpack_trace</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">st</span></div>


<span class="c1"># Remove once 0.11 has been released.</span>
<span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">DynamicAttributeImportRerouteModule</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">locs</span><span class="o">=</span><span class="nb">locals</span><span class="p">(),</span>
    <span class="n">original_module</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span>
    <span class="n">import_map</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">function_map</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;is_AH&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.ah.core._is_ah&#39;</span><span class="p">,</span>
        <span class="s1">&#39;read_AH&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.ah.core._read_ah&#39;</span><span class="p">,</span>
        <span class="s1">&#39;read_AH1&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.ah.core._read_ah1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;read_AH2&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.ah.core._read_ah2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_get_AH_version&#39;</span><span class="p">:</span> <span class="s1">&#39;obspy.io.ah.core._get_ah_version&#39;</span><span class="p">})</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a>™ &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, Ólafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Käufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhäusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaimé, Sébastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clément</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Köhler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n° 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>