<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.shapefile.core &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.shapefile.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA</span>
<span class="kn">from</span> <span class="nn">future.utils</span> <span class="k">import</span> <span class="n">native_str</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">Catalog</span>
<span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="k">import</span> <span class="n">Origin</span><span class="p">,</span> <span class="n">Magnitude</span>
<span class="kn">from</span> <span class="nn">obspy.core.inventory</span> <span class="k">import</span> <span class="n">Inventory</span>
<span class="kn">from</span> <span class="nn">obspy.core.util</span> <span class="k">import</span> <span class="n">to_int_or_zero</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gdal</span>
    <span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">ogr</span><span class="p">,</span> <span class="n">osr</span>
    <span class="kn">from</span> <span class="nn">osgeo.gdal</span> <span class="k">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">__gdal_version__</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">HAS_GDAL</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">GDAL_VERSION_SUFFICIENT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">IMPORTERROR_MSG</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
        <span class="s2">&quot;. ObsPy&#39;s write support for shapefiles requires the &#39;gdal&#39; module &quot;</span>
        <span class="s2">&quot;to be installed in addition to the general ObsPy dependencies.&quot;</span><span class="p">)</span>
    <span class="n">GDAL_TOO_OLD_MSG</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
        <span class="s2">&quot;. ObsPy&#39;s write support for shapefiles requires the &#39;gdal&#39; module &quot;</span>
        <span class="s2">&quot;to be installed in a more recent version.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">HAS_GDAL</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">GDAL_VERSION_SUFFICIENT</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
        <span class="n">to_int_or_zero</span><span class="p">,</span> <span class="n">__gdal_version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">UseExceptions</span><span class="p">()</span>


<div class="viewcode-block" id="_write_shapefile"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.shapefile.core._write_shapefile.html#obspy.io.shapefile.core._write_shapefile">[docs]</a><span class="k">def</span> <span class="nf">_write_shapefile</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write :class:`~obspy.core.inventory.inventory.Inventory` or</span>
<span class="sd">    :class:`~obspy.core.event.Catalog` object to a ESRI shapefile.</span>

<span class="sd">    :type obj: :class:`~obspy.core.event.Catalog` or</span>
<span class="sd">        :class:`~obspy.core.inventory.Inventory`</span>
<span class="sd">    :param obj: ObsPy object for shapefile output</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: Filename to write to. According to ESRI shapefile</span>
<span class="sd">        definition, multiple files with the following suffixes will be written:</span>
<span class="sd">        &quot;.shp&quot;, &quot;.shx&quot;, &quot;.dbj&quot;, &quot;.prj&quot;. If filename does not end with &quot;.shp&quot;,</span>
<span class="sd">        it will be appended. Other files will be created with respective</span>
<span class="sd">        suffixes accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GDAL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">IMPORTERROR_MSG</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">GDAL_VERSION_SUFFICIENT</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">GDAL_TOO_OLD_MSG</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.shp&quot;</span>

    <span class="n">driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">))</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">DeleteDataSource</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">data_source</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># create the layer</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Catalog</span><span class="p">):</span>
            <span class="n">_add_catalog_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Inventory</span><span class="p">):</span>
            <span class="n">_add_inventory_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Object for shapefile output must be &quot;</span>
                   <span class="s2">&quot;a Catalog or Inventory.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Destroy the data source to free resources</span>
        <span class="n">data_source</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="_add_catalog_layer"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.shapefile.core._add_catalog_layer.html#obspy.io.shapefile.core._add_catalog_layer">[docs]</a><span class="k">def</span> <span class="nf">_add_catalog_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">catalog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :type data_source: :class:`osgeo.ogr.DataSource`.</span>
<span class="sd">    :param data_source: OGR data source the layer is added to.</span>
<span class="sd">    :type catalog: :class:`~obspy.core.event.Catalog`</span>
<span class="sd">    :param catalog: Event data to add as a new layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GDAL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">IMPORTERROR_MSG</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">GDAL_VERSION_SUFFICIENT</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">GDAL_TOO_OLD_MSG</span><span class="p">)</span>

    <span class="c1"># [name, type, width, precision]</span>
    <span class="c1"># field name is 10 chars max</span>
    <span class="c1"># ESRI shapefile attributes are stored in dbf files, which can not</span>
    <span class="c1"># store datetimes, only dates, see:</span>
    <span class="c1"># http://www.gdal.org/drv_shapefile.html</span>
    <span class="c1"># use POSIX timestamp for exact origin time, set time of first pick</span>
    <span class="c1"># for events with no origin</span>
    <span class="n">field_definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;EventID&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;OriginID&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;MagID&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTDate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;OriginTime&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;FirstPick&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Depth&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">_create_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="s2">&quot;earthquakes&quot;</span><span class="p">,</span> <span class="n">field_definitions</span><span class="p">)</span>

    <span class="n">layer_definition</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">catalog</span><span class="p">:</span>
        <span class="c1"># try to use preferred origin/magnitude, fall back to first or use</span>
        <span class="c1"># empty one with `None` values in it</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">preferred_origin</span><span class="p">()</span> <span class="ow">or</span>
                  <span class="n">event</span><span class="o">.</span><span class="n">origins</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                  <span class="n">Origin</span><span class="p">(</span><span class="n">force_resource_id</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">preferred_magnitude</span><span class="p">()</span> <span class="ow">or</span>
                     <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                     <span class="n">Magnitude</span><span class="p">(</span><span class="n">force_resource_id</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">t_origin</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">time</span>
        <span class="n">pick_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span> <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">picks</span>
                      <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">t_pick</span> <span class="o">=</span> <span class="n">pick_times</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">pick_times</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">t_origin</span> <span class="ow">or</span> <span class="n">t_pick</span>

        <span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">layer_definition</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># setting fields with `None` results in values of `0.000`</span>
            <span class="c1"># need to really omit setting values if they are `None`</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;EventID&quot;</span><span class="p">),</span>
                                 <span class="n">native_str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">resource_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">origin</span><span class="o">.</span><span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;OriginID&quot;</span><span class="p">),</span>
                                 <span class="n">native_str</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">resource_id</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">t_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Use timestamp for exact timing</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;OriginTime&quot;</span><span class="p">),</span> <span class="n">t_origin</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t_pick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Use timestamp for exact timing</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;FirstPick&quot;</span><span class="p">),</span> <span class="n">t_pick</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># ESRI shapefile attributes are stored in dbf files, which can</span>
                <span class="c1"># not store datetimes, only dates. We still need to use the</span>
                <span class="c1"># GDAL API with precision up to seconds (aiming at other output</span>
                <span class="c1"># drivers of GDAL; `100` stands for GMT)</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                 <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
                                 <span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">origin</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">origin</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">origin</span><span class="o">.</span><span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Depth&quot;</span><span class="p">),</span> <span class="n">origin</span><span class="o">.</span><span class="n">depth</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">mag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">),</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">mag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;MagID&quot;</span><span class="p">),</span>
                                 <span class="n">native_str</span><span class="p">(</span><span class="n">magnitude</span><span class="o">.</span><span class="n">resource_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">origin</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">origin</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">)</span>
                <span class="n">point</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">origin</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

            <span class="n">layer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Destroy the feature to free resources</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="_add_inventory_layer"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.shapefile.core._add_inventory_layer.html#obspy.io.shapefile.core._add_inventory_layer">[docs]</a><span class="k">def</span> <span class="nf">_add_inventory_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">inventory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :type data_source: :class:`osgeo.ogr.DataSource`.</span>
<span class="sd">    :param data_source: OGR data source the layer is added to.</span>
<span class="sd">    :type inventory: :class:`~obspy.core.inventory.Inventory`</span>
<span class="sd">    :param inventory: Inventory data to add as a new layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_GDAL</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">IMPORTERROR_MSG</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">GDAL_VERSION_SUFFICIENT</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">GDAL_TOO_OLD_MSG</span><span class="p">)</span>

    <span class="c1"># [name, type, width, precision]</span>
    <span class="c1"># field name is 10 chars max</span>
    <span class="c1"># ESRI shapefile attributes are stored in dbf files, which can not</span>
    <span class="c1"># store datetimes, only dates, see:</span>
    <span class="c1"># http://www.gdal.org/drv_shapefile.html</span>
    <span class="c1"># use POSIX timestamp for exact origin time, set time of first pick</span>
    <span class="c1"># for events with no origin</span>
    <span class="n">field_definitions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;Network&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Station&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Elevation&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;StartDate&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTDate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;EndDate&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTDate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Channels&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">layer</span> <span class="o">=</span> <span class="n">_create_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="s2">&quot;stations&quot;</span><span class="p">,</span> <span class="n">field_definitions</span><span class="p">)</span>

    <span class="n">layer_definition</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">net</span> <span class="ow">in</span> <span class="n">inventory</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sta</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
            <span class="n">channel_list</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cha</span><span class="o">.</span><span class="n">location_code</span><span class="p">,</span> <span class="n">cha</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">cha</span> <span class="ow">in</span> <span class="n">sta</span><span class="p">])</span>

            <span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">layer_definition</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># setting fields with `None` results in values of `0.000`</span>
                <span class="c1"># need to really omit setting values if they are `None`</span>
                <span class="k">if</span> <span class="n">net</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Network&quot;</span><span class="p">),</span>
                                     <span class="n">native_str</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Station&quot;</span><span class="p">),</span>
                                     <span class="n">native_str</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Latitude&quot;</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Longitude&quot;</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">elevation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Elevation&quot;</span><span class="p">),</span> <span class="n">sta</span><span class="o">.</span><span class="n">elevation</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">start_date</span>
                    <span class="c1"># ESRI shapefile attributes are stored in dbf files, which</span>
                    <span class="c1"># can not store datetimes, only dates. We still need to use</span>
                    <span class="c1"># the GDAL API with precision up to seconds (aiming at</span>
                    <span class="c1"># other output drivers of GDAL; `100` stands for GMT)</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;StartDate&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                     <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                                     <span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">sta</span><span class="o">.</span><span class="n">end_date</span>
                    <span class="c1"># ESRI shapefile attributes are stored in dbf files, which</span>
                    <span class="c1"># can not store datetimes, only dates. We still need to use</span>
                    <span class="c1"># the GDAL API with precision up to seconds (aiming at</span>
                    <span class="c1"># other output drivers of GDAL; `100` stands for GMT)</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;StartDate&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                     <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                                     <span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">channel_list</span><span class="p">:</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="s2">&quot;Channels&quot;</span><span class="p">),</span>
                                     <span class="n">native_str</span><span class="p">(</span><span class="n">channel_list</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">sta</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sta</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">point</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">)</span>
                    <span class="n">point</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">sta</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
                    <span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

                <span class="n">layer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Destroy the feature to free resources</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="_get_wgs84_spatial_reference"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.shapefile.core._get_wgs84_spatial_reference.html#obspy.io.shapefile.core._get_wgs84_spatial_reference">[docs]</a><span class="k">def</span> <span class="nf">_get_wgs84_spatial_reference</span><span class="p">():</span>
    <span class="c1"># create the spatial reference</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="c1"># Simpler and feels cleaner to initialize by EPSG code but that depends on</span>
    <span class="c1"># a csv file shipping with GDAL and some GDAL environment paths being set</span>
    <span class="c1"># correctly which was not the case out of the box in anaconda, so better</span>
    <span class="c1"># hardcode this bit.</span>
    <span class="c1"># sr.ImportFromEPSG(4326)</span>
    <span class="n">wgs84_wkt</span> <span class="o">=</span> \
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        GEOGCS[&quot;WGS 84&quot;,</span>
<span class="sd">            DATUM[&quot;WGS_1984&quot;,</span>
<span class="sd">                SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,</span>
<span class="sd">                    AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],</span>
<span class="sd">                AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],</span>
<span class="sd">            PRIMEM[&quot;Greenwich&quot;,0,</span>
<span class="sd">                AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],</span>
<span class="sd">            UNIT[&quot;degree&quot;,0.0174532925199433,</span>
<span class="sd">                AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],</span>
<span class="sd">            AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">sr</span><span class="o">.</span><span class="n">ImportFromWkt</span><span class="p">(</span><span class="n">wgs84_wkt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sr</span></div>


<div class="viewcode-block" id="_create_layer"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.shapefile.core._create_layer.html#obspy.io.shapefile.core._create_layer">[docs]</a><span class="k">def</span> <span class="nf">_create_layer</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">layer_name</span><span class="p">,</span> <span class="n">field_definitions</span><span class="p">):</span>
    <span class="n">sr</span> <span class="o">=</span> <span class="n">_get_wgs84_spatial_reference</span><span class="p">()</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">data_source</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="n">layer_name</span><span class="p">),</span> <span class="n">sr</span><span class="p">,</span>
                                    <span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">)</span>
    <span class="c1"># Add the fields we&#39;re interested in</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">precision</span> <span class="ow">in</span> <span class="n">field_definitions</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="n">native_str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">type_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">field</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">field</span><span class="o">.</span><span class="n">SetPrecision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">layer</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">exclude_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a>™ &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, Ólafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Käufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhäusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaimé, Sébastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clément</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Köhler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n° 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>