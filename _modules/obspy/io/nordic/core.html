<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>obspy.io.nordic.core &#8212; ObsPy Documentation (1.0.3)</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="http://docs.obspy.org/search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="https://github.com/obspy/obspy/wiki#installation">Installation</a></li>
<li><a href="https://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li><a href="https://docs.obspy.org/">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</a></li>
<li><a href="https://docs.obspy.org/master/">API&nbsp;Documentation&nbsp;(current&nbsp;master)</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://gitter.im/obspy/obspy">Gitter</a></li>
<li><a href="https://github.com/obspy/obspy/blob/master/.github/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
<li><a href="https://ci.appveyor.com/project/obspy/obspy"><span class="icon-appveyor"></span>&nbsp;AppVeyor</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (1.0.3)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.io.nordic.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Nordic file format support for ObsPy</span>

<span class="sd">:copyright:</span>
<span class="sd">    The ObsPy Development Team (devs@obspy.org)</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License, Version 3</span>
<span class="sd">    (https://www.gnu.org/copyleft/lesser.html)</span>

<span class="sd">.. note::</span>

<span class="sd">    Currently does not read nor write moment tensors or focal mechanism</span>
<span class="sd">    solutions from/to Nordic files.</span>

<span class="sd">.. note::</span>

<span class="sd">    Pick time-residuals are handled in event.origins[0].arrivals, with</span>
<span class="sd">    the arrival.pick_id linking the arrival (which contain calculated</span>
<span class="sd">    information) with the pick.resource_id (where the pick contains only</span>
<span class="sd">    physical measured information).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1"># NOQA @UnusedWildImport</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">obspy</span> <span class="k">import</span> <span class="n">UTCDateTime</span><span class="p">,</span> <span class="n">read</span>
<span class="kn">from</span> <span class="nn">obspy.geodetics</span> <span class="k">import</span> <span class="n">kilometers2degrees</span><span class="p">,</span> <span class="n">degrees2kilometers</span>
<span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="k">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Origin</span><span class="p">,</span> <span class="n">Magnitude</span><span class="p">,</span> <span class="n">Comment</span><span class="p">,</span> <span class="n">Catalog</span>
<span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="k">import</span> <span class="n">EventDescription</span><span class="p">,</span> <span class="n">CreationInfo</span><span class="p">,</span> <span class="n">OriginQuality</span>
<span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="k">import</span> <span class="n">Pick</span><span class="p">,</span> <span class="n">WaveformStreamID</span><span class="p">,</span> <span class="n">Arrival</span><span class="p">,</span> <span class="n">Amplitude</span>


<span class="n">mag_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ML&quot;</span><span class="p">:</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;MLv&quot;</span><span class="p">:</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;mB&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;Ms&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">:</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span>
               <span class="s2">&quot;MbLg&quot;</span><span class="p">:</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;Mc&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">}</span>

<span class="n">onsets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="s1">&#39;impulsive&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s1">&#39;emergent&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="NordicParsingError"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.NordicParsingError.html#obspy.io.nordic.core.NordicParsingError">[docs]</a><span class="k">class</span> <span class="nc">NordicParsingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal general error for IO operations in obspy.core.io.nordic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="_is_sfile"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._is_sfile.html#obspy.io.nordic.core._is_sfile">[docs]</a><span class="k">def</span> <span class="nf">_is_sfile</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic test of whether the file is nordic format or not.</span>

<span class="sd">    Not exhaustive, but checks some of the basics.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: Path to sfile</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s2">&quot;readline&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">head_line</span> <span class="o">=</span> <span class="n">_get_headline</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">head_line</span> <span class="o">=</span> <span class="n">_get_headline</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">head_line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sfile_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">sfile_seconds</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">sfile_seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">]),</span> <span class="n">sfile_seconds</span><span class="p">,</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">head_line</span><span class="p">[</span><span class="mi">19</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="_get_headline"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._get_headline.html#obspy.io.nordic.core._get_headline">[docs]</a><span class="k">def</span> <span class="nf">_get_headline</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">line</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="_int_conv"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._int_conv.html#obspy.io.nordic.core._int_conv">[docs]</a><span class="k">def</span> <span class="nf">_int_conv</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience tool to convert from string to integer.</span>

<span class="sd">    If empty string return None rather than an error.</span>

<span class="sd">    &gt;&gt;&gt; _int_conv(&#39;12&#39;)</span>
<span class="sd">    12</span>
<span class="sd">    &gt;&gt;&gt; _int_conv(&#39;&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">intstring</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">intstring</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">intstring</span></div>


<div class="viewcode-block" id="_float_conv"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._float_conv.html#obspy.io.nordic.core._float_conv">[docs]</a><span class="k">def</span> <span class="nf">_float_conv</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience tool to convert from string to float.</span>

<span class="sd">    If empty string return None rather than an error.</span>

<span class="sd">    &gt;&gt;&gt; _float_conv(&#39;12&#39;)</span>
<span class="sd">    12.0</span>
<span class="sd">    &gt;&gt;&gt; _float_conv(&#39;&#39;)</span>
<span class="sd">    &gt;&gt;&gt; _float_conv(&#39;12.324&#39;)</span>
<span class="sd">    12.324</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">floatstring</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">floatstring</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">floatstring</span></div>


<div class="viewcode-block" id="_str_conv"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._str_conv.html#obspy.io.nordic.core._str_conv">[docs]</a><span class="k">def</span> <span class="nf">_str_conv</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience tool to convert a number, either float or int into a string.</span>

<span class="sd">    If the int or float is None, returns empty string.</span>

<span class="sd">    &gt;&gt;&gt; print(_str_conv(12.3))</span>
<span class="sd">    12.3</span>
<span class="sd">    &gt;&gt;&gt; print(_str_conv(12.34546, rounded=1))</span>
<span class="sd">    12.3</span>
<span class="sd">    &gt;&gt;&gt; print(_str_conv(None))</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; print(_str_conv(1123040))</span>
<span class="sd">    11.2e5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">number</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rounded</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exponant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;E+&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponant</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exponant</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rounded</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exponant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;E+&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponant</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exponant</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rounded</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exponant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;E+&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">exponant</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exponant</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span></div>


<div class="viewcode-block" id="_evmagtonor"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._evmagtonor.html#obspy.io.nordic.core._evmagtonor">[docs]</a><span class="k">def</span> <span class="nf">_evmagtonor</span><span class="p">(</span><span class="n">mag_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Switch from obspy event magnitude types to seisan syntax.</span>

<span class="sd">    &gt;&gt;&gt; print(_evmagtonor(&#39;mB&#39;))  # doctest: +SKIP</span>
<span class="sd">    B</span>
<span class="sd">    &gt;&gt;&gt; print(_evmagtonor(&#39;M&#39;))  # doctest: +SKIP</span>
<span class="sd">    W</span>
<span class="sd">    &gt;&gt;&gt; print(_evmagtonor(&#39;bob&#39;))  # doctest: +SKIP</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mag_type</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Converting generic magnitude to moment magnitude&#39;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;W&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">mag_mapping</span><span class="p">[</span><span class="n">mag_type</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mag_type</span> <span class="o">+</span> <span class="s1">&#39; is not convertible&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mag</span></div>


<div class="viewcode-block" id="_nortoevmag"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._nortoevmag.html#obspy.io.nordic.core._nortoevmag">[docs]</a><span class="k">def</span> <span class="nf">_nortoevmag</span><span class="p">(</span><span class="n">mag_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Switch from nordic type magnitude notation to obspy event magnitudes.</span>

<span class="sd">    &gt;&gt;&gt; print(_nortoevmag(&#39;b&#39;))  # doctest: +SKIP</span>
<span class="sd">    mB</span>
<span class="sd">    &gt;&gt;&gt; print(_nortoevmag(&#39;bob&#39;))  # doctest: +SKIP</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mag_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ML&quot;</span>
    <span class="n">inv_mag_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mag_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">inv_mag_mapping</span><span class="p">[</span><span class="n">mag_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mag_type</span> <span class="o">+</span> <span class="s1">&#39; is not convertible&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">mag</span></div>


<div class="viewcode-block" id="readheader"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.readheader.html#obspy.io.nordic.core.readheader">[docs]</a><span class="k">def</span> <span class="nf">readheader</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read header information from a seisan nordic format S-file.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: Path to the s-file</span>

<span class="sd">    :returns: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">_readheader</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">header</span></div>


<div class="viewcode-block" id="_readheader"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._readheader.html#obspy.io.nordic.core._readheader">[docs]</a><span class="k">def</span> <span class="nf">_readheader</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal header reader.</span>
<span class="sd">    :type f: file</span>
<span class="sd">    :param f: File open in read-mode.</span>

<span class="sd">    :returns: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Base populate to allow for empty parts of file</span>
    <span class="n">new_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
    <span class="n">topline</span> <span class="o">=</span> <span class="n">_get_headline</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">topline</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;No header found, or incorrect &#39;</span>
                                 <span class="s1">&#39;formatting: corrupt s-file&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sfile_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sfile_seconds</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">sfile_seconds</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">add_seconds</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_seconds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Origin</span><span class="p">())</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]),</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]),</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]),</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">]),</span>
                                                <span class="n">sfile_seconds</span><span class="p">,</span>
                                                <span class="nb">int</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">19</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span> <span class="o">*</span>
                                                <span class="mi">100000</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">add_seconds</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">NordicParsingError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t read a date from sfile&quot;</span><span class="p">)</span>
    <span class="c1"># new_event.loc_mod_ind=topline[20]</span>
    <span class="n">new_event</span><span class="o">.</span><span class="n">event_descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EventDescription</span><span class="p">())</span>
    <span class="n">new_event</span><span class="o">.</span><span class="n">event_descriptions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">topline</span><span class="p">[</span><span class="mi">21</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span>
    <span class="c1"># new_event.ev_id=topline[22]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">38</span><span class="p">])</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">39</span><span class="p">:</span><span class="mi">43</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># The origin &#39;requires&#39; a lat &amp; long</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># new_event.depth_ind = topline[44]</span>
    <span class="c1"># new_event.loc_ind = topline[45]</span>
    <span class="n">new_event</span><span class="o">.</span><span class="n">creation_info</span> <span class="o">=</span> <span class="n">CreationInfo</span><span class="p">(</span><span class="n">agency_id</span><span class="o">=</span><span class="n">topline</span><span class="p">[</span><span class="mi">45</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">ksta</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Number of stations=&#39;</span> <span class="o">+</span> <span class="n">topline</span><span class="p">[</span><span class="mi">49</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ksta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">51</span><span class="p">:</span><span class="mi">55</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quality</span> <span class="o">=</span> <span class="n">OriginQuality</span><span class="p">(</span>
            <span class="n">standard_error</span><span class="o">=</span><span class="n">_float_conv</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="mi">51</span><span class="p">:</span><span class="mi">55</span><span class="p">]))</span>
    <span class="c1"># Read in magnitudes if they are there.</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">59</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">75</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">topline</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Magnitude</span><span class="p">())</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mag</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span>
                <span class="n">topline</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span><span class="n">index</span><span class="p">])</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude_type</span> <span class="o">=</span> \
                <span class="n">_nortoevmag</span><span class="p">(</span><span class="n">topline</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">creation_info</span> <span class="o">=</span> \
                <span class="n">CreationInfo</span><span class="p">(</span><span class="n">agency_id</span><span class="o">=</span><span class="n">topline</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">origin_id</span> <span class="o">=</span> <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span>\
                <span class="n">resource_id</span>
    <span class="c1"># Set the useful things like preferred magnitude and preferred origin</span>
    <span class="n">new_event</span><span class="o">.</span><span class="n">preferred_origin_id</span> <span class="o">=</span> <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resource_id</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Select moment first, then local, then</span>
        <span class="n">mag_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span> <span class="s1">&#39;Mw&#39;</span><span class="p">,</span> <span class="s1">&#39;ML&#39;</span><span class="p">,</span> <span class="s1">&#39;Ml&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;Mb&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="s1">&#39;Ms&#39;</span><span class="p">,</span> <span class="s1">&#39;MC&#39;</span><span class="p">,</span> <span class="s1">&#39;Mc&#39;</span><span class="p">]</span>
        <span class="n">_magnitudes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">magnitude_type</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">resource_id</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">]</span>
        <span class="n">preferred_magnitude</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_magnitudes</span><span class="p">,</span>
                                     <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mag_filter</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">preferred_magnitude_id</span> <span class="o">=</span> <span class="n">preferred_magnitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="c1"># If there is a magnitude not specified in filter</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">preferred_magnitude_id</span> <span class="o">=</span> <span class="n">new_event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span>\
                <span class="n">resource_id</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">new_event</span></div>


<div class="viewcode-block" id="read_spectral_info"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.read_spectral_info.html#obspy.io.nordic.core.read_spectral_info">[docs]</a><span class="k">def</span> <span class="nf">read_spectral_info</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read spectral info from an sfile.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: Sfile to read from.</span>

<span class="sd">    :returns:</span>
<span class="sd">        list of dictionaries of spectral information, units as in seisan</span>
<span class="sd">        manual, expect for logs which have been converted to floats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">spec_inf</span> <span class="o">=</span> <span class="n">_read_spectral_info</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spec_inf</span></div>


<div class="viewcode-block" id="_read_spectral_info"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._read_spectral_info.html#obspy.io.nordic.core._read_spectral_info">[docs]</a><span class="k">def</span> <span class="nf">_read_spectral_info</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal spectral reader.</span>

<span class="sd">    :type f: file</span>
<span class="sd">    :param f: File open in read mode.</span>

<span class="sd">    :returns:</span>
<span class="sd">        list of dictionaries of spectral information, units as in</span>
<span class="sd">        seisan manual, expect for logs which have been converted to floats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">_readheader</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">origin_date</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="n">relevant_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SPEC&#39;</span><span class="p">:</span>
            <span class="n">relevant_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">spec_inf</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relevant_lines</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">spec_inf</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">relevant_lines</span><span class="p">:</span>
        <span class="n">spec_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AVERAGE&#39;</span><span class="p">,</span> <span class="s1">&#39;STANDARD_DEVIATION&#39;</span><span class="p">]:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">station</span> <span class="o">=</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;stress_drop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">38</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;corner_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">46</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;decay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">56</span><span class="p">:</span><span class="mi">62</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">64</span><span class="p">:</span><span class="mi">70</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment_mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">78</span><span class="p">])</span>
            <span class="n">spec_inf</span><span class="p">[(</span><span class="n">station</span><span class="p">,</span> <span class="n">channel</span><span class="p">)]</span> <span class="o">=</span> <span class="n">info</span>
            <span class="k">continue</span>
        <span class="n">station</span> <span class="o">=</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">spec_inf</span><span class="p">[(</span><span class="n">station</span><span class="p">,</span> <span class="n">channel</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin_date</span> <span class="o">+</span> \
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">17</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">+</span>\
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">19</span><span class="p">])</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">19</span><span class="p">:</span><span class="mi">21</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
                <span class="c1"># Wrong day, case of origin at end of day</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">86400</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;kappa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">38</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VS&#39;</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">46</span><span class="p">])</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;velocity_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
            <span class="k">elif</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;VP&#39;</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">46</span><span class="p">])</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;velocity_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Only VP and VS spectral information&#39;</span>
                              <span class="s1">&#39; implemented&#39;</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">48</span><span class="p">:</span><span class="mi">54</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;Q0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">56</span><span class="p">:</span><span class="mi">62</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;QA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">64</span><span class="p">:</span><span class="mi">70</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">spec_str</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">22</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;stress_drop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">38</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spectral_level&#39;</span><span class="p">]</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;corner_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">46</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;decay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">56</span><span class="p">:</span><span class="mi">62</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">64</span><span class="p">:</span><span class="mi">70</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;moment_mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">spec_str</span><span class="p">[</span><span class="mi">72</span><span class="p">:</span><span class="mi">78</span><span class="p">])</span>
        <span class="n">spec_inf</span><span class="p">[(</span><span class="n">station</span><span class="p">,</span> <span class="n">channel</span><span class="p">)]</span> <span class="o">=</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">spec_inf</span></div>


<div class="viewcode-block" id="read_nordic"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.read_nordic.html#obspy.io.nordic.core.read_nordic">[docs]</a><span class="k">def</span> <span class="nf">read_nordic</span><span class="p">(</span><span class="n">select_file</span><span class="p">,</span> <span class="n">return_wavnames</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a catalog of events from a Nordic formatted select file.</span>

<span class="sd">    Generates a series of temporary files for each event in the select file.</span>

<span class="sd">    :type select_file: str</span>
<span class="sd">    :param select_file: Nordic formatted select.out file to open</span>
<span class="sd">    :type return_wavnames: bool</span>
<span class="sd">    :param return_wavnames:</span>
<span class="sd">        If True, will return the names of the waveforms that the events</span>
<span class="sd">        are associated with.</span>

<span class="sd">    :return: catalog of events</span>
<span class="sd">    :rtype: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">Catalog</span><span class="p">()</span>
    <span class="n">event_str</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">select_file</span><span class="p">,</span> <span class="s2">&quot;readline&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">select_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">select_file</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">select_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">select_file</span>
    <span class="n">wav_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">event_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp_sfile</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">event_line</span> <span class="ow">in</span> <span class="n">event_str</span><span class="p">:</span>
                <span class="n">tmp_sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">event_line</span><span class="p">)</span>
            <span class="n">new_event</span> <span class="o">=</span> <span class="n">_readheader</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">tmp_sfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_wavnames</span><span class="p">:</span>
                <span class="n">wav_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_readwavename</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">tmp_sfile</span><span class="p">))</span>
            <span class="n">catalog</span> <span class="o">+=</span> <span class="n">_read_picks</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">tmp_sfile</span><span class="p">,</span> <span class="n">new_event</span><span class="o">=</span><span class="n">new_event</span><span class="p">)</span>
            <span class="n">event_str</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">return_wavnames</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">wav_names</span>
    <span class="k">return</span> <span class="n">catalog</span></div>


<div class="viewcode-block" id="_read_picks"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._read_picks.html#obspy.io.nordic.core._read_picks">[docs]</a><span class="k">def</span> <span class="nf">_read_picks</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">new_event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal pick reader. Use read_nordic instead.</span>

<span class="sd">    :type f: file</span>
<span class="sd">    :param f: File open in read mode</span>
<span class="sd">    :type wav_names: list</span>
<span class="sd">    :param wav_names: List of waveform files in the sfile</span>
<span class="sd">    :type new_event: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    :param new_event: event to associate picks with.</span>

<span class="sd">    :returns: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">evtime</span> <span class="o">=</span> <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
    <span class="n">pickline</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Set a default, ignored later unless overwritten</span>
    <span class="n">snr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">break</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">79</span><span class="p">]</span> <span class="ow">and</span> \
           <span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39; 4</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="n">pickline</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pickline</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># If line is empty miss it</span>
            <span class="k">continue</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">17</span><span class="p">]</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">polarity_maps</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="s2">&quot;undecidable&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;positive&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="s2">&quot;negative&quot;</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="n">polarity_maps</span><span class="p">[</span><span class="n">polarity</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;undecidable&quot;</span>
        <span class="c1"># It is valid nordic for the origin to be hour 23 and picks to be hour</span>
        <span class="c1"># 00 or 24: this signifies a pick over a day boundary.</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">evtime</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>
            <span class="n">day_add</span> <span class="o">=</span> <span class="mi">86400</span>
            <span class="n">pick_hour</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">day_add</span> <span class="o">=</span> <span class="mi">86400</span>
            <span class="n">pick_hour</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">day_add</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pick_hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                               <span class="n">pick_hour</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">22</span><span class="p">]),</span>
                               <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">28</span><span class="p">]))</span> <span class="o">+</span> <span class="n">day_add</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                               <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span> <span class="n">pick_hour</span><span class="p">,</span>
                               <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;0.&quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span>\
                <span class="mi">60</span> <span class="o">+</span> <span class="n">day_add</span>
            <span class="c1"># Add 60 seconds on to the time, this copes with s-file</span>
            <span class="c1"># preference to write seconds in 1-60 rather than 0-59 which</span>
            <span class="c1"># datetime objects accept</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="mi">57</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AIN&#39;</span><span class="p">:</span>
            <span class="n">ain</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">57</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;AIN: </span><span class="si">%s</span><span class="s1"> in header, currently unsupported&#39;</span> <span class="o">%</span> <span class="n">ain</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="mi">57</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SNR&#39;</span><span class="p">:</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">57</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not currently supported&#39;</span> <span class="o">%</span> <span class="n">header</span><span class="p">[</span><span class="mi">57</span><span class="p">:</span><span class="mi">60</span><span class="p">])</span>
        <span class="c1"># finalweight = _int_conv(line[68:70])</span>
        <span class="c1"># Create a new obspy.event.Pick class for this pick</span>
        <span class="n">_waveform_id</span> <span class="o">=</span> <span class="n">WaveformStreamID</span><span class="p">(</span><span class="n">station_code</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                        <span class="n">channel_code</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                        <span class="n">network_code</span><span class="o">=</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
        <span class="n">pick</span> <span class="o">=</span> <span class="n">Pick</span><span class="p">(</span><span class="n">waveform_id</span><span class="o">=</span><span class="n">_waveform_id</span><span class="p">,</span> <span class="n">phase_hint</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
                    <span class="n">polarity</span><span class="o">=</span><span class="n">polarity</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pick</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onsets</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">pick</span><span class="o">.</span><span class="n">evaluation_mode</span> <span class="o">=</span> <span class="s1">&#39;automatic&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pick</span><span class="o">.</span><span class="n">evaluation_mode</span> <span class="o">=</span> <span class="s1">&#39;manual&#39;</span>
        <span class="c1"># Note these two are not always filled - velocity conversion not yet</span>
        <span class="c1"># implemented, needs to be converted from km/s to s/deg</span>
        <span class="c1"># if not velocity == 999.0:</span>
            <span class="c1"># new_event.picks[pick_index].horizontal_slowness = 1.0 / velocity</span>
        <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">51</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pick</span><span class="o">.</span><span class="n">backazimuth</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">51</span><span class="p">])</span>
        <span class="c1"># Create new obspy.event.Amplitude class which references above Pick</span>
        <span class="c1"># only if there is an amplitude picked.</span>
        <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_amplitude</span> <span class="o">=</span> <span class="n">Amplitude</span><span class="p">(</span><span class="n">generic_amplitude</span><span class="o">=</span><span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">]),</span>
                                   <span class="n">period</span><span class="o">=</span><span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">41</span><span class="p">:</span><span class="mi">45</span><span class="p">]),</span>
                                   <span class="n">pick_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">,</span>
                                   <span class="n">waveform_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">phase_hint</span> <span class="o">==</span> <span class="s1">&#39;IAML&#39;</span><span class="p">:</span>
                <span class="c1"># Amplitude for local magnitude</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;AML&#39;</span>
                <span class="c1"># Set to be evaluating a point in the trace</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
                <span class="c1"># Default AML unit in seisan is nm (Page 139 of seisan</span>
                <span class="c1"># documentation, version 10.0)</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">generic_amplitude</span> <span class="o">/=</span> <span class="mf">1e9</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">magnitude_hint</span> <span class="o">=</span> <span class="s1">&#39;ML&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Generic amplitude type</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
            <span class="k">if</span> <span class="n">snr</span><span class="p">:</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">snr</span> <span class="o">=</span> <span class="n">snr</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_amplitude</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">28</span><span class="p">:</span><span class="mi">33</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Create an amplitude instance for code duration also</span>
            <span class="n">_amplitude</span> <span class="o">=</span> <span class="n">Amplitude</span><span class="p">(</span><span class="n">generic_amplitude</span><span class="o">=</span><span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">28</span><span class="p">:</span><span class="mi">33</span><span class="p">]),</span>
                                   <span class="n">pick_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">,</span>
                                   <span class="n">waveform_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="p">)</span>
            <span class="c1"># Amplitude for coda magnitude</span>
            <span class="n">_amplitude</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;END&#39;</span>
            <span class="c1"># Set to be evaluating a point in the trace</span>
            <span class="n">_amplitude</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;duration&#39;</span>
            <span class="n">_amplitude</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
            <span class="n">_amplitude</span><span class="o">.</span><span class="n">magnitude_hint</span> <span class="o">=</span> <span class="s1">&#39;Mc&#39;</span>
            <span class="k">if</span> <span class="n">snr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_amplitude</span><span class="o">.</span><span class="n">snr</span> <span class="o">=</span> <span class="n">snr</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_amplitude</span><span class="p">)</span>
        <span class="c1"># Create new obspy.event.Arrival class referencing above Pick</span>
        <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">40</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arrival</span> <span class="o">=</span> <span class="n">Arrival</span><span class="p">(</span><span class="n">phase</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">phase_hint</span><span class="p">,</span> <span class="n">pick_id</span><span class="o">=</span><span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arrival</span><span class="o">.</span><span class="n">time_weight</span> <span class="o">=</span> <span class="n">weight</span>
            <span class="k">if</span> <span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">63</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arrival</span><span class="o">.</span><span class="n">backazimuth_residual</span> <span class="o">=</span> <span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">60</span><span class="p">:</span><span class="mi">63</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">63</span><span class="p">:</span><span class="mi">68</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arrival</span><span class="o">.</span><span class="n">time_residual</span> <span class="o">=</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">63</span><span class="p">:</span><span class="mi">68</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">70</span><span class="p">:</span><span class="mi">75</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arrival</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">kilometers2degrees</span><span class="p">(</span><span class="n">_float_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">70</span><span class="p">:</span><span class="mi">75</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">76</span><span class="p">:</span><span class="mi">79</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arrival</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">_int_conv</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">76</span><span class="p">:</span><span class="mi">79</span><span class="p">])</span>
            <span class="n">new_event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arrival</span><span class="p">)</span>
        <span class="n">new_event</span><span class="o">.</span><span class="n">picks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pick</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_event</span></div>


<div class="viewcode-block" id="readwavename"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.readwavename.html#obspy.io.nordic.core.readwavename">[docs]</a><span class="k">def</span> <span class="nf">readwavename</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the waveform filename from the s-file.</span>

<span class="sd">    Returns a list of waveform names found in the s-file as multiples can</span>
<span class="sd">    be present.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: Path to the sfile</span>

<span class="sd">    :returns: List of strings of wave paths</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">wavenames</span> <span class="o">=</span> <span class="n">_readwavename</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wavenames</span></div>


<div class="viewcode-block" id="_readwavename"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._readwavename.html#obspy.io.nordic.core._readwavename">[docs]</a><span class="k">def</span> <span class="nf">_readwavename</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal wave-name reader.</span>

<span class="sd">    :type f: file</span>
<span class="sd">    :param f: File open in read-mode</span>

<span class="sd">    :return: list of wave-file names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wavename</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">81</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
            <span class="n">wavename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">79</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">wavename</span></div>


<div class="viewcode-block" id="blanksfile"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.blanksfile.html#obspy.io.nordic.core.blanksfile">[docs]</a><span class="k">def</span> <span class="nf">blanksfile</span><span class="p">(</span><span class="n">wavefile</span><span class="p">,</span> <span class="n">evtype</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">evtime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an empty s-file with a populated header for a given waveform.</span>

<span class="sd">    :type wavefile: str</span>
<span class="sd">    :param wavefile: Wave-file to associate with this S-file, the timing of \</span>
<span class="sd">        the S-file will be taken from this file if evtime is not set.</span>
<span class="sd">    :type evtype: str</span>
<span class="sd">    :param evtype: Event type letter code, e.g. L, R, D</span>
<span class="sd">    :type userid: str</span>
<span class="sd">    :param userid: 4-character SEISAN USER ID</span>
<span class="sd">    :type overwrite: bool</span>
<span class="sd">    :param overwrite: Overwrite an existing S-file, default=False</span>
<span class="sd">    :type evtime: :class:`~obspy.core.utcdatetime.UTCDateTime`</span>
<span class="sd">    :param evtime: If given this will set the timing of the S-file</span>

<span class="sd">    :returns: str, S-file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">evtime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">wavefile</span><span class="p">)</span>
            <span class="n">evtime</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;Wavefile: &#39;</span> <span class="o">+</span> <span class="n">wavefile</span> <span class="o">+</span>
                                     <span class="s1">&#39; is invalid, try again with real data.&#39;</span><span class="p">)</span>
    <span class="c1"># Check that user ID is the correct length</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;User ID must be 4 characters long&#39;</span><span class="p">)</span>
    <span class="c1"># Check that evtype is one of L,R,D</span>
    <span class="k">if</span> <span class="n">evtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;Event type must be either L, R or D&#39;</span><span class="p">)</span>

    <span class="c1"># Generate s-file name in the format dd-hhmm-ss[L,R,D].Syyyymm</span>
    <span class="n">sfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>\
        <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>\
        <span class="n">evtype</span> <span class="o">+</span> <span class="s1">&#39;.S&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Check is sfile exists</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Desired sfile: &#39;</span> <span class="o">+</span> <span class="n">sfile</span> <span class="o">+</span> <span class="s1">&#39; exists, will not &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;overwrite&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">sfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">evtype</span> <span class="o">+</span> <span class="s1">&#39;.S&#39;</span> <span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Tried generated files up to 20s in advance and found &#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;all exist.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Write line 1 of s-file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="n">evtype</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">58</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Write line 2 of s-file</span>
        <span class="n">output_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; ACTION:ARG &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_time</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span>
                <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_time</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">output_time</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">output_time</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">output_time</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; OP:&#39;</span> <span class="o">+</span>
                <span class="n">userid</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; STATUS:&#39;</span> <span class="o">+</span> <span class="s1">&#39;ID:&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="s1">&#39;I&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Write line 3 of s-file</span>
        <span class="n">write_wavfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wavefile</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">write_wavfile</span> <span class="o">+</span> <span class="s1">&#39;6&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">79</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">write_wavfile</span><span class="p">))</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Write final line of s-file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; STAT SP IPHASW D HRMM SECON CODA AMPLIT PERI AZIMU&quot;</span> <span class="o">+</span>
                <span class="s2">&quot; VELO AIN AR TRES W  DIS CAZ7</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sfile</span></div>


<div class="viewcode-block" id="write_select"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.write_select.html#obspy.io.nordic.core.write_select">[docs]</a><span class="k">def</span> <span class="nf">write_select</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="s1">&#39;OBSP&#39;</span><span class="p">,</span> <span class="n">evtype</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span>
                 <span class="n">wavefiles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to write a catalog to a select file in nordic format.</span>

<span class="sd">    :type catalog: :class:`~obspy.core.event.event.Catalog`</span>
<span class="sd">    :param catalog: A catalog of obspy events</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename: Path to write to</span>
<span class="sd">    :type userid: str</span>
<span class="sd">    :param userid: Up to 4 character user ID</span>
<span class="sd">    :type evtype: str</span>
<span class="sd">    :param evtype:</span>
<span class="sd">        Single character string to describe the event, either L, R or D.</span>
<span class="sd">    :type wavefiles: list</span>
<span class="sd">    :param wavefiles:</span>
<span class="sd">        Waveforms to associate the events with, must be ordered in the same</span>
<span class="sd">         way as the events in the catalog.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">wavefiles</span><span class="p">:</span>
        <span class="n">wavefiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DUMMY&#39;</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">))]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">wavfile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">wavefiles</span><span class="p">):</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
            <span class="n">_write_nordic</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="n">userid</span><span class="p">,</span>
                          <span class="n">evtype</span><span class="o">=</span><span class="n">evtype</span><span class="p">,</span> <span class="n">wavefiles</span><span class="o">=</span><span class="n">wavfile</span><span class="p">,</span>
                          <span class="n">string_io</span><span class="o">=</span><span class="n">select</span><span class="p">)</span>
            <span class="n">select</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="_write_nordic"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core._write_nordic.html#obspy.io.nordic.core._write_nordic">[docs]</a><span class="k">def</span> <span class="nf">_write_nordic</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="s1">&#39;OBSP&#39;</span><span class="p">,</span> <span class="n">evtype</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                  <span class="n">wavefiles</span><span class="o">=</span><span class="s1">&#39;DUMMY&#39;</span><span class="p">,</span> <span class="n">explosion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">string_io</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write an :class:`~obspy.core.event.Event` to a nordic formatted s-file.</span>

<span class="sd">    :type event: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    :param event: A single obspy event</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param filename:</span>
<span class="sd">        Filename to write to, can be None, and filename will be generated from</span>
<span class="sd">        the origin time in nordic format.</span>
<span class="sd">    :type userid: str</span>
<span class="sd">    :param userid: Up to 4 character user ID</span>
<span class="sd">    :type evtype: str</span>
<span class="sd">    :param evtype:</span>
<span class="sd">        Single character string to describe the event, either L, R or D.</span>
<span class="sd">    :type outdir: str</span>
<span class="sd">    :param outdir: Path to directory to write to</span>
<span class="sd">    :type wavefiles: list</span>
<span class="sd">    :param wavefiles: Waveforms to associate the nordic file with</span>
<span class="sd">    :type explosion: bool</span>
<span class="sd">    :param explosion:</span>
<span class="sd">        Note if the event is an explosion, will be marked by an E.</span>
<span class="sd">    :type overwrite: bool</span>
<span class="sd">    :param overwrite: force to overwrite old files, defaults to False</span>
<span class="sd">    :type string_io: io.StringIO</span>
<span class="sd">    :param string_io:</span>
<span class="sd">        If given, will write to the StringIO object in memory rather than to</span>
<span class="sd">        the filename.</span>

<span class="sd">    :returns: str: name of nordic file written</span>

<span class="sd">    .. note::</span>

<span class="sd">        Seisan can find waveforms either by their relative or absolute path, or</span>
<span class="sd">        by looking for the file recursively in directories within the WAV</span>
<span class="sd">        directory in your seisan install.  Because all lines need to be less</span>
<span class="sd">        than 79 characters long (fortran hangover) in the s-files, you will</span>
<span class="sd">        need to determine whether the full-path is okay or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First we need to work out what to call the s-file and open it</span>
    <span class="c1"># Check that user ID is the correct length</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> User ID must be 4 characters long&#39;</span>
                                 <span class="o">%</span> <span class="n">userid</span><span class="p">)</span>
    <span class="c1"># Check that outdir exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;Out path does not exist, I will not &#39;</span>
                                 <span class="s1">&#39;create this: &#39;</span> <span class="o">+</span> <span class="n">outdir</span><span class="p">)</span>
    <span class="c1"># Check that evtype is one of L,R,D</span>
    <span class="k">if</span> <span class="n">evtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;Event type must be either L, R or D&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">explosion</span><span class="p">:</span>
        <span class="n">evtype</span> <span class="o">+=</span> <span class="s1">&#39;E&#39;</span>
    <span class="c1"># Check that there is one event</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Catalog</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">event</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="s1">&#39;Needs a single event&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavefiles</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">wavefiles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">wavefiles</span><span class="p">)]</span>
    <span class="c1"># Determine name from origin time</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">evtime</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Need at least one origin with at least an origin time&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">evtime</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;event has an origin, but time is not populated.  &#39;</span> <span class="o">+</span>
               <span class="s1">&#39;This is required!&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="c1"># Attempt to cope with possible pre-existing files</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">range_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>  <span class="c1"># Look +/- 30 seconds around origin time</span>
            <span class="n">range_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">range_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">range_list</span> <span class="o">=</span> <span class="n">range_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">add_secs</span> <span class="ow">in</span> <span class="n">range_list</span><span class="p">:</span>
            <span class="n">sfilename</span> <span class="o">=</span> <span class="p">(</span><span class="n">evtime</span> <span class="o">+</span> <span class="n">add_secs</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%H%M-%S&#39;</span><span class="p">)</span> <span class="o">+</span>\
                <span class="n">evtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.S&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">evtime</span> <span class="o">+</span> <span class="n">add_secs</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">sfilename</span><span class="p">)):</span>
                <span class="n">sfile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">sfilename</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">sfile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">sfilename</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NordicParsingError</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">sfilename</span><span class="p">)</span> <span class="o">+</span>
                                     <span class="s1">&#39; already exists, will not overwrite&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">sfilename</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="c1"># Write the header info.</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">creation_info</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">agency</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">creation_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agency_id&#39;</span><span class="p">)</span>
            <span class="c1"># If there is creation_info this may not raise an error annoyingly</span>
            <span class="k">if</span> <span class="n">agency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">agency</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">agency</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">agency</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agency</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">agency</span> <span class="o">=</span> <span class="n">agency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1"># Cope with differences in event uncertainty naming</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quality</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;standard_error&#39;</span><span class="p">]:</span>
        <span class="n">timerms</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quality</span><span class="p">[</span><span class="s1">&#39;standard_error&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">timerms</span> <span class="o">=</span> <span class="s1">&#39;0.0&#39;</span>
    <span class="n">conv_mags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mag_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">mag_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="n">mag_ind</span><span class="p">]</span><span class="o">.</span><span class="n">mag</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_evmagtonor</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="n">mag_ind</span><span class="p">]</span><span class="o">.</span>
                                           <span class="n">magnitude_type</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">creation_info</span><span class="p">:</span>
                <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;agency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="n">mag_ind</span><span class="p">]</span><span class="o">.</span>\
                    <span class="n">creation_info</span><span class="o">.</span><span class="n">agency_id</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;agency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">mag_info</span><span class="p">[</span><span class="s1">&#39;agency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">conv_mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mag_info</span><span class="p">)</span>
    <span class="c1"># Work out how many stations were used</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="o">.</span><span class="n">station_code</span> <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">picks</span><span class="p">]</span>
        <span class="n">ksta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stations</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ksta</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">string_io</span><span class="p">:</span>
        <span class="n">sfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfile</span> <span class="o">=</span> <span class="n">string_io</span>
    <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="n">evtype</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">lat</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">lon</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">depth</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">agency</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">ksta</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">timerms</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">conv_mags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;agency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">conv_mags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;agency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">conv_mags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">conv_mags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;agency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Write line 2 of s-file</span>
    <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; ACTION:ARG &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; OP:&#39;</span> <span class="o">+</span>
                <span class="n">userid</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; STATUS:&#39;</span> <span class="o">+</span> <span class="s1">&#39;ID:&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">evtime</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                <span class="s1">&#39;I&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Write line 3 of s-file</span>
    <span class="k">for</span> <span class="n">wavefile</span> <span class="ow">in</span> <span class="n">wavefiles</span><span class="p">:</span>
        <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">wavefile</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39;6&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">79</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavefile</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Write final line of s-file</span>
    <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; STAT SP IPHASW D HRMM SECON CODA AMPLIT PERI AZIMU&#39;</span> <span class="o">+</span>
                <span class="s1">&#39; VELO AIN AR TRES W  DIS CAZ7</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># Now call the populate sfile function</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">picks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newpicks</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nordpick</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newpicks</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">81</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">string_io</span><span class="p">:</span>
        <span class="n">sfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">sfilename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="nordpick"><a class="viewcode-back" href="../../../../packages/autogen/obspy.io.nordic.core.nordpick.html#obspy.io.nordic.core.nordpick">[docs]</a><span class="k">def</span> <span class="nf">nordpick</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format picks in an :class:`~obspy.core.event.event.Event` to nordic.</span>

<span class="sd">    :type event: :class:`~obspy.core.event.event.Event`</span>
<span class="sd">    :param event: A single obspy event.</span>

<span class="sd">    :returns: List of String</span>

<span class="sd">    .. note::</span>

<span class="sd">        Currently finalweight is unsupported, nor is velocity, or</span>
<span class="sd">        angle of incidence.  This is because</span>
<span class="sd">        :class:`~obspy.core.event.event.Event` stores slowness</span>
<span class="sd">        in s/deg and takeoff angle, which would require computation</span>
<span class="sd">        from the values stored in seisan.  Multiple weights are also</span>
<span class="sd">        not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pick_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pick</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">picks</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;No waveform id for pick at time </span><span class="si">%s</span><span class="s1">, skipping&#39;</span> <span class="o">%</span> <span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="c1"># Convert string to short sting</span>
        <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">onset</span> <span class="o">==</span> <span class="s1">&#39;impulsive&#39;</span><span class="p">:</span>
            <span class="n">impulsivity</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span>
        <span class="k">elif</span> <span class="n">pick</span><span class="o">.</span><span class="n">onset</span> <span class="o">==</span> <span class="s1">&#39;emergent&#39;</span><span class="p">:</span>
            <span class="n">impulsivity</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">impulsivity</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

        <span class="c1"># Convert string to short string</span>
        <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s1">&#39;positive&#39;</span><span class="p">:</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">elif</span> <span class="n">pick</span><span class="o">.</span><span class="n">polarity</span> <span class="o">==</span> <span class="s1">&#39;negative&#39;</span><span class="p">:</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># Extract velocity: Note that horizontal slowness in quakeML is stored</span>
        <span class="c1"># as s/deg</span>
        <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">horizontal_slowness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># velocity = 1.0 / pick.horizontal_slowness</span>
            <span class="n">velocity</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>  <span class="c1"># Currently this conversion is unsupported.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">velocity</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># Extract azimuth</span>
        <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">backazimuth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="n">pick</span><span class="o">.</span><span class="n">backazimuth</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># Extract the correct arrival info for this pick - assuming only one</span>
        <span class="c1"># arrival per pick...</span>
        <span class="n">arrival</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrival</span> <span class="k">for</span> <span class="n">arrival</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrivals</span>
                   <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">pick_id</span> <span class="o">==</span> <span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrival</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arrival</span> <span class="o">=</span> <span class="n">arrival</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Extract weight - should be stored as 0-4, or 9 for seisan.</span>
            <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">time_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrival</span><span class="o">.</span><span class="n">time_weight</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
            <span class="c1"># Extract azimuth residual</span>
            <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">backazimuth_residual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">azimuthres</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrival</span><span class="o">.</span><span class="n">backazimuth_residual</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">azimuthres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="c1"># Extract time residual</span>
            <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">time_residual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">timeres</span> <span class="o">=</span> <span class="n">arrival</span><span class="o">.</span><span class="n">time_residual</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="c1"># Extract distance</span>
            <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">degrees2kilometers</span><span class="p">(</span><span class="n">arrival</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mf">100.0</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_int_conv</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
                <span class="k">elif</span> <span class="mf">10.0</span> <span class="o">&lt;</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">100.0</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">_str_conv</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">_str_conv</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">_str_conv</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="c1"># Extract CAZ</span>
            <span class="k">if</span> <span class="n">arrival</span><span class="o">.</span><span class="n">azimuth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">caz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arrival</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">caz</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">caz</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">timeres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">azimuthres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">azimuth</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pick</span><span class="o">.</span><span class="n">phase_hint</span><span class="p">:</span>
            <span class="c1"># Cope with some authorities not providing phase hints :(</span>
            <span class="n">phase_hint</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phase_hint</span> <span class="o">=</span> <span class="n">pick</span><span class="o">.</span><span class="n">phase_hint</span>
        <span class="c1"># Extract amplitude: note there can be multiple amplitudes, but they</span>
        <span class="c1"># should be associated with different picks.</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="p">[</span><span class="n">amplitude</span> <span class="k">for</span> <span class="n">amplitude</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">amplitudes</span>
                     <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">pick_id</span> <span class="o">==</span> <span class="n">pick</span><span class="o">.</span><span class="n">resource_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Nordic files need one pick for each amplitude, &#39;</span> <span class="o">+</span> \
                      <span class="s1">&#39;using the first amplitude only&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Determine type of amplitude</span>
            <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;END&#39;</span><span class="p">:</span>
                <span class="c1"># Extract period</span>
                <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">peri</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">period</span>
                    <span class="k">if</span> <span class="n">peri</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
                        <span class="n">peri_round</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">peri</span> <span class="o">&gt;=</span> <span class="mf">10.0</span><span class="p">:</span>
                        <span class="n">peri_round</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">peri_round</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">peri</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">peri_round</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># Extract amplitude and convert units</span>
                <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">generic_amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">amp</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">generic_amplitude</span>
                    <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">,</span> <span class="s1">&#39;m/(s*s)&#39;</span><span class="p">,</span> <span class="s1">&#39;m*s&#39;</span><span class="p">]:</span>
                        <span class="n">amp</span> <span class="o">*=</span> <span class="mf">1e9</span>
                    <span class="c1"># Otherwise we will assume that the amplitude is in counts</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">amp</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">coda</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                <span class="k">if</span> <span class="n">amplitude</span><span class="o">.</span><span class="n">magnitude_hint</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ML&#39;</span><span class="p">:</span>
                    <span class="n">phase_hint</span> <span class="o">=</span> <span class="s1">&#39;IAML&#39;</span>
                    <span class="n">impulsivity</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coda</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amplitude</span><span class="o">.</span><span class="n">generic_amplitude</span><span class="p">)</span>
                <span class="n">peri</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                <span class="n">peri_round</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peri</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">peri_round</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">coda</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># If the weight is 0 then we don&#39;t need to print it</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">weight</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># this will return an empty string using _str_conv</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pick</span><span class="o">.</span><span class="n">evaluation_mode</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span><span class="p">:</span>
            <span class="n">eval_mode</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
        <span class="k">elif</span> <span class="n">pick</span><span class="o">.</span><span class="n">evaluation_mode</span> <span class="o">==</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
            <span class="n">eval_mode</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Evaluation mode </span><span class="si">%s</span><span class="s2"> is not supported&quot;</span>
                          <span class="o">%</span> <span class="n">pick</span><span class="o">.</span><span class="n">evaluation_mode</span><span class="p">)</span>
        <span class="c1"># Generate a print string and attach it to the list</span>
        <span class="n">channel_code</span> <span class="o">=</span> <span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="o">.</span><span class="n">channel_code</span> <span class="ow">or</span> <span class="s1">&#39;   &#39;</span>
        <span class="n">pick_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">pick</span><span class="o">.</span><span class="n">waveform_id</span><span class="o">.</span><span class="n">station_code</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">channel_code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">channel_code</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">impulsivity</span> <span class="o">+</span> <span class="n">phase_hint</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">eval_mode</span> <span class="o">+</span>
                            <span class="n">polarity</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pick</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span> <span class="o">/</span>
                            <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">coda</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">peri</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="n">peri_round</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">azimuthres</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">timeres</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">distance</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">_str_conv</span><span class="p">(</span><span class="n">caz</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1"># Note that currently finalweight is unsupported, nor is velocity, or</span>
        <span class="c1"># angle of incidence.  This is because obspy.event stores slowness in</span>
        <span class="c1"># s/deg and takeoff angle, which would require computation from the</span>
        <span class="c1"># values stored in seisan.  Multiple weights are also not supported in</span>
        <span class="c1"># Obspy.event</span>
    <span class="k">return</span> <span class="n">pick_strings</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/people">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a> &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2016
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Ammon, Charles J.</li>
<li>Arnarsson, lafur St.</li>
<li>Barsch, Robert</li>
<li>Bernardi, Fabrizio</li>
<li>Beyreuther, Moritz</li>
<li>Carothers, Lloyd</li>
<li>Egdorf, Sven</li>
<li>Ermert, Laura</li>
<li>Fabbri, Tommaso</li>
<li>Grunberg, Marc</li>
<li>Heimann, Sebastian</li>
<li>Hope, Gaute</li>
<li>Inza, Adolfo</li>
<li>Ketchum, David</li>
<li>Kremers, Simon</li>
<li>Krieger, Lars</li>
<li>Kufl, Paul</li>
<li>Lecocq, Thomas</li>
<li>Lesage, Philippe</li>
<li>Lopes, Rui L.</li>
<li>Maggi, Alessia</li>
<li>Megies, Tobias</li>
<li>Michelini, Alberto</li>
<li>Morgenstern, Bernhard</li>
<li>Panning, Mark P.</li>
<li>Reyes, Celso</li>
<li>Rothenhusler, Nicolas</li>
<li>Sales de Andrade, Elliott</li>
<li>Saul, Joachim</li>
<li>Sippl, Christian</li>
<li>Stange, Stefan</li>
<li>Trabant, Chad</li>
<li>Walker, Andrew</li>
<li>Wassermann, Joachim</li>
<li>Winkelman, Andrew</li>
<li>van Driel, Martin</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Antunes, Emanuel</li>
<li>Bank, Markus</li>
<li>Behr, Yannik</li>
<li>Bernauer, Felix</li>
<li>Bonaim, Sbastien</li>
<li>Danecek, Peter</li>
<li>Engels, Fabian</li>
<li>Eulenfeld, Tom</li>
<li>Grellier, Clment</li>
<li>Hammer, Conny</li>
<li>Heiniger, Lukas</li>
<li>Igel, Heiner</li>
<li>Isken, Marius</li>
<li>Koymans, Mathijs</li>
<li>Kress, Victor</li>
<li>Krischer, Lion</li>
<li>Khler, Andreas</li>
<li>Leeman, John</li>
<li>Lomax, Anthony</li>
<li>MacCarthy, Jonathan</li>
<li>Martin, Henri</li>
<li>Meschede, Matthias</li>
<li>Miller, Nathaniel C.</li>
<li>Nof, Ran Novitsky</li>
<li>Rapagnani, Giovanni</li>
<li>Ringler, Adam</li>
<li>Russo, Emiliano</li>
<li>Satriano, Claudio</li>
<li>Scheingraber, Chris</li>
<li>Snoke, Arthur</li>
<li>Sullivan, Benjamin</li>
<li>Uieda, Leonardo</li>
<li>Walther, Marcus</li>
<li>Williams, Mark C.</li>
<li>Zad, Seyed Kasra Hosseini</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
<li>VERCE EU-FP7 project (no. 283543)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>